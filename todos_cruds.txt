=== app/dashboard/brokers/agregar/page.tsx ===
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { supabase } from '@/lib/supabaseClient';
import Link from 'next/link';

export default function AgregarBroker() {
  const router = useRouter();
  const [loading, setLoading] = useState(false);
  const [formData, setFormData] = useState({
    // INFORMACI√ìN PERSONAL
    nombre: '',
    email: '',
    telefono: '',
    especialidad: '',
    
    // INFORMACI√ìN PROFESIONAL
    licencia: '',
    a√±os_experiencia: '',
    comision_promedio: '',
    
    // ESTAD√çSTICAS
    propiedades_activas: '0',
    clientes_activos: '0',
    ventas_realizadas: '0',
    
    // ESTADO
    estatus: 'activo',
    notas: ''
  });

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data, error } = await supabase
        .from('brokers')
        .insert([{
          // Informaci√≥n personal
          nombre: formData.nombre,
          email: formData.email,
          telefono: formData.telefono,
          especialidad: formData.especialidad,
          
          // Informaci√≥n profesional
          licencia: formData.licencia,
          a√±os_experiencia: formData.a√±os_experiencia ? parseInt(formData.a√±os_experiencia) : null,
          comision_promedio: formData.comision_promedio ? parseFloat(formData.comision_promedio) : null,
          
          // Estad√≠sticas
          propiedades_activas: parseInt(formData.propiedades_activas),
          clientes_activos: parseInt(formData.clientes_activos),
          ventas_realizadas: parseInt(formData.ventas_realizadas),
          
          // Estado
          estatus: formData.estatus,
          notas: formData.notas
        }])
        .select();

      if (error) {
        throw error;
      }

      alert('Broker agregado correctamente!');
      router.push('/dashboard/brokers');
      
    } catch (error: any) {
      console.error('Error al agregar broker:', error);
      if (error.code === '23505') {
        alert('Error: Ya existe un broker con ese email');
      } else {
        alert('Error al agregar el broker');
      }
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
      <div style={{ maxWidth: '800px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ marginBottom: '32px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' }}>
            <Link 
              href="/dashboard/brokers"
              style={{ 
                color: '#64748b', 
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              ‚Üê Volver a Brokers
            </Link>
          </div>
          <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
            Agregar Nuevo Broker
          </h1>
          <p style={{ color: '#64748b', fontSize: '16px' }}>
            Complete la informaci√≥n del nuevo broker o agente
          </p>
        </div>

        {/* Formulario */}
        <form onSubmit={handleSubmit}>
          <div style={{ 
            background: 'white', 
            borderRadius: '12px', 
            padding: '32px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0'
          }}>
            
            {/* Informaci√≥n Personal */}
            <div style={{ marginBottom: '32px' }}>
              <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#2d3436', marginBottom: '24px' }}>
                Informaci√≥n Personal
              </h2>
              
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
                <div>
                  <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                    Nombre Completo *
                  </label>
                  <input
                    type="text"
                    name="nombre"
                    value={formData.nombre}
                    onChange={handleChange}
                    style={{ 
                      width: '100%', 
                      padding: '12px 16px',
                      border: '1px solid #d1d5db',
                      borderRadius: '8px',
                      fontSize: '14px'
                    }}
                    required
                  />
                </div>

                <div>
                  <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                    Email *
                  </label>
                  <input
                    type="email"
                    name="email"
                    value={formData.email}
                    onChange={handleChange}
                    style={{ 
                      width: '100%', 
                      padding: '12px 16px',
                      border: '1px solid #d1d5db',
                      borderRadius: '8px',
                      fontSize: '14px'
                    }}
                    required
                  />
                </div>

                <div>
                  <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                    Tel√©fono
                  </label>
                  <input
                    type="tel"
                    name="telefono"
                    value={formData.telefono}
                    onChange={handleChange}
                    style={{ 
                      width: '100%', 
                      padding: '12px 16px',
                      border: '1px solid #d1d5db',
                      borderRadius: '8px',
                      fontSize: '14px'
                    }}
                  />
                </div>

                <div>
                  <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                    Especialidad
                  </label>
                  <select
                    name="especialidad"
                    value={formData.especialidad}
                    onChange={handleChange}
                    style={{ 
                      width: '100%', 
                      padding: '12px 16px',
                      border: '1px solid #d1d5db',
                      borderRadius: '8px',
                      fontSize: '14px',
                      background: 'white'
                    }}
                  >
                    <option value="">Seleccionar especialidad</option>
                    <option value="Residencial">Residencial</option>
                    <option value="Comercial">Comercial</option>
                    <option value="Industrial">Industrial</option>
                    <option value="Terrenos">Terrenos</option>
                  </select>
                </div>
              </div>
            </div>

            {/* Informaci√≥n Profesional */}
            <div style={{ marginBottom: '32px' }}>
              <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#2d3436', marginBottom: '24px' }}>
                Informaci√≥n Profesional
              </h2>
              
              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '20px' }}>
                <div>
                  <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                    Licencia
                  </label>
                  <input
                    type="text"
                    name="licencia"
                    value={formData.licencia}
                    onChange={handleChange}
                    style={{ 
                      width: '100%', 
                      padding: '12px 16px',
                      border: '1px solid #d1d5db',
                      borderRadius: '8px',
                      fontSize: '14px'
                    }}
                  />
                </div>

                <div>
                  <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                    A√±os de Experiencia
                  </label>
                  <input
                    type="number"
                    name="a√±os_experiencia"
                    value={formData.a√±os_experiencia}
                    onChange={handleChange}
                    style={{ 
                      width: '100%', 
                      padding: '12px 16px',
                      border: '1px solid #d1d5db',
                      borderRadius: '8px',
                      fontSize: '14px'
                    }}
                  />
                </div>

                <div>
                  <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                    Comisi√≥n Promedio (%)
                  </label>
                  <input
                    type="number"
                    step="0.01"
                    name="comision_promedio"
                    value={formData.comision_promedio}
                    onChange={handleChange}
                    style={{ 
                      width: '100%', 
                      padding: '12px 16px',
                      border: '1px solid #d1d5db',
                      borderRadius: '8px',
                      fontSize: '14px'
                    }}
                  />
                </div>
              </div>
            </div>

            {/* Botones */}
            <div style={{ display: 'flex', gap: '16px', justifyContent: 'flex-end', marginTop: '32px' }}>
              <Link
                href="/dashboard/brokers"
                style={{
                  padding: '12px 24px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  color: '#374151',
                  textDecoration: 'none',
                  fontSize: '14px',
                  fontWeight: '500'
                }}
              >
                Cancelar
              </Link>
              <button
                type="submit"
                disabled={loading}
                style={{
                  padding: '12px 24px',
                  background: loading ? '#9ca3af' : '#181f42',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  fontSize: '14px',
                  fontWeight: '500',
                  cursor: loading ? 'not-allowed' : 'pointer'
                }}
              >
                {loading ? 'Guardando...' : 'Guardar Broker'}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
}=== app/dashboard/brokers/page.tsx ===
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import { supabase } from '@/lib/supabaseClient';

interface Broker {
  id: string;
  nombre: string;
  email: string;
  telefono: string;
  especialidad: string;
  estatus: string;
  propiedades_activas: number;
  clientes_activos: number;
  a√±os_experiencia: number;
  comision_promedio: number;
  licencia: string;
}

export default function BrokersPage() {
  const [brokers, setBrokers] = useState<Broker[]>([]);
  const [loading, setLoading] = useState(true);
  const [deletingId, setDeletingId] = useState<string | null>(null);
  const [searchTerm, setSearchTerm] = useState('');

  useEffect(() => {
    fetchBrokers();
  }, []);

  const fetchBrokers = async () => {
    try {
      const { data, error } = await supabase
        .from('brokers')
        .select('*')
        .order('creado_en', { ascending: false });

      if (error) throw error;
      setBrokers(data || []);
    } catch (error) {
      console.error('Error fetching brokers:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleEliminarBroker = async (id: string, nombre: string) => {
    if (!confirm(`¬øEst√°s seguro de que quieres eliminar al broker "${nombre}"? Esta acci√≥n no se puede deshacer.`)) {
      return;
    }

    setDeletingId(id);
    
    try {
      const { error } = await supabase
        .from('brokers')
        .delete()
        .eq('id', id);

      if (error) {
        console.error('Error eliminando broker:', error);
        alert(`Error al eliminar broker: ${error.message}`);
        throw error;
      }

      // Actualizar la lista eliminando el broker
      setBrokers(prev => prev.filter(broker => broker.id !== id));
      alert('Broker eliminado correctamente');
      
    } catch (error) {
      console.error('Error eliminando broker:', error);
    } finally {
      setDeletingId(null);
    }
  };

  const filteredBrokers = brokers.filter(broker =>
    broker.nombre.toLowerCase().includes(searchTerm.toLowerCase()) ||
    broker.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
    broker.especialidad.toLowerCase().includes(searchTerm.toLowerCase())
  );

  if (loading) {
    return (
      <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
        <div style={{ textAlign: 'center', color: '#64748b' }}>Cargando brokers...</div>
      </div>
    );
  }

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa' }}>
      {/* Header */}
      <div style={{ 
        background: 'white', 
        borderBottom: '1px solid #e2e8f0', 
        padding: '24px 32px' 
      }}>
        {/* Bot√≥n para regresar al Dashboard */}
        <div style={{ marginBottom: '16px' }}>
          <Link 
            href="/dashboard"
            style={{ 
              color: '#64748b', 
              textDecoration: 'none',
              fontSize: '14px',
              fontWeight: '500',
              display: 'inline-flex',
              alignItems: 'center',
              gap: '8px'
            }}
          >
            ‚Üê Volver al Dashboard
          </Link>
        </div>

        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
          <div>
            <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
              Brokers
            </h1>
            <p style={{ color: '#64748b', fontSize: '16px' }}>
              Gesti√≥n de equipo comercial
            </p>
          </div>
          <Link
            href="/dashboard/brokers/agregar"
            style={{
              background: '#181f42',
              color: 'white',
              padding: '12px 24px',
              borderRadius: '8px',
              textDecoration: 'none',
              fontSize: '14px',
              fontWeight: '500'
            }}
          >
            + Nuevo Broker
          </Link>
        </div>

        {/* B√∫squeda */}
        <div style={{ marginTop: '24px' }}>
          <div style={{ position: 'relative', maxWidth: '400px' }}>
            <input
              type="text"
              placeholder="Buscar brokers..."
              value={searchTerm}
              onChange={(e) => setSearchTerm(e.target.value)}
              style={{ 
                width: '100%', 
                padding: '12px 16px 12px 40px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
            <span style={{ 
              position: 'absolute',
              left: '12px',
              top: '50%',
              transform: 'translateY(-50%)',
              color: '#64748b'
            }}>
              üîç
            </span>
          </div>
        </div>
      </div>

      {/* Contenido */}
      <div style={{ padding: '32px' }}>
        {/* Estad√≠sticas */}
        <div style={{ 
          display: 'grid', 
          gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', 
          gap: '20px', 
          marginBottom: '32px' 
        }}>
          <div style={{ 
            background: 'white', 
            padding: '24px', 
            borderRadius: '12px',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436' }}>
              {brokers.length}
            </div>
            <div style={{ fontSize: '14px', color: '#64748b' }}>Total Brokers</div>
          </div>
          
          <div style={{ 
            background: 'white', 
            padding: '24px', 
            borderRadius: '12px',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436' }}>
              {brokers.filter(b => b.estatus === 'activo').length}
            </div>
            <div style={{ fontSize: '14px', color: '#64748b' }}>Brokers Activos</div>
          </div>
          
          <div style={{ 
            background: 'white', 
            padding: '24px', 
            borderRadius: '12px',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436' }}>
              {brokers.reduce((sum, broker) => sum + broker.propiedades_activas, 0)}
            </div>
            <div style={{ fontSize: '14px', color: '#64748b' }}>Propiedades Activas</div>
          </div>
          
          <div style={{ 
            background: 'white', 
            padding: '24px', 
            borderRadius: '12px',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436' }}>
              {brokers.reduce((sum, broker) => sum + broker.clientes_activos, 0)}
            </div>
            <div style={{ fontSize: '14px', color: '#64748b' }}>Clientes Activos</div>
          </div>
        </div>

        {/* Lista de brokers */}
        <div style={{ 
          background: 'white', 
          borderRadius: '12px',
          border: '1px solid #e2e8f0',
          overflow: 'hidden'
        }}>
          <div style={{ overflowX: 'auto' }}>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <thead>
                <tr style={{ background: '#f8f9fa' }}>
                  <th style={{ 
                    padding: '16px', 
                    textAlign: 'left', 
                    fontWeight: '600',
                    fontSize: '12px',
                    color: '#64748b',
                    textTransform: 'uppercase'
                  }}>
                    Broker
                  </th>
                  <th style={{ 
                    padding: '16px', 
                    textAlign: 'left', 
                    fontWeight: '600',
                    fontSize: '12px',
                    color: '#64748b',
                    textTransform: 'uppercase'
                  }}>
                    Contacto
                  </th>
                  <th style={{ 
                    padding: '16px', 
                    textAlign: 'left', 
                    fontWeight: '600',
                    fontSize: '12px',
                    color: '#64748b',
                    textTransform: 'uppercase'
                  }}>
                    Especialidad
                  </th>
                  <th style={{ 
                    padding: '16px', 
                    textAlign: 'left', 
                    fontWeight: '600',
                    fontSize: '12px',
                    color: '#64748b',
                    textTransform: 'uppercase'
                  }}>
                    Experiencia
                  </th>
                  <th style={{ 
                    padding: '16px', 
                    textAlign: 'left', 
                    fontWeight: '600',
                    fontSize: '12px',
                    color: '#64748b',
                    textTransform: 'uppercase'
                  }}>
                    Estad√≠sticas
                  </th>
                  <th style={{ 
                    padding: '16px', 
                    textAlign: 'left', 
                    fontWeight: '600',
                    fontSize: '12px',
                    color: '#64748b',
                    textTransform: 'uppercase'
                  }}>
                    Estado
                  </th>
                  <th style={{ 
                    padding: '16px', 
                    textAlign: 'left', 
                    fontWeight: '600',
                    fontSize: '12px',
                    color: '#64748b',
                    textTransform: 'uppercase'
                  }}>
                    Acciones
                  </th>
                </tr>
              </thead>
              <tbody>
                {filteredBrokers.map((broker) => (
                  <tr key={broker.id} style={{ borderTop: '1px solid #e2e8f0' }}>
                    <td style={{ padding: '16px' }}>
                      <div style={{ fontWeight: '600', color: '#2d3436' }}>
                        {broker.nombre}
                      </div>
                      {broker.licencia && (
                        <div style={{ fontSize: '12px', color: '#64748b', marginTop: '4px' }}>
                          Lic: {broker.licencia}
                        </div>
                      )}
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ color: '#2d3436' }}>{broker.email}</div>
                      <div style={{ fontSize: '12px', color: '#64748b', marginTop: '4px' }}>
                        {broker.telefono || 'Sin tel√©fono'}
                      </div>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <span style={{
                        background: '#e3f2fd',
                        color: '#1976d2',
                        padding: '4px 12px',
                        borderRadius: '20px',
                        fontSize: '12px',
                        fontWeight: '600',
                        display: 'inline-block'
                      }}>
                        {broker.especialidad || 'General'}
                      </span>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ color: '#2d3436' }}>
                        {broker.a√±os_experiencia || 0} a√±os
                      </div>
                      {broker.comision_promedio && (
                        <div style={{ fontSize: '12px', color: '#64748b' }}>
                          {broker.comision_promedio}% comisi√≥n
                        </div>
                      )}
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ fontSize: '13px' }}>
                        <div>üè† {broker.propiedades_activas} propiedades</div>
                        <div>üë• {broker.clientes_activos} clientes</div>
                      </div>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <span style={{
                        display: 'inline-flex',
                        alignItems: 'center',
                        padding: '4px 12px',
                        borderRadius: '20px',
                        fontSize: '12px',
                        fontWeight: '600',
                        textTransform: 'uppercase',
                        background: broker.estatus === 'activo' ? '#d1fae5' : '#fee2e2',
                        color: broker.estatus === 'activo' ? '#065f46' : '#991b1b'
                      }}>
                        {broker.estatus}
                      </span>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ display: 'flex', gap: '12px' }}>
                        <Link 
                          href={`/dashboard/brokers/editar/${broker.id}`}
                          style={{ 
                            color: '#181f42',
                            textDecoration: 'none',
                            fontSize: '14px',
                            fontWeight: '500'
                          }}
                        >
                          Editar
                        </Link>
                        <button
                          onClick={() => handleEliminarBroker(broker.id, broker.nombre)}
                          disabled={deletingId === broker.id}
                          style={{
                            color: deletingId === broker.id ? '#9ca3af' : '#dc2626',
                            background: 'none',
                            border: 'none',
                            fontSize: '14px',
                            fontWeight: '500',
                            cursor: deletingId === broker.id ? 'not-allowed' : 'pointer'
                          }}
                        >
                          {deletingId === broker.id ? 'Eliminando...' : 'Eliminar'}
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {brokers.length === 0 && (
            <div style={{ textAlign: 'center', padding: '60px 20px', color: '#64748b' }}>
              <div style={{ fontSize: '48px', marginBottom: '16px', opacity: '0.5' }}>üë•</div>
              <h3 style={{ marginBottom: '8px', color: '#2d3436' }}>No hay brokers registrados</h3>
              <p style={{ marginBottom: '24px' }}>Comienza agregando el primer broker a tu equipo</p>
              <Link
                href="/dashboard/brokers/agregar"
                style={{
                  background: '#181f42',
                  color: 'white',
                  padding: '12px 24px',
                  borderRadius: '8px',
                  textDecoration: 'none',
                  fontSize: '14px',
                  fontWeight: '500'
                }}
              >
                + Agregar Primer Broker
              </Link>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}=== app/dashboard/reportes/page.tsx ===
// app/dashboard/reportes/page.tsx - PIPELINE CORREGIDO
'use client';

import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabaseClient';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

interface ClientePipeline {
  id: string;
  nombre: string;
  email: string;
  telefono: string;
  tipo: string;
  etapa_pipeline: string;
  probabilidad_cierre: number;
  ultimo_contacto: string;
  proxima_accion: string;
  broker_nombre: string;
}

interface PipelineStats {
  total: number;
  prospecto: number;
  calificado: number;
  negociacion: number;
  cerrado: number;
  valorPotencial: number;
}

export default function PipelinePage() {
  const [clientes, setClientes] = useState<ClientePipeline[]>([]);
  const [stats, setStats] = useState<PipelineStats>({
    total: 0,
    prospecto: 0,
    calificado: 0,
    negociacion: 0,
    cerrado: 0,
    valorPotencial: 0
  });
  const [loading, setLoading] = useState(true);
  const [userRole, setUserRole] = useState('');
  const [filtroEtapa, setFiltroEtapa] = useState('todas');
  const router = useRouter();

  const etapas = [
    { id: 'prospecto', nombre: 'üîç Prospecto', color: '#6B7280', desc: 'Clientes nuevos por contactar' },
    { id: 'calificado', nombre: '‚úÖ Calificado', color: '#3B82F6', desc: 'Clientes interesados' },
    { id: 'negociacion', nombre: 'üíº Negociaci√≥n', color: '#F59E0B', desc: 'En proceso de oferta' },
    { id: 'cerrado', nombre: 'üéâ Cerrado', color: '#10B981', desc: 'Ventas concretadas' }
  ];

  useEffect(() => {
    loadPipelineData();
  }, [filtroEtapa]);

  const loadPipelineData = async () => {
    try {
      const email = localStorage.getItem('userEmail');
      const role = localStorage.getItem('userRole') || 'broker';
      setUserRole(role);

      if (!email) {
        router.push('/login');
        return;
      }

      let brokerId = null;

      // Si no es admin, obtener broker_id del usuario
      if (role !== 'admin') {
        const { data: usuario, error: userError } = await supabase
          .from('usuarios')
          .select('broker_id')
          .eq('email', email)
          .single();

        if (userError) {
          console.error('Error fetching user:', userError);
          throw userError;
        }

        brokerId = usuario?.broker_id;
      }

      // Consulta base de clientes
      let query = supabase
        .from('clientes')
        .select(`
          id,
          nombre,
          email,
          telefono,
          tipo,
          etapa_pipeline,
          probabilidad_cierre,
          ultimo_contacto,
          proxima_accion,
          presupuesto_max,
          broker_id
        `);

      // Aplicar filtro por broker si no es admin
      if (role !== 'admin' && brokerId) {
        query = query.eq('broker_id', brokerId);
      }

      // Aplicar filtro de etapa si no es "todas"
      if (filtroEtapa !== 'todas') {
        query = query.eq('etapa_pipeline', filtroEtapa);
      }

      const { data: clientesData, error } = await query;

      if (error) {
        console.error('Supabase error:', error);
        throw error;
      }

      // Obtener nombres de brokers para los clientes
      const clientesConBrokers = await Promise.all(
        (clientesData || []).map(async (cliente) => {
          let brokerNombre = 'Sin broker';
          
          if (cliente.broker_id) {
            const { data: brokerData } = await supabase
              .from('brokers')
              .select('nombre')
              .eq('id', cliente.broker_id)
              .single();
            
            brokerNombre = brokerData?.nombre || 'Broker no encontrado';
          }

          return {
            id: cliente.id,
            nombre: cliente.nombre,
            email: cliente.email || '',
            telefono: cliente.telefono || '',
            tipo: cliente.tipo,
            etapa_pipeline: cliente.etapa_pipeline || 'prospecto',
            probabilidad_cierre: cliente.probabilidad_cierre || 0,
            ultimo_contacto: cliente.ultimo_contacto,
            proxima_accion: cliente.proxima_accion,
            broker_nombre: brokerNombre
          };
        })
      );

      setClientes(clientesConBrokers);
      calcularEstad√≠sticas(clientesConBrokers);

    } catch (error) {
      console.error('Error loading pipeline:', error);
    } finally {
      setLoading(false);
    }
  };

  const calcularEstad√≠sticas = (clientes: ClientePipeline[]) => {
    const stats: PipelineStats = {
      total: clientes.length,
      prospecto: clientes.filter(c => c.etapa_pipeline === 'prospecto').length,
      calificado: clientes.filter(c => c.etapa_pipeline === 'calificado').length,
      negociacion: clientes.filter(c => c.etapa_pipeline === 'negociacion').length,
      cerrado: clientes.filter(c => c.etapa_pipeline === 'cerrado').length,
      valorPotencial: 0
    };

    setStats(stats);
  };

  const moverEtapa = async (clienteId: string, nuevaEtapa: string) => {
    try {
      const nuevaProbabilidad = 
        nuevaEtapa === 'prospecto' ? 10 :
        nuevaEtapa === 'calificado' ? 30 :
        nuevaEtapa === 'negociacion' ? 70 : 100;

      const { error } = await supabase
        .from('clientes')
        .update({ 
          etapa_pipeline: nuevaEtapa,
          probabilidad_cierre: nuevaProbabilidad
        })
        .eq('id', clienteId);

      if (error) throw error;

      // Recargar datos
      loadPipelineData();
      
    } catch (error) {
      console.error('Error moviendo etapa:', error);
      alert('Error al actualizar la etapa');
    }
  };

  if (loading) {
    return (
      <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
        <div style={{ maxWidth: '1200px', margin: '0 auto', textAlign: 'center', color: '#64748b' }}>
          <div style={{ fontSize: '48px', marginBottom: '16px' }}>‚è≥</div>
          <p>Cargando pipeline de ventas...</p>
        </div>
      </div>
    );
  }

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ marginBottom: '32px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' }}>
            <Link 
              href="/dashboard"
              style={{ color: '#64748b', textDecoration: 'none', fontSize: '14px', fontWeight: '500' }}
            >
              ‚Üê Volver al Dashboard
            </Link>
          </div>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>
            <div>
              <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
                Pipeline de Ventas
              </h1>
              <p style={{ color: '#64748b', fontSize: '16px' }}>
                Seguimiento de clientes y oportunidades
              </p>
            </div>
            <div style={{ color: '#64748b', fontSize: '14px' }}>
              Rol: <strong>{userRole === 'admin' ? 'üëë Administrador' : 'ü§ù Broker'}</strong>
            </div>
          </div>

          {/* Filtros */}
          <div style={{ 
            background: 'white', 
            padding: '20px',
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0',
            marginBottom: '24px'
          }}>
            <div style={{ display: 'flex', gap: '16px', alignItems: 'center', flexWrap: 'wrap' }}>
              <select
                value={filtroEtapa}
                onChange={(e) => setFiltroEtapa(e.target.value)}
                style={{ 
                  padding: '10px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              >
                <option value="todas">Todas las etapas</option>
                {etapas.map(etapa => (
                  <option key={etapa.id} value={etapa.id}>{etapa.nombre}</option>
                ))}
              </select>
              
              <div style={{ marginLeft: 'auto', display: 'flex', gap: '12px', fontSize: '14px', color: '#64748b' }}>
                <span>Total: <strong>{stats.total}</strong> clientes</span>
              </div>
            </div>
          </div>
        </div>

        {/* Estad√≠sticas del Pipeline */}
        <div style={{ 
          display: 'grid', 
          gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', 
          gap: '16px', 
          marginBottom: '32px' 
        }}>
          {etapas.map(etapa => {
            const count = stats[etapa.id as keyof PipelineStats] as number;
            const porcentaje = stats.total > 0 ? (count / stats.total) * 100 : 0;
            
            return (
              <div key={etapa.id} style={{ 
                background: 'white', 
                padding: '20px',
                borderRadius: '12px',
                boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
                border: `2px solid ${etapa.color}20`,
                borderLeft: `4px solid ${etapa.color}`
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>
                  <span style={{ fontSize: '12px', fontWeight: '600', color: etapa.color, textTransform: 'uppercase' }}>
                    {etapa.nombre.split(' ')[1]}
                  </span>
                  <span style={{ fontSize: '12px', color: '#64748b' }}>{porcentaje.toFixed(0)}%</span>
                </div>
                <div style={{ fontSize: '24px', fontWeight: '700', color: '#2d3436' }}>{count}</div>
                <div style={{ fontSize: '12px', color: '#64748b' }}>{etapa.desc}</div>
              </div>
            );
          })}
        </div>

        {/* Lista de Clientes */}
        <div style={{ 
          background: 'white', 
          borderRadius: '12px',
          boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
          border: '1px solid #e2e8f0',
          overflow: 'hidden'
        }}>
          <div style={{ 
            display: 'grid',
            gridTemplateColumns: '2fr 1fr 1fr 1fr 1fr auto',
            gap: '16px',
            padding: '20px',
            background: '#f8fafc',
            borderBottom: '1px solid #e2e8f0',
            fontWeight: '600',
            color: '#374151',
            fontSize: '14px'
          }}>
            <div>Cliente</div>
            <div>Contacto</div>
            <div>Etapa</div>
            <div>Probabilidad</div>
            <div>Broker</div>
            <div>Acciones</div>
          </div>

          <div>
            {clientes.map((cliente) => {
              const etapa = etapas.find(e => e.id === cliente.etapa_pipeline);
              
              return (
                <div
                  key={cliente.id}
                  style={{
                    display: 'grid',
                    gridTemplateColumns: '2fr 1fr 1fr 1fr 1fr auto',
                    gap: '16px',
                    padding: '20px',
                    borderBottom: '1px solid #f1f5f9',
                    alignItems: 'center'
                  }}
                >
                  {/* Cliente */}
                  <div>
                    <div style={{ fontWeight: '600', color: '#2d3436' }}>{cliente.nombre}</div>
                    <div style={{ fontSize: '12px', color: '#64748b', marginTop: '4px' }}>
                      {cliente.tipo}
                    </div>
                  </div>

                  {/* Contacto */}
                  <div>
                    <div style={{ color: '#2d3436', fontSize: '14px' }}>{cliente.email || '-'}</div>
                    <div style={{ color: '#64748b', fontSize: '12px', marginTop: '4px' }}>
                      {cliente.telefono || '-'}
                    </div>
                  </div>

                  {/* Etapa */}
                  <div>
                    <span
                      style={{
                        padding: '6px 12px',
                        borderRadius: '20px',
                        fontSize: '12px',
                        fontWeight: '600',
                        background: etapa?.color + '20',
                        color: etapa?.color,
                        display: 'inline-block'
                      }}
                    >
                      {etapa?.nombre.split(' ')[0]} {cliente.etapa_pipeline}
                    </span>
                  </div>

                  {/* Probabilidad */}
                  <div>
                    <div style={{ 
                      background: '#e5e7eb', 
                      borderRadius: '10px', 
                      height: '8px',
                      marginBottom: '4px'
                    }}>
                      <div 
                        style={{ 
                          background: cliente.probabilidad_cierre >= 70 ? '#10B981' : 
                                    cliente.probabilidad_cierre >= 30 ? '#F59E0B' : '#EF4444',
                          width: `${cliente.probabilidad_cierre}%`,
                          height: '100%',
                          borderRadius: '10px'
                        }} 
                      />
                    </div>
                    <div style={{ fontSize: '12px', color: '#64748b', textAlign: 'center' }}>
                      {cliente.probabilidad_cierre}%
                    </div>
                  </div>

                  {/* Broker */}
                  <div style={{ color: '#2d3436', fontSize: '14px' }}>
                    {cliente.broker_nombre}
                  </div>

                  {/* Acciones */}
                  <div style={{ display: 'flex', gap: '8px' }}>
                    <select
                      value={cliente.etapa_pipeline}
                      onChange={(e) => moverEtapa(cliente.id, e.target.value)}
                      style={{
                        padding: '6px 8px',
                        border: '1px solid #d1d5db',
                        borderRadius: '6px',
                        fontSize: '12px',
                        background: 'white'
                      }}
                    >
                      {etapas.map(etapa => (
                        <option key={etapa.id} value={etapa.id}>
                          {etapa.nombre.split(' ')[1]}
                        </option>
                      ))}
                    </select>
                    
                    <Link
                      href={`/dashboard/clientes/editar/${cliente.id}`}
                      style={{
                        color: '#2563eb',
                        textDecoration: 'none',
                        fontSize: '12px',
                        fontWeight: '500',
                        padding: '6px 8px',
                        background: '#eff6ff',
                        borderRadius: '6px'
                      }}
                    >
                      Editar
                    </Link>
                  </div>
                </div>
              );
            })}
          </div>

          {clientes.length === 0 && (
            <div style={{ textAlign: 'center', padding: '60px 20px', color: '#64748b' }}>
              <div style={{ fontSize: '48px', marginBottom: '16px', opacity: '0.5' }}>üìä</div>
              <h3 style={{ marginBottom: '8px', color: '#2d3436' }}>No hay clientes en el pipeline</h3>
              <p style={{ marginBottom: '24px' }}>Comienza agregando clientes para ver el funnel de ventas</p>
              <Link
                href="/dashboard/clientes"
                style={{
                  background: '#181f42',
                  color: 'white',
                  padding: '12px 24px',
                  borderRadius: '8px',
                  textDecoration: 'none',
                  fontSize: '14px',
                  fontWeight: '500'
                }}
              >
                Gestionar Clientes
              </Link>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}=== app/dashboard/admin/usuarios/page.tsx ===
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

interface Usuario {
  id: string;
  nombre: string;
  email: string;
  telefono: string;
  especialidad: string;
  role: string;
  fechaRegistro: string;
  activo: boolean;
}

export default function AdminUsuariosPage() {
  const [usuarios, setUsuarios] = useState<Usuario[]>([]);
  const [loading, setLoading] = useState(true);
  const [userRole, setUserRole] = useState('');
  const [filtroRol, setFiltroRol] = useState('todos');
  const router = useRouter();

  useEffect(() => {
    verificarPermisosYCargarUsuarios();
  }, [filtroRol]);

  const verificarPermisosYCargarUsuarios = async () => {
    try {
      const email = localStorage.getItem('userEmail');
      const role = localStorage.getItem('userRole');
      
      if (!email || !role) {
        router.push('/login');
        return;
      }

      // Solo Super Admin y Admin pueden acceder
      if (role !== 'superadmin' && role !== 'admin') {
        alert('No tienes permisos para acceder a esta secci√≥n');
        router.push('/dashboard');
        return;
      }

      setUserRole(role);
      await cargarUsuarios();

    } catch (error) {
      console.error('Error:', error);
      router.push('/login');
    } finally {
      setLoading(false);
    }
  };

  const cargarUsuarios = async () => {
    try {
      // 1. Usuarios registrados en el formulario (brokers)
      const usuariosRegistrados: Usuario[] = JSON.parse(
        localStorage.getItem('usuariosRegistrados') || '[]'
      );

      // 2. Usuarios predefinidos del sistema (admins)
      const usuariosPredefinidos: Usuario[] = [
        {
          id: 'superadmin-1',
          nombre: 'Super Administrador',
          email: 'superadmin@inmobiliaria.com',
          telefono: '+52 55 0000 0000',
          especialidad: 'Todos',
          role: 'superadmin',
          fechaRegistro: new Date().toISOString(),
          activo: true
        },
        {
          id: 'admin-1',
          nombre: 'Administrador Principal',
          email: 'admin@inmobiliaria.com',
          telefono: '+52 55 1111 2222',
          especialidad: 'Gesti√≥n',
          role: 'admin',
          fechaRegistro: new Date().toISOString(),
          activo: true
        },
        {
          id: 'admin-2',
          nombre: 'Administrador Secundario',
          email: 'admin2@inmobiliaria.com',
          telefono: '+52 55 3333 4444',
          especialidad: 'Gesti√≥n',
          role: 'admin',
          fechaRegistro: new Date().toISOString(),
          activo: true
        },
        {
          id: 'broker-1',
          nombre: 'Carlos Mendoza',
          email: 'carlos@inmobiliaria.com',
          telefono: '+52 55 5555 6666',
          especialidad: 'Residencial',
          role: 'broker',
          fechaRegistro: new Date().toISOString(),
          activo: true
        },
        {
          id: 'broker-2',
          nombre: 'Ana Rodriguez',
          email: 'ana@inmobiliaria.com',
          telefono: '+52 55 7777 8888',
          especialidad: 'Comercial',
          role: 'broker',
          fechaRegistro: new Date().toISOString(),
          activo: true
        },
        {
          id: 'broker-3',
          nombre: 'Miguel Torres',
          email: 'miguel@inmobiliaria.com',
          telefono: '+52 55 9999 0000',
          especialidad: 'Industrial',
          role: 'broker',
          fechaRegistro: new Date().toISOString(),
          activo: true
        }
      ];

      // Combinar todos los usuarios
      const todosUsuarios = [...usuariosPredefinidos, ...usuariosRegistrados];

      // Aplicar filtro
      let usuariosFiltrados = todosUsuarios;
      if (filtroRol !== 'todos') {
        usuariosFiltrados = todosUsuarios.filter(user => user.role === filtroRol);
      }

      setUsuarios(usuariosFiltrados);

    } catch (error) {
      console.error('Error cargando usuarios:', error);
    }
  };

  const cambiarRolUsuario = (usuarioId: string, nuevoRol: string) => {
    if (userRole !== 'superadmin') {
      alert('Solo el Super Admin puede cambiar roles');
      return;
    }

    const usuariosActualizados = usuarios.map(user =>
      user.id === usuarioId ? { ...user, role: nuevoRol } : user
    );

    setUsuarios(usuariosActualizados);
    
    // Actualizar en localStorage para usuarios registrados
    const usuariosRegistrados: Usuario[] = JSON.parse(
      localStorage.getItem('usuariosRegistrados') || '[]'
    );
    
    const usuariosRegistradosActualizados = usuariosRegistrados.map(user =>
      user.id === usuarioId ? { ...user, role: nuevoRol } : user
    );
    
    localStorage.setItem('usuariosRegistrados', JSON.stringify(usuariosRegistradosActualizados));
    
    alert(`Rol cambiado exitosamente a ${nuevoRol}`);
  };

  const toggleEstadoUsuario = (usuarioId: string) => {
    const usuariosActualizados = usuarios.map(user =>
      user.id === usuarioId ? { ...user, activo: !user.activo } : user
    );

    setUsuarios(usuariosActualizados);
    
    // Actualizar en localStorage
    const usuariosRegistrados: Usuario[] = JSON.parse(
      localStorage.getItem('usuariosRegistrados') || '[]'
    );
    
    const usuariosRegistradosActualizados = usuariosRegistrados.map(user =>
      user.id === usuarioId ? { ...user, activo: !user.activo } : user
    );
    
    localStorage.setItem('usuariosRegistrados', JSON.stringify(usuariosRegistradosActualizados));
    
    alert(`Estado del usuario actualizado`);
  };

  const getBadgeColor = (role: string) => {
    switch (role) {
      case 'superadmin': return { bg: '#DC2626', color: 'white' };
      case 'admin': return { bg: '#059669', color: 'white' };
      case 'broker': return { bg: '#3B82F6', color: 'white' };
      default: return { bg: '#6B7280', color: 'white' };
    }
  };

  const getEspecialidadIcon = (especialidad: string) => {
    switch (especialidad) {
      case 'residencial': return 'üè†';
      case 'comercial': return 'üõçÔ∏è';
      case 'industrial': return 'üè≠';
      case 'mixto': return 'üîÄ';
      default: return 'üë§';
    }
  };

  if (loading) {
    return (
      <div style={{ 
        minHeight: '100vh', 
        background: 'linear-gradient(135deg, #181f42ff 0%, #252730ff 100%)',
        display: 'flex', 
        alignItems: 'center', 
        justifyContent: 'center' 
      }}>
        <div style={{ textAlign: 'center', color: 'white' }}>
          <div style={{ fontSize: '48px', marginBottom: '16px' }}>‚è≥</div>
          <p>Cargando panel de administraci√≥n...</p>
        </div>
      </div>
    );
  }

  return (
    <div style={{ 
      minHeight: '100vh', 
      background: 'linear-gradient(135deg, #181f42ff 0%, #252730ff 100%)',
      padding: '20px'
    }}>
      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ 
          display: 'flex', 
          justifyContent: 'space-between', 
          alignItems: 'center', 
          marginBottom: '30px',
          background: 'rgba(255,255,255,0.1)',
          padding: '20px',
          borderRadius: '12px'
        }}>
          <div>
            <h1 style={{ fontSize: '2rem', color: 'white', marginBottom: '8px' }}>
              üë• Gesti√≥n de Usuarios
            </h1>
            <p style={{ color: 'rgba(255,255,255,0.8)' }}>
              {userRole === 'superadmin' ? 'Super Administrador' : 'Administrador'} - Gestiona todos los usuarios del sistema
            </p>
          </div>
          
          <div style={{ display: 'flex', gap: '15px' }}>
            <Link
              href="/dashboard"
              style={{
                padding: '10px 20px',
                background: 'rgba(255,255,255,0.2)',
                color: 'white',
                borderRadius: '8px',
                textDecoration: 'none',
                border: '1px solid rgba(255,255,255,0.3)'
              }}
            >
              ‚Üê Volver al Dashboard
            </Link>
          </div>
        </div>

        {/* Estad√≠sticas */}
        <div style={{ 
          display: 'grid', 
          gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', 
          gap: '20px', 
          marginBottom: '30px' 
        }}>
          <div style={{ 
            background: 'rgba(255,255,255,0.1)', 
            padding: '20px', 
            borderRadius: '12px',
            textAlign: 'center',
            color: 'white'
          }}>
            <div style={{ fontSize: '2rem', fontWeight: 'bold' }}>{usuarios.length}</div>
            <div style={{ opacity: '0.8' }}>Total Usuarios</div>
          </div>
          <div style={{ 
            background: 'rgba(255,255,255,0.1)', 
            padding: '20px', 
            borderRadius: '12px',
            textAlign: 'center',
            color: 'white'
          }}>
            <div style={{ fontSize: '2rem', fontWeight: 'bold' }}>
              {usuarios.filter(u => u.role === 'broker').length}
            </div>
            <div style={{ opacity: '0.8' }}>Brokers</div>
          </div>
          <div style={{ 
            background: 'rgba(255,255,255,0.1)', 
            padding: '20px', 
            borderRadius: '12px',
            textAlign: 'center',
            color: 'white'
          }}>
            <div style={{ fontSize: '2rem', fontWeight: 'bold' }}>
              {usuarios.filter(u => u.role === 'admin').length}
            </div>
            <div style={{ opacity: '0.8' }}>Administradores</div>
          </div>
          <div style={{ 
            background: 'rgba(255,255,255,0.1)', 
            padding: '20px', 
            borderRadius: '12px',
            textAlign: 'center',
            color: 'white'
          }}>
            <div style={{ fontSize: '2rem', fontWeight: 'bold' }}>
              {usuarios.filter(u => u.activo).length}
            </div>
            <div style={{ opacity: '0.8' }}>Usuarios Activos</div>
          </div>
        </div>

        {/* Filtros */}
        <div style={{ 
          background: 'white', 
          padding: '20px',
          borderRadius: '12px',
          marginBottom: '20px'
        }}>
          <div style={{ display: 'flex', gap: '15px', alignItems: 'center', flexWrap: 'wrap' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>
                Filtrar por Rol:
              </label>
              <select
                value={filtroRol}
                onChange={(e) => setFiltroRol(e.target.value)}
                style={{
                  padding: '8px 12px',
                  border: '1px solid #d1d5db',
                  borderRadius: '6px',
                  fontSize: '14px'
                }}
              >
                <option value="todos">Todos los roles</option>
                <option value="superadmin">Super Admin</option>
                <option value="admin">Administradores</option>
                <option value="broker">Brokers</option>
              </select>
            </div>
            
            <div style={{ marginLeft: 'auto', display: 'flex', gap: '10px', fontSize: '14px', color: '#64748b' }}>
              <span>Mostrando: <strong>{usuarios.length}</strong> usuarios</span>
            </div>
          </div>
        </div>

        {/* Lista de Usuarios */}
        <div style={{ 
          background: 'white', 
          borderRadius: '12px',
          overflow: 'hidden',
          boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)'
        }}>
          {usuarios.length === 0 ? (
            <div style={{ textAlign: 'center', padding: '60px 20px', color: '#6B7280' }}>
              <div style={{ fontSize: '48px', marginBottom: '16px', opacity: '0.5' }}>üë•</div>
              <h3 style={{ marginBottom: '8px', color: '#374151' }}>No hay usuarios</h3>
              <p style={{ marginBottom: '24px' }}>No se encontraron usuarios con los filtros aplicados</p>
            </div>
          ) : (
            <>
              {/* Header de la tabla */}
              <div style={{ 
                display: 'grid',
                gridTemplateColumns: '2fr 1fr 1fr 1fr 1fr auto',
                gap: '16px',
                padding: '20px',
                background: '#F8FAFC',
                borderBottom: '1px solid #E2E8F0',
                fontWeight: '600',
                color: '#374151',
                fontSize: '14px'
              }}>
                <div>Usuario</div>
                <div>Contacto</div>
                <div>Especialidad</div>
                <div>Rol</div>
                <div>Estado</div>
                <div>Acciones</div>
              </div>

              {/* Lista de usuarios */}
              <div>
                {usuarios.map((usuario, index) => {
                  const badgeColor = getBadgeColor(usuario.role);
                  
                  return (
                    <div
                      key={usuario.id}
                      style={{
                        display: 'grid',
                        gridTemplateColumns: '2fr 1fr 1fr 1fr 1fr auto',
                        gap: '16px',
                        padding: '20px',
                        borderBottom: index < usuarios.length - 1 ? '1px solid #F1F5F9' : 'none',
                        alignItems: 'center'
                      }}
                    >
                      {/* Usuario */}
                      <div>
                        <div style={{ fontWeight: '600', color: '#2D3436' }}>
                          {usuario.nombre}
                        </div>
                        <div style={{ fontSize: '12px', color: '#64748B', marginTop: '4px' }}>
                          Registro: {new Date(usuario.fechaRegistro).toLocaleDateString()}
                        </div>
                      </div>

                      {/* Contacto */}
                      <div>
                        <div style={{ color: '#2D3436', fontSize: '14px' }}>{usuario.email}</div>
                        <div style={{ fontSize: '12px', color: '#64748B', marginTop: '4px' }}>
                          {usuario.telefono}
                        </div>
                      </div>

                      {/* Especialidad */}
                      <div>
                        <span style={{ 
                          padding: '6px 12px', 
                          borderRadius: '20px', 
                          fontSize: '12px',
                          background: '#F3F4F6',
                          color: '#374151',
                          display: 'inline-flex',
                          alignItems: 'center',
                          gap: '4px'
                        }}>
                          {getEspecialidadIcon(usuario.especialidad)} {usuario.especialidad}
                        </span>
                      </div>

                      {/* Rol */}
                      <div>
                        <span style={{ 
                          padding: '6px 12px', 
                          borderRadius: '20px', 
                          fontSize: '12px',
                          background: badgeColor.bg,
                          color: badgeColor.color,
                          display: 'inline-block',
                          fontWeight: '600'
                        }}>
                          {usuario.role}
                        </span>
                      </div>

                      {/* Estado */}
                      <div>
                        <span style={{ 
                          padding: '6px 12px', 
                          borderRadius: '20px', 
                          fontSize: '12px',
                          background: usuario.activo ? '#10B98120' : '#EF444420',
                          color: usuario.activo ? '#059669' : '#DC2626',
                          display: 'inline-block',
                          fontWeight: '600'
                        }}>
                          {usuario.activo ? 'Activo' : 'Inactivo'}
                        </span>
                      </div>

                      {/* Acciones */}
                      <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                        {userRole === 'superadmin' && usuario.role !== 'superadmin' && (
                          <select
                            value={usuario.role}
                            onChange={(e) => cambiarRolUsuario(usuario.id, e.target.value)}
                            style={{
                              padding: '6px 8px',
                              border: '1px solid #d1d5db',
                              borderRadius: '6px',
                              fontSize: '12px',
                              background: 'white'
                            }}
                          >
                            <option value="broker">Broker</option>
                            <option value="admin">Admin</option>
                          </select>
                        )}
                        
                        <button
                          onClick={() => toggleEstadoUsuario(usuario.id)}
                          style={{
                            color: usuario.activo ? '#DC2626' : '#059669',
                            background: usuario.activo ? '#FEF2F2' : '#F0FDF4',
                            border: 'none',
                            padding: '6px 12px',
                            borderRadius: '6px',
                            fontSize: '12px',
                            fontWeight: '500',
                            cursor: 'pointer'
                          }}
                        >
                          {usuario.activo ? 'Desactivar' : 'Activar'}
                        </button>
                      </div>
                    </div>
                  );
                })}
              </div>
            </>
          )}
        </div>

        {/* Informaci√≥n para Admin */}
        {userRole === 'admin' && (
          <div style={{ 
            background: '#FEF3C7', 
            padding: '15px',
            borderRadius: '8px',
            marginTop: '20px',
            border: '1px solid #F59E0B'
          }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '10px', color: '#92400E' }}>
              <span>‚ÑπÔ∏è</span>
              <div>
                <strong>Informaci√≥n:</strong> Como Administrador, puedes ver todos los usuarios pero solo el Super Admin puede cambiar roles.
              </div>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}=== app/dashboard/propiedades/industrial/editar/[id]/page.tsx ===
'use client';

import { useState, useEffect } from 'react';
import { useRouter, useParams } from 'next/navigation';
import { supabase } from '@/lib/supabaseClient';
import Link from 'next/link';

export default function EditarPropiedadIndustrial() {
  const router = useRouter();
  const params = useParams();
  const id = params.id as string;
  
  const [loading, setLoading] = useState(false);
  const [fetching, setFetching] = useState(true);
  const [activeSection, setActiveSection] = useState('basica');
  
  const [formData, setFormData] = useState({
    // INFORMACI√ìN B√ÅSICA
    marca: '',
    giro_industrial: '',
    ubicacion_coordenadas: '',
    radio_expansion: '',
    accesos_conectividad: '',
    precio_mn: '',
    cuota_mantenimiento: '',
    total_renta_cuota: '',
    precio_m2: '',

    // ESPECIFICACIONES T√âCNICAS
    superficie_total: '',
    superficie_almacen: '',
    oficinas_m2: '',
    tipo_nave: '',
    altura_minima: '',
    a√±o_construccion: '',
    capacidad_carga_piso: '',
    capacidad_electrica: '',
    tension_electrica: '',

    // INSTALACIONES Y SERVICIOS
    conectividad_fibra: 'No',
    energia_renovable: 'No',
    aislante_techo: 'No',
    tragaluz_natural: 'No',
    sistema_extraccion: 'No',
    andenes_carga: 'No',
    sellos_andenes: 'No',
    rampas_nivel: 'No',
    iluminacion_led: 'No',
    sistema_incendio: 'No',

    // DOCUMENTACI√ìN
    uso_suelo: '',
    documentacion_regla: '',

    // SERVICIOS COMPLEMENTARIOS
    banos_vestidores: 'No',
    regaderas: 'No',
    comedor: 'No',
    accesos_independientes: 'No',
    caseta_seguridad: 'No',
    estacionamiento: 'No',
    terreno_camiones: 'No',
    rutas_transporte: 'No',
    servicios_agua: 'No',
    via_ferrocarril: 'No',
    total_pallet: '',

    // OBSERVACIONES
    especificaciones_adicionales: '',
    observaciones: ''
  });

  // Cargar los datos de la propiedad
  useEffect(() => {
    if (id) {
      fetchPropiedad();
    }
  }, [id]);

  const fetchPropiedad = async () => {
    try {
      const { data, error } = await supabase
        .from('propiedades_industriales')
        .select('*')
        .eq('id', id)
        .single();

      if (error) throw error;

      if (data) {
        setFormData({
          // INFORMACI√ìN B√ÅSICA
          marca: data.marca || '',
          giro_industrial: data.giro_industrial || '',
          ubicacion_coordenadas: data.ubicacion_coordenadas || '',
          radio_expansion: data.radio_expansion || '',
          accesos_conectividad: data.accesos_conectividad || '',
          precio_mn: data.precio_mn?.toString() || '',
          cuota_mantenimiento: data.cuota_mantenimiento?.toString() || '',
          total_renta_cuota: data.total_renta_cuota?.toString() || '',
          precio_m2: data.precio_m2?.toString() || '',

          // ESPECIFICACIONES T√âCNICAS
          superficie_total: data.superficie_total?.toString() || '',
          superficie_almacen: data.superficie_almacen?.toString() || '',
          oficinas_m2: data.oficinas_m2?.toString() || '',
          tipo_nave: data.tipo_nave || '',
          altura_minima: data.altura_minima?.toString() || '',
          a√±o_construccion: data.a√±o_construccion?.toString() || '',
          capacidad_carga_piso: data.capacidad_carga_piso?.toString() || '',
          capacidad_electrica: data.capacidad_electrica?.toString() || '',
          tension_electrica: data.tension_electrica || '',

          // INSTALACIONES Y SERVICIOS
          conectividad_fibra: data.conectividad_fibra || 'No',
          energia_renovable: data.energia_renovable || 'No',
          aislante_techo: data.aislante_techo || 'No',
          tragaluz_natural: data.tragaluz_natural || 'No',
          sistema_extraccion: data.sistema_extraccion || 'No',
          andenes_carga: data.andenes_carga || 'No',
          sellos_andenes: data.sellos_andenes || 'No',
          rampas_nivel: data.rampas_nivel || 'No',
          iluminacion_led: data.iluminacion_led || 'No',
          sistema_incendio: data.sistema_incendio || 'No',

          // DOCUMENTACI√ìN
          uso_suelo: data.uso_suelo || '',
          documentacion_regla: data.documentacion_regla || '',

          // SERVICIOS COMPLEMENTARIOS
          banos_vestidores: data.banos_vestidores || 'No',
          regaderas: data.regaderas || 'No',
          comedor: data.comedor || 'No',
          accesos_independientes: data.accesos_independientes || 'No',
          caseta_seguridad: data.caseta_seguridad || 'No',
          estacionamiento: data.estacionamiento || 'No',
          terreno_camiones: data.terreno_camiones || 'No',
          rutas_transporte: data.rutas_transporte || 'No',
          servicios_agua: data.servicios_agua || 'No',
          via_ferrocarril: data.via_ferrocarril || 'No',
          total_pallet: data.total_pallet || '',

          // OBSERVACIONES
          especificaciones_adicionales: data.especificaciones_adicionales || '',
          observaciones: data.observaciones || ''
        });
      }
    } catch (error) {
      console.error('Error fetching propiedad:', error);
      alert('Error al cargar la propiedad');
    } finally {
      setFetching(false);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { error } = await supabase
        .from('propiedades_industriales')
        .update({
          // INFORMACI√ìN B√ÅSICA
          marca: formData.marca,
          giro_industrial: formData.giro_industrial,
          ubicacion_coordenadas: formData.ubicacion_coordenadas,
          radio_expansion: formData.radio_expansion,
          accesos_conectividad: formData.accesos_conectividad,
          precio_mn: formData.precio_mn ? parseFloat(formData.precio_mn) : null,
          cuota_mantenimiento: formData.cuota_mantenimiento ? parseFloat(formData.cuota_mantenimiento) : null,
          total_renta_cuota: formData.total_renta_cuota ? parseFloat(formData.total_renta_cuota) : null,
          precio_m2: formData.precio_m2 ? parseFloat(formData.precio_m2) : null,

          // ESPECIFICACIONES T√âCNICAS
          superficie_total: formData.superficie_total ? parseFloat(formData.superficie_total) : null,
          superficie_almacen: formData.superficie_almacen ? parseFloat(formData.superficie_almacen) : null,
          oficinas_m2: formData.oficinas_m2 ? parseFloat(formData.oficinas_m2) : null,
          tipo_nave: formData.tipo_nave,
          altura_minima: formData.altura_minima ? parseFloat(formData.altura_minima) : null,
          a√±o_construccion: formData.a√±o_construccion ? parseInt(formData.a√±o_construccion) : null,
          capacidad_carga_piso: formData.capacidad_carga_piso ? parseFloat(formData.capacidad_carga_piso) : null,
          capacidad_electrica: formData.capacidad_electrica ? parseFloat(formData.capacidad_electrica) : null,
          tension_electrica: formData.tension_electrica,

          // INSTALACIONES Y SERVICIOS
          conectividad_fibra: formData.conectividad_fibra,
          energia_renovable: formData.energia_renovable,
          aislante_techo: formData.aislante_techo,
          tragaluz_natural: formData.tragaluz_natural,
          sistema_extraccion: formData.sistema_extraccion,
          andenes_carga: formData.andenes_carga,
          sellos_andenes: formData.sellos_andenes,
          rampas_nivel: formData.rampas_nivel,
          iluminacion_led: formData.iluminacion_led,
          sistema_incendio: formData.sistema_incendio,

          // DOCUMENTACI√ìN
          uso_suelo: formData.uso_suelo,
          documentacion_regla: formData.documentacion_regla,

          // SERVICIOS COMPLEMENTARIOS
          banos_vestidores: formData.banos_vestidores,
          regaderas: formData.regaderas,
          comedor: formData.comedor,
          accesos_independientes: formData.accesos_independientes,
          caseta_seguridad: formData.caseta_seguridad,
          estacionamiento: formData.estacionamiento,
          terreno_camiones: formData.terreno_camiones,
          rutas_transporte: formData.rutas_transporte,
          servicios_agua: formData.servicios_agua,
          via_ferrocarril: formData.via_ferrocarril,
          total_pallet: formData.total_pallet,

          // OBSERVACIONES
          especificaciones_adicionales: formData.especificaciones_adicionales,
          observaciones: formData.observaciones
        })
        .eq('id', id);

      if (error) {
        throw error;
      }

      alert('Propiedad industrial actualizada correctamente!');
      router.push('/dashboard/propiedades/industrial');
      
    } catch (error) {
      console.error('Error al actualizar propiedad:', error);
      alert('Error al actualizar la propiedad');
    } finally {
      setLoading(false);
    }
  };

  const sections = [
    { id: 'basica', label: 'Informaci√≥n B√°sica', icon: 'üìã' },
    { id: 'tecnicas', label: 'Especificaciones T√©cnicas', icon: 'üèóÔ∏è' },
    { id: 'instalaciones', label: 'Instalaciones', icon: '‚ö°' },
    { id: 'documentacion', label: 'Documentaci√≥n', icon: 'üìÑ' },
    { id: 'servicios', label: 'Servicios', icon: 'üöö' },
    { id: 'observaciones', label: 'Observaciones', icon: 'üìù' }
  ];

  const renderSection = () => {
    switch(activeSection) {
      case 'basica':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Marca/Nombre *
              </label>
              <input
                type="text"
                name="marca"
                value={formData.marca}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
                required
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Giro Industrial
              </label>
              <input
                type="text"
                name="giro_industrial"
                value={formData.giro_industrial}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Coordenadas Ubicaci√≥n
              </label>
              <input
                type="text"
                name="ubicacion_coordenadas"
                value={formData.ubicacion_coordenadas}
                onChange={handleChange}
                placeholder="19.432608,-99.133209"
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Radio de Expansi√≥n
              </label>
              <input
                type="text"
                name="radio_expansion"
                value={formData.radio_expansion}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Accesos y Conectividad
              </label>
              <input
                type="text"
                name="accesos_conectividad"
                value={formData.accesos_conectividad}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Precio (MXN)
              </label>
              <input
                type="number"
                step="0.01"
                name="precio_mn"
                value={formData.precio_mn}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Cuota Mantenimiento
              </label>
              <input
                type="number"
                step="0.01"
                name="cuota_mantenimiento"
                value={formData.cuota_mantenimiento}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Precio por m¬≤
              </label>
              <input
                type="number"
                step="0.01"
                name="precio_m2"
                value={formData.precio_m2}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          </div>
        );

      case 'tecnicas':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Superficie Total (m¬≤)
              </label>
              <input
                type="number"
                step="0.01"
                name="superficie_total"
                value={formData.superficie_total}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Superficie Almac√©n (m¬≤)
              </label>
              <input
                type="number"
                step="0.01"
                name="superficie_almacen"
                value={formData.superficie_almacen}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Oficinas (m¬≤)
              </label>
              <input
                type="number"
                step="0.01"
                name="oficinas_m2"
                value={formData.oficinas_m2}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Tipo de Nave
              </label>
              <input
                type="text"
                name="tipo_nave"
                value={formData.tipo_nave}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Altura M√≠nima (m)
              </label>
              <input
                type="number"
                step="0.01"
                name="altura_minima"
                value={formData.altura_minima}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                A√±o de Construcci√≥n
              </label>
              <input
                type="number"
                name="a√±o_construccion"
                value={formData.a√±o_construccion}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Capacidad Carga Piso (kg/m¬≤)
              </label>
              <input
                type="number"
                step="0.01"
                name="capacidad_carga_piso"
                value={formData.capacidad_carga_piso}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Capacidad El√©ctrica (kVA)
              </label>
              <input
                type="number"
                step="0.01"
                name="capacidad_electrica"
                value={formData.capacidad_electrica}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Tensi√≥n El√©ctrica
              </label>
              <input
                type="text"
                name="tension_electrica"
                value={formData.tension_electrica}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          </div>
        );

      case 'instalaciones':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            {[
              { name: 'conectividad_fibra', label: 'Conectividad Fibra √ìptica' },
              { name: 'energia_renovable', label: 'Energ√≠a Renovable' },
              { name: 'aislante_techo', label: 'Aislante en Techo' },
              { name: 'tragaluz_natural', label: 'Tragaluz Natural' },
              { name: 'sistema_extraccion', label: 'Sistema de Extracci√≥n' },
              { name: 'andenes_carga', label: 'Andenes de Carga' },
              { name: 'sellos_andenes', label: 'Sellos en Andenes' },
              { name: 'rampas_nivel', label: 'Rampas a Nivel' },
              { name: 'iluminacion_led', label: 'Iluminaci√≥n LED' },
              { name: 'sistema_incendio', label: 'Sistema Contra Incendio' }
            ].map((field) => (
              <div key={field.name}>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  {field.label}
                </label>
                <select
                  name={field.name}
                  value={formData[field.name as keyof typeof formData] as string}
                  onChange={handleChange}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px',
                    background: 'white'
                  }}
                >
                  <option value="No">No</option>
                  <option value="S√≠">S√≠</option>
                </select>
              </div>
            ))}
          </div>
        );

      case 'documentacion':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Uso de Suelo
              </label>
              <input
                type="text"
                name="uso_suelo"
                value={formData.uso_suelo}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Documentaci√≥n en Regla
              </label>
              <input
                type="text"
                name="documentacion_regla"
                value={formData.documentacion_regla}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          </div>
        );

      case 'servicios':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            {[
              { name: 'banos_vestidores', label: 'Ba√±os y Vestidores' },
              { name: 'regaderas', label: 'Regaderas' },
              { name: 'comedor', label: 'Comedor' },
              { name: 'accesos_independientes', label: 'Accesos Independientes' },
              { name: 'caseta_seguridad', label: 'Caseta de Seguridad' },
              { name: 'estacionamiento', label: 'Estacionamiento' },
              { name: 'terreno_camiones', label: 'Terreno para Camiones' },
              { name: 'rutas_transporte', label: 'Rutas de Transporte' },
              { name: 'servicios_agua', label: 'Servicios de Agua' },
              { name: 'via_ferrocarril', label: 'V√≠a de Ferrocarril' }
            ].map((field) => (
              <div key={field.name}>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  {field.label}
                </label>
                <select
                  name={field.name}
                  value={formData[field.name as keyof typeof formData] as string}
                  onChange={handleChange}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px',
                    background: 'white'
                  }}
                >
                  <option value="No">No</option>
                  <option value="S√≠">S√≠</option>
                </select>
              </div>
            ))}
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Total de Pallets
              </label>
              <input
                type="text"
                name="total_pallet"
                value={formData.total_pallet}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          </div>
        );

      case 'observaciones':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Especificaciones Adicionales
              </label>
              <textarea
                name="especificaciones_adicionales"
                value={formData.especificaciones_adicionales}
                onChange={handleChange}
                rows={4}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px',
                  resize: 'vertical'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Observaciones
              </label>
              <textarea
                name="observaciones"
                value={formData.observaciones}
                onChange={handleChange}
                rows={4}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px',
                  resize: 'vertical'
                }}
              />
            </div>
          </div>
        );

      default:
        return null;
    }
  };

  if (fetching) {
    return (
      <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
        <div style={{ textAlign: 'center', color: '#64748b' }}>Cargando propiedad...</div>
      </div>
    );
  }

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ marginBottom: '32px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' }}>
            <Link 
              href="/dashboard/propiedades/industrial"
              style={{ 
                color: '#64748b', 
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              ‚Üê Volver a Propiedades Industriales
            </Link>
          </div>
          <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
            Editar Propiedad Industrial
          </h1>
          <p style={{ color: '#64748b', fontSize: '16px' }}>
            Modifique la informaci√≥n de la propiedad industrial
          </p>
        </div>

        {/* Navegaci√≥n por secciones */}
        <div style={{ 
          display: 'flex', 
          gap: '8px', 
          marginBottom: '24px',
          overflowX: 'auto',
          paddingBottom: '8px'
        }}>
          {sections.map((section) => (
            <button
              key={section.id}
              type="button"
              onClick={() => setActiveSection(section.id)}
              style={{
                padding: '12px 20px',
                border: 'none',
                borderRadius: '8px',
                background: activeSection === section.id ? '#181f42' : 'white',
                color: activeSection === section.id ? 'white' : '#374151',
                fontSize: '14px',
                fontWeight: '500',
                cursor: 'pointer',
                whiteSpace: 'nowrap',
                display: 'flex',
                alignItems: 'center',
                gap: '8px'
              }}
            >
              <span>{section.icon}</span>
              {section.label}
            </button>
          ))}
        </div>

        {/* Formulario */}
        <form onSubmit={handleSubmit}>
          <div style={{ 
            background: 'white', 
            borderRadius: '12px', 
            padding: '32px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0',
            marginBottom: '24px'
          }}>
            <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#2d3436', marginBottom: '24px' }}>
              {sections.find(s => s.id === activeSection)?.label}
            </h2>
            
            {renderSection()}
          </div>

          {/* Botones */}
          <div style={{ display: 'flex', gap: '16px', justifyContent: 'space-between', alignItems: 'center' }}>
            <div style={{ display: 'flex', gap: '16px' }}>
              {sections.map((section, index) => (
                activeSection !== section.id && (
                  <button
                    key={section.id}
                    type="button"
                    onClick={() => setActiveSection(section.id)}
                    style={{
                      padding: '8px 16px',
                      border: '1px solid #d1d5db',
                      borderRadius: '6px',
                      background: 'white',
                      color: '#374151',
                      fontSize: '12px',
                      fontWeight: '500',
                      cursor: 'pointer'
                    }}
                  >
                    {section.icon}
                  </button>
                )
              ))}
            </div>

            <div style={{ display: 'flex', gap: '16px' }}>
              <Link
                href="/dashboard/propiedades/industrial"
                style={{
                  padding: '12px 24px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  color: '#374151',
                  textDecoration: 'none',
                  fontSize: '14px',
                  fontWeight: '500'
                }}
              >
                Cancelar
              </Link>
              <button
                type="submit"
                disabled={loading}
                style={{
                  padding: '12px 24px',
                  background: loading ? '#9ca3af' : '#181f42',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  fontSize: '14px',
                  fontWeight: '500',
                  cursor: loading ? 'not-allowed' : 'pointer'
                }}
              >
                {loading ? 'Actualizando...' : 'Actualizar Propiedad'}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
}=== app/dashboard/propiedades/industrial/agregar/page.tsx ===
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { supabase } from '@/lib/supabaseClient';
import Link from 'next/link';

export default function AgregarPropiedadIndustrial() {
  const router = useRouter();
  const [loading, setLoading] = useState(false);
  const [activeSection, setActiveSection] = useState('basica');
  
  const [formData, setFormData] = useState({
    // INFORMACI√ìN B√ÅSICA
    marca: '',
    giro_industrial: '',
    ubicacion_coordenadas: '',
    radio_expansion: '',
    accesos_conectividad: '',
    precio_mn: '',
    cuota_mantenimiento: '',
    total_renta_cuota: '',
    precio_m2: '',

    // ESPECIFICACIONES T√âCNICAS
    superficie_total: '',
    superficie_almacen: '',
    oficinas_m2: '',
    tipo_nave: '',
    altura_minima: '',
    a√±o_construccion: '',
    capacidad_carga_piso: '',
    capacidad_electrica: '',
    tension_electrica: '',

    // INSTALACIONES Y SERVICIOS
    conectividad_fibra: 'No',
    energia_renovable: 'No',
    aislante_techo: 'No',
    tragaluz_natural: 'No',
    sistema_extraccion: 'No',
    andenes_carga: 'No',
    sellos_andenes: 'No',
    rampas_nivel: 'No',
    iluminacion_led: 'No',
    sistema_incendio: 'No',

    // DOCUMENTACI√ìN
    uso_suelo: '',
    documentacion_regla: '',

    // SERVICIOS COMPLEMENTARIOS
    banos_vestidores: 'No',
    regaderas: 'No',
    comedor: 'No',
    accesos_independientes: 'No',
    caseta_seguridad: 'No',
    estacionamiento: 'No',
    terreno_camiones: 'No',
    rutas_transporte: 'No',
    servicios_agua: 'No',
    via_ferrocarril: 'No',
    total_pallet: '',

    // OBSERVACIONES
    especificaciones_adicionales: '',
    observaciones: ''
  });

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data, error } = await supabase
        .from('propiedades_industriales')
        .insert([{
          // INFORMACI√ìN B√ÅSICA
          marca: formData.marca,
          giro_industrial: formData.giro_industrial,
          ubicacion_coordenadas: formData.ubicacion_coordenadas,
          radio_expansion: formData.radio_expansion,
          accesos_conectividad: formData.accesos_conectividad,
          precio_mn: formData.precio_mn ? parseFloat(formData.precio_mn) : null,
          cuota_mantenimiento: formData.cuota_mantenimiento ? parseFloat(formData.cuota_mantenimiento) : null,
          total_renta_cuota: formData.total_renta_cuota ? parseFloat(formData.total_renta_cuota) : null,
          precio_m2: formData.precio_m2 ? parseFloat(formData.precio_m2) : null,

          // ESPECIFICACIONES T√âCNICAS
          superficie_total: formData.superficie_total ? parseFloat(formData.superficie_total) : null,
          superficie_almacen: formData.superficie_almacen ? parseFloat(formData.superficie_almacen) : null,
          oficinas_m2: formData.oficinas_m2 ? parseFloat(formData.oficinas_m2) : null,
          tipo_nave: formData.tipo_nave,
          altura_minima: formData.altura_minima ? parseFloat(formData.altura_minima) : null,
          a√±o_construccion: formData.a√±o_construccion ? parseInt(formData.a√±o_construccion) : null,
          capacidad_carga_piso: formData.capacidad_carga_piso ? parseFloat(formData.capacidad_carga_piso) : null,
          capacidad_electrica: formData.capacidad_electrica ? parseFloat(formData.capacidad_electrica) : null,
          tension_electrica: formData.tension_electrica,

          // INSTALACIONES Y SERVICIOS
          conectividad_fibra: formData.conectividad_fibra,
          energia_renovable: formData.energia_renovable,
          aislante_techo: formData.aislante_techo,
          tragaluz_natural: formData.tragaluz_natural,
          sistema_extraccion: formData.sistema_extraccion,
          andenes_carga: formData.andenes_carga,
          sellos_andenes: formData.sellos_andenes,
          rampas_nivel: formData.rampas_nivel,
          iluminacion_led: formData.iluminacion_led,
          sistema_incendio: formData.sistema_incendio,

          // DOCUMENTACI√ìN
          uso_suelo: formData.uso_suelo,
          documentacion_regla: formData.documentacion_regla,

          // SERVICIOS COMPLEMENTARIOS
          banos_vestidores: formData.banos_vestidores,
          regaderas: formData.regaderas,
          comedor: formData.comedor,
          accesos_independientes: formData.accesos_independientes,
          caseta_seguridad: formData.caseta_seguridad,
          estacionamiento: formData.estacionamiento,
          terreno_camiones: formData.terreno_camiones,
          rutas_transporte: formData.rutas_transporte,
          servicios_agua: formData.servicios_agua,
          via_ferrocarril: formData.via_ferrocarril,
          total_pallet: formData.total_pallet,

          // OBSERVACIONES
          especificaciones_adicionales: formData.especificaciones_adicionales,
          observaciones: formData.observaciones
        }])
        .select();

      if (error) {
        throw error;
      }

      alert('Propiedad industrial agregada correctamente!');
      router.push('/dashboard/propiedades/industrial');
      
    } catch (error) {
      console.error('Error al agregar propiedad:', error);
      alert('Error al agregar la propiedad');
    } finally {
      setLoading(false);
    }
  };

  const sections = [
    { id: 'basica', label: 'Informaci√≥n B√°sica', icon: 'üìã' },
    { id: 'tecnicas', label: 'Especificaciones T√©cnicas', icon: 'üèóÔ∏è' },
    { id: 'instalaciones', label: 'Instalaciones', icon: '‚ö°' },
    { id: 'documentacion', label: 'Documentaci√≥n', icon: 'üìÑ' },
    { id: 'servicios', label: 'Servicios', icon: 'üöö' },
    { id: 'observaciones', label: 'Observaciones', icon: 'üìù' }
  ];

  const renderSection = () => {
    switch(activeSection) {
      case 'basica':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Marca/Nombre *
              </label>
              <input
                type="text"
                name="marca"
                value={formData.marca}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
                required
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Giro Industrial
              </label>
              <input
                type="text"
                name="giro_industrial"
                value={formData.giro_industrial}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Coordenadas Ubicaci√≥n
              </label>
              <input
                type="text"
                name="ubicacion_coordenadas"
                value={formData.ubicacion_coordenadas}
                onChange={handleChange}
                placeholder="19.432608,-99.133209"
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Radio de Expansi√≥n
              </label>
              <input
                type="text"
                name="radio_expansion"
                value={formData.radio_expansion}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Accesos y Conectividad
              </label>
              <input
                type="text"
                name="accesos_conectividad"
                value={formData.accesos_conectividad}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Precio (MXN)
              </label>
              <input
                type="number"
                step="0.01"
                name="precio_mn"
                value={formData.precio_mn}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Cuota Mantenimiento
              </label>
              <input
                type="number"
                step="0.01"
                name="cuota_mantenimiento"
                value={formData.cuota_mantenimiento}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Precio por m¬≤
              </label>
              <input
                type="number"
                step="0.01"
                name="precio_m2"
                value={formData.precio_m2}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          </div>
        );

      case 'tecnicas':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Superficie Total (m¬≤)
              </label>
              <input
                type="number"
                step="0.01"
                name="superficie_total"
                value={formData.superficie_total}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Superficie Almac√©n (m¬≤)
              </label>
              <input
                type="number"
                step="0.01"
                name="superficie_almacen"
                value={formData.superficie_almacen}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Oficinas (m¬≤)
              </label>
              <input
                type="number"
                step="0.01"
                name="oficinas_m2"
                value={formData.oficinas_m2}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Tipo de Nave
              </label>
              <input
                type="text"
                name="tipo_nave"
                value={formData.tipo_nave}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Altura M√≠nima (m)
              </label>
              <input
                type="number"
                step="0.01"
                name="altura_minima"
                value={formData.altura_minima}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                A√±o de Construcci√≥n
              </label>
              <input
                type="number"
                name="a√±o_construccion"
                value={formData.a√±o_construccion}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Capacidad Carga Piso (kg/m¬≤)
              </label>
              <input
                type="number"
                step="0.01"
                name="capacidad_carga_piso"
                value={formData.capacidad_carga_piso}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Capacidad El√©ctrica (kVA)
              </label>
              <input
                type="number"
                step="0.01"
                name="capacidad_electrica"
                value={formData.capacidad_electrica}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Tensi√≥n El√©ctrica
              </label>
              <input
                type="text"
                name="tension_electrica"
                value={formData.tension_electrica}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          </div>
        );

      case 'instalaciones':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            {[
              { name: 'conectividad_fibra', label: 'Conectividad Fibra √ìptica' },
              { name: 'energia_renovable', label: 'Energ√≠a Renovable' },
              { name: 'aislante_techo', label: 'Aislante en Techo' },
              { name: 'tragaluz_natural', label: 'Tragaluz Natural' },
              { name: 'sistema_extraccion', label: 'Sistema de Extracci√≥n' },
              { name: 'andenes_carga', label: 'Andenes de Carga' },
              { name: 'sellos_andenes', label: 'Sellos en Andenes' },
              { name: 'rampas_nivel', label: 'Rampas a Nivel' },
              { name: 'iluminacion_led', label: 'Iluminaci√≥n LED' },
              { name: 'sistema_incendio', label: 'Sistema Contra Incendio' }
            ].map((field) => (
              <div key={field.name}>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  {field.label}
                </label>
                <select
                  name={field.name}
                  value={formData[field.name as keyof typeof formData] as string}
                  onChange={handleChange}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px',
                    background: 'white'
                  }}
                >
                  <option value="No">No</option>
                  <option value="S√≠">S√≠</option>
                </select>
              </div>
            ))}
          </div>
        );

      case 'documentacion':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Uso de Suelo
              </label>
              <input
                type="text"
                name="uso_suelo"
                value={formData.uso_suelo}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Documentaci√≥n en Regla
              </label>
              <input
                type="text"
                name="documentacion_regla"
                value={formData.documentacion_regla}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          </div>
        );

      case 'servicios':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            {[
              { name: 'banos_vestidores', label: 'Ba√±os y Vestidores' },
              { name: 'regaderas', label: 'Regaderas' },
              { name: 'comedor', label: 'Comedor' },
              { name: 'accesos_independientes', label: 'Accesos Independientes' },
              { name: 'caseta_seguridad', label: 'Caseta de Seguridad' },
              { name: 'estacionamiento', label: 'Estacionamiento' },
              { name: 'terreno_camiones', label: 'Terreno para Camiones' },
              { name: 'rutas_transporte', label: 'Rutas de Transporte' },
              { name: 'servicios_agua', label: 'Servicios de Agua' },
              { name: 'via_ferrocarril', label: 'V√≠a de Ferrocarril' }
            ].map((field) => (
              <div key={field.name}>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  {field.label}
                </label>
                <select
                  name={field.name}
                  value={formData[field.name as keyof typeof formData] as string}
                  onChange={handleChange}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px',
                    background: 'white'
                  }}
                >
                  <option value="No">No</option>
                  <option value="S√≠">S√≠</option>
                </select>
              </div>
            ))}
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Total de Pallets
              </label>
              <input
                type="text"
                name="total_pallet"
                value={formData.total_pallet}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          </div>
        );

      case 'observaciones':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Especificaciones Adicionales
              </label>
              <textarea
                name="especificaciones_adicionales"
                value={formData.especificaciones_adicionales}
                onChange={handleChange}
                rows={4}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px',
                  resize: 'vertical'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Observaciones
              </label>
              <textarea
                name="observaciones"
                value={formData.observaciones}
                onChange={handleChange}
                rows={4}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px',
                  resize: 'vertical'
                }}
              />
            </div>
          </div>
        );

      default:
        return null;
    }
  };

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ marginBottom: '32px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' }}>
            <Link 
              href="/dashboard/propiedades/industrial"
              style={{ 
                color: '#64748b', 
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              ‚Üê Volver a Propiedades Industriales
            </Link>
          </div>
          <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
            Agregar Propiedad Industrial
          </h1>
          <p style={{ color: '#64748b', fontSize: '16px' }}>
            Complete la informaci√≥n de la nueva propiedad industrial
          </p>
        </div>

        {/* Navegaci√≥n por secciones */}
        <div style={{ 
          display: 'flex', 
          gap: '8px', 
          marginBottom: '24px',
          overflowX: 'auto',
          paddingBottom: '8px'
        }}>
          {sections.map((section) => (
            <button
              key={section.id}
              type="button"
              onClick={() => setActiveSection(section.id)}
              style={{
                padding: '12px 20px',
                border: 'none',
                borderRadius: '8px',
                background: activeSection === section.id ? '#181f42' : 'white',
                color: activeSection === section.id ? 'white' : '#374151',
                fontSize: '14px',
                fontWeight: '500',
                cursor: 'pointer',
                whiteSpace: 'nowrap',
                display: 'flex',
                alignItems: 'center',
                gap: '8px'
              }}
            >
              <span>{section.icon}</span>
              {section.label}
            </button>
          ))}
        </div>

        {/* Formulario */}
        <form onSubmit={handleSubmit}>
          <div style={{ 
            background: 'white', 
            borderRadius: '12px', 
            padding: '32px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0',
            marginBottom: '24px'
          }}>
            <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#2d3436', marginBottom: '24px' }}>
              {sections.find(s => s.id === activeSection)?.label}
            </h2>
            
            {renderSection()}
          </div>

          {/* Botones */}
          <div style={{ display: 'flex', gap: '16px', justifyContent: 'space-between', alignItems: 'center' }}>
            <div style={{ display: 'flex', gap: '16px' }}>
              {sections.map((section, index) => (
                activeSection !== section.id && (
                  <button
                    key={section.id}
                    type="button"
                    onClick={() => setActiveSection(section.id)}
                    style={{
                      padding: '8px 16px',
                      border: '1px solid #d1d5db',
                      borderRadius: '6px',
                      background: 'white',
                      color: '#374151',
                      fontSize: '12px',
                      fontWeight: '500',
                      cursor: 'pointer'
                    }}
                  >
                    {section.icon}
                  </button>
                )
              ))}
            </div>

            <div style={{ display: 'flex', gap: '16px' }}>
              <Link
                href="/dashboard/propiedades/industrial"
                style={{
                  padding: '12px 24px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  color: '#374151',
                  textDecoration: 'none',
                  fontSize: '14px',
                  fontWeight: '500'
                }}
              >
                Cancelar
              </Link>
              <button
                type="submit"
                disabled={loading}
                style={{
                  padding: '12px 24px',
                  background: loading ? '#9ca3af' : '#181f42',
                  color: 'white',
                  border: 'none',
                  borderRadius: '8px',
                  fontSize: '14px',
                  fontWeight: '500',
                  cursor: loading ? 'not-allowed' : 'pointer'
                }}
              >
                {loading ? 'Guardando...' : 'Guardar Propiedad'}
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  );
}=== app/dashboard/propiedades/industrial/page.tsx ===
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import { supabase } from '@/lib/supabaseClient';

interface PropiedadIndustrial {
  id: string;
  marca: string;
  giro_industrial: string;
  ubicacion_coordenadas: string;
  precio_mn: number;
  superficie_total: number;
  a√±o_construccion: number;
  estatus: string;
}

export default function PropiedadesIndustrialPage() {
  const [propiedades, setPropiedades] = useState<PropiedadIndustrial[]>([]);
  const [loading, setLoading] = useState(true);
  const [deletingId, setDeletingId] = useState<string | null>(null);

  useEffect(() => {
    fetchPropiedades();
  }, []);

  const fetchPropiedades = async () => {
    try {
      const { data, error } = await supabase
        .from('propiedades_industriales')
        .select('*')
        .order('creado_en', { ascending: false });

      if (error) throw error;
      setPropiedades(data || []);
    } catch (error) {
      console.error('Error fetching propiedades:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleEliminarPropiedad = async (id: string, nombre: string) => {
    if (!confirm(`¬øEst√°s seguro de que quieres eliminar la propiedad "${nombre}"? Esta acci√≥n no se puede deshacer.`)) {
      return;
    }

    setDeletingId(id);
    
    try {
      const { error } = await supabase
        .from('propiedades_industriales')
        .delete()
        .eq('id', id);

      if (error) {
        console.error('Error eliminando propiedad:', error);
        alert(`Error al eliminar propiedad: ${error.message}`);
        throw error;
      }

      // Actualizar la lista eliminando la propiedad
      setPropiedades(prev => prev.filter(propiedad => propiedad.id !== id));
      alert('Propiedad eliminada correctamente');
      
    } catch (error) {
      console.error('Error eliminando propiedad:', error);
    } finally {
      setDeletingId(null);
    }
  };

  if (loading) {
    return (
      <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
        <div style={{ textAlign: 'center', color: '#64748b' }}>Cargando propiedades...</div>
      </div>
    );
  }

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa' }}>
      {/* Header */}
      <div style={{ 
        background: 'white', 
        borderBottom: '1px solid #e2e8f0', 
        padding: '24px 32px' 
      }}>
        {/* Bot√≥n para regresar al Dashboard */}
        <div style={{ marginBottom: '16px' }}>
          <Link 
            href="/dashboard"
            style={{ 
              color: '#64748b', 
              textDecoration: 'none',
              fontSize: '14px',
              fontWeight: '500',
              display: 'inline-flex',
              alignItems: 'center',
              gap: '8px'
            }}
          >
            ‚Üê Volver al Dashboard
          </Link>
        </div>

        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
          <div>
            <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
              Propiedades Industriales
            </h1>
            <p style={{ color: '#64748b', fontSize: '16px' }}>
              Gesti√≥n de bodegas y naves industriales
            </p>
          </div>
          <Link
            href="/dashboard/propiedades/industrial/agregar"
            style={{
              background: '#181f42',
              color: 'white',
              padding: '12px 24px',
              borderRadius: '8px',
              textDecoration: 'none',
              fontSize: '14px',
              fontWeight: '500'
            }}
          >
            + Nueva Propiedad
          </Link>
        </div>
      </div>

      {/* Contenido */}
      <div style={{ padding: '32px' }}>
        {/* Estad√≠sticas */}
        <div style={{ 
          display: 'grid', 
          gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', 
          gap: '20px', 
          marginBottom: '32px' 
        }}>
          <div style={{ 
            background: 'white', 
            padding: '24px', 
            borderRadius: '12px',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436' }}>
              {propiedades.length}
            </div>
            <div style={{ fontSize: '14px', color: '#64748b' }}>Total Propiedades</div>
          </div>
          
          <div style={{ 
            background: 'white', 
            padding: '24px', 
            borderRadius: '12px',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436' }}>
              {propiedades.filter(p => p.precio_mn && p.precio_mn > 0).length}
            </div>
            <div style={{ fontSize: '14px', color: '#64748b' }}>Con Precio</div>
          </div>
          
          <div style={{ 
            background: 'white', 
            padding: '24px', 
            borderRadius: '12px',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436' }}>
              {propiedades.reduce((sum, prop) => sum + (prop.superficie_total || 0), 0)} m¬≤
            </div>
            <div style={{ fontSize: '14px', color: '#64748b' }}>Superficie Total</div>
          </div>
          
          <div style={{ 
            background: 'white', 
            padding: '24px', 
            borderRadius: '12px',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436' }}>
              ${propiedades.reduce((sum, prop) => sum + (prop.precio_mn || 0), 0).toLocaleString()}
            </div>
            <div style={{ fontSize: '14px', color: '#64748b' }}>Valor Total</div>
          </div>
        </div>

        {/* Lista de propiedades */}
        <div style={{ 
          background: 'white', 
          borderRadius: '12px',
          border: '1px solid #e2e8f0',
          overflow: 'hidden'
        }}>
          <div style={{ overflowX: 'auto' }}>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <thead>
                <tr style={{ background: '#f8f9fa' }}>
                  <th style={{ padding: '16px', textAlign: 'left', fontWeight: '600', fontSize: '12px', color: '#64748b', textTransform: 'uppercase' }}>
                    Propiedad
                  </th>
                  <th style={{ padding: '16px', textAlign: 'left', fontWeight: '600', fontSize: '12px', color: '#64748b', textTransform: 'uppercase' }}>
                    Giro
                  </th>
                  <th style={{ padding: '16px', textAlign: 'left', fontWeight: '600', fontSize: '12px', color: '#64748b', textTransform: 'uppercase' }}>
                    Ubicaci√≥n
                  </th>
                  <th style={{ padding: '16px', textAlign: 'left', fontWeight: '600', fontSize: '12px', color: '#64748b', textTransform: 'uppercase' }}>
                    Superficie
                  </th>
                  <th style={{ padding: '16px', textAlign: 'left', fontWeight: '600', fontSize: '12px', color: '#64748b', textTransform: 'uppercase' }}>
                    Precio
                  </th>
                  <th style={{ padding: '16px', textAlign: 'left', fontWeight: '600', fontSize: '12px', color: '#64748b', textTransform: 'uppercase' }}>
                    Acciones
                  </th>
                </tr>
              </thead>
              <tbody>
                {propiedades.map((propiedad) => (
                  <tr key={propiedad.id} style={{ borderTop: '1px solid #e2e8f0' }}>
                    <td style={{ padding: '16px' }}>
                      <div style={{ fontWeight: '600', color: '#2d3436' }}>
                        {propiedad.marca || 'Sin nombre'}
                      </div>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ color: '#2d3436' }}>{propiedad.giro_industrial || 'No especificado'}</div>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ color: '#64748b', fontSize: '14px' }}>
                        {propiedad.ubicacion_coordenadas || 'Sin ubicaci√≥n'}
                      </div>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ fontWeight: '500' }}>
                        {propiedad.superficie_total ? `${propiedad.superficie_total} m¬≤` : 'N/A'}
                      </div>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ fontWeight: '600', color: '#181f42' }}>
                        {propiedad.precio_mn ? `$${propiedad.precio_mn.toLocaleString()}` : 'Consultar'}
                      </div>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ display: 'flex', gap: '12px' }}>
                        <Link 
                          href={`/dashboard/propiedades/industrial/editar/${propiedad.id}`}
                          style={{ 
                            color: '#181f42',
                            textDecoration: 'none',
                            fontSize: '14px',
                            fontWeight: '500'
                          }}
                        >
                          Editar
                        </Link>
                        <button
                          onClick={() => handleEliminarPropiedad(propiedad.id, propiedad.marca || 'esta propiedad')}
                          disabled={deletingId === propiedad.id}
                          style={{
                            color: deletingId === propiedad.id ? '#9ca3af' : '#dc2626',
                            background: 'none',
                            border: 'none',
                            fontSize: '14px',
                            fontWeight: '500',
                            cursor: deletingId === propiedad.id ? 'not-allowed' : 'pointer'
                          }}
                        >
                          {deletingId === propiedad.id ? 'Eliminando...' : 'Eliminar'}
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {propiedades.length === 0 && (
            <div style={{ textAlign: 'center', padding: '60px 20px', color: '#64748b' }}>
              <div style={{ fontSize: '48px', marginBottom: '16px', opacity: '0.5' }}>üè≠</div>
              <h3 style={{ marginBottom: '8px', color: '#2d3436' }}>No hay propiedades industriales</h3>
              <p style={{ marginBottom: '24px' }}>Comienza agregando la primera propiedad industrial</p>
              <Link
                href="/dashboard/propiedades/industrial/agregar"
                style={{
                  background: '#181f42',
                  color: 'white',
                  padding: '12px 24px',
                  borderRadius: '8px',
                  textDecoration: 'none',
                  fontSize: '14px',
                  fontWeight: '500'
                }}
              >
                + Agregar Primera Propiedad
              </Link>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}=== app/dashboard/propiedades/comercial/editar/[id]/page.tsx ===
'use client';

import { useState, useEffect } from 'react';
import { useRouter, useParams } from 'next/navigation';
import { supabase } from '@/lib/supabaseClient';
import Link from 'next/link';

export default function EditarPropiedadComercial() {
  const router = useRouter();
  const params = useParams();
  const id = params.id as string;
  
  const [loading, setLoading] = useState(false);
  const [fetching, setFetching] = useState(true);
  const [activeSection, setActiveSection] = useState('basica');
  
  const [formData, setFormData] = useState({
    // INFORMACI√ìN B√ÅSICA
    nombre_plaza: '',
    ubicacion: '',
    superficie_terreno: '',
    numero_locales: '',
    
    // ESTACIONAMIENTO
    cajones_estacionamiento: '',
    motopuertos: '',
    ciclopuertos: '',
    
    // COMUNICACI√ìN VERTICAL
    escaleras_estaticas: '',
    escaleras_emergencia: '',
    elevador: '',
    
    // EQUIPO OPERATIVO Y SERVICIOS
    gas_lp: '',
    gas_butano: '',
    gas_natural: '',
    agua: '',
    luz: '',
    extraccion_humo: '',
    trampas_grasa: '',
    equipo_bombero: '',
    automatizacion_agua: '',
    capacidad_sisterna: '',
    drenaje_publico: '',
    paneles_solares: '',
    
    // CONECTIVIDAD
    transformador_bifasico: '',
    transformador_trifasico: '',
    centro_carga: '',
    acceso_azotea: '',
    acceso_trasero_pasillo_servicios: '',
    ducteria_voz_datos: '',
    
    // ENTREGA DEL LOCAL
    obra_gris: '',
    obra_blanca: '',
    obra_negra: '',
    concreto_pulido_piso: '',
    canalizacion_voz_datos: '',
    preparacion_hidraulica_electrica_sanitaria: '',
    puertas_cristal_aluminio_ventanales: '',
    muros_divisorios: '',
    salida_hidrosanitarias: '',
    acometida_electrica_telefonia_tv_subterranea: '',
    preparacion_drenaje_wc: '',
    preparacion_mini_split_aire_acondicionado: '',
    valvulas_linea_agua_potable: '',
    interruptor_electrico_principal: '',
    
    // INFORMACI√ìN DEL INMUEBLE
    altura_piso_techo_planta_baja: '',
    altura_piso_techo_planta_alta: '',
    banos_publicos: '',
    circuito_cerrado: '',
    seguridad_24hrs: '',
    modulo_administracion: '',
    
    // DOCUMENTOS PARA ARRENDAMIENTOS
    reglamento_general_plaza: '',
    acta_entrega_local: '',
    totem_precios: '',
    anuncio_luminoso_normal: '',
    reglamento_colocacion_anuncio: '',
    seguro_local: '',
    
    // CONDICIONES DE ARRENDAMIENTO
    contrato_justicia_alternativa: '',
    investigacion: '',
    anos_forzoso_contrato: '',
    anos_opcionales_contrato: '',
    meses_renta_adelantada: '',
    meses_deposito: '',
    inpc: '',
    meses_gracia: '',
    mantenimiento: '',
    exclusividad_giro: '',
    entrega_locales: '',
    
    // PRECIOS Y RENTAS
    precio_venta: '',
    renta_mensual: '',
    cuota_mantenimiento: '',
    
    // OBSERVACIONES GENERALES
    observaciones_generales: '',
    especificaciones_adicionales: ''
  });

  // Cargar los datos de la propiedad
  useEffect(() => {
    if (id) {
      fetchPropiedad();
    }
  }, [id]);

  const fetchPropiedad = async () => {
    try {
        console.log('üîç ID de la propiedad:', id);
    console.log('üîç Buscando propiedad con ID:', id);
      const { data, error } = await supabase
        .from('propiedades_comerciales')
        .select('*')
        .eq('id', id)
        .single();
console.log('üì¶ Data recibida de Supabase:', data);
    console.log('‚ùå Error (si hay):', error);
      if (error) throw error;

      if (data) {
        setFormData({
          // INFORMACI√ìN B√ÅSICA
          nombre_plaza: data.nombre_plaza || '',
          ubicacion: data.ubicacion || '',
          superficie_terreno: data.superficie_terreno?.toString() || '',
          numero_locales: data.numero_locales?.toString() || '',
          
          // ESTACIONAMIENTO
          cajones_estacionamiento: data.cajones_estacionamiento?.toString() || '',
          motopuertos: data.motopuertos?.toString() || '',
          ciclopuertos: data.ciclopuertos?.toString() || '',
          
          // COMUNICACI√ìN VERTICAL
          escaleras_estaticas: data.escaleras_estaticas || '',
          escaleras_emergencia: data.escaleras_emergencia || '',
          elevador: data.elevador || '',
          
          // EQUIPO OPERATIVO Y SERVICIOS
          gas_lp: data.gas_lp || '',
          gas_butano: data.gas_butano || '',
          gas_natural: data.gas_natural || '',
          agua: data.agua || '',
          luz: data.luz || '',
          extraccion_humo: data.extraccion_humo || '',
          trampas_grasa: data.trampas_grasa || '',
          equipo_bombero: data.equipo_bombero || '',
          automatizacion_agua: data.automatizacion_agua || '',
          capacidad_sisterna: data.capacidad_sisterna || '',
          drenaje_publico: data.drenaje_publico || '',
          paneles_solares: data.paneles_solares || '',
          
          // CONECTIVIDAD
          transformador_bifasico: data.transformador_bifasico || '',
          transformador_trifasico: data.transformador_trifasico || '',
          centro_carga: data.centro_carga || '',
          acceso_azotea: data.acceso_azotea || '',
          acceso_trasero_pasillo_servicios: data.acceso_trasero_pasillo_servicios || '',
          ducteria_voz_datos: data.ducteria_voz_datos || '',
          
          // ENTREGA DEL LOCAL
          obra_gris: data.obra_gris || '',
          obra_blanca: data.obra_blanca || '',
          obra_negra: data.obra_negra || '',
          concreto_pulido_piso: data.concreto_pulido_piso || '',
          canalizacion_voz_datos: data.canalizacion_voz_datos || '',
          preparacion_hidraulica_electrica_sanitaria: data.preparacion_hidraulica_electrica_sanitaria || '',
          puertas_cristal_aluminio_ventanales: data.puertas_cristal_aluminio_ventanales || '',
          muros_divisorios: data.muros_divisorios || '',
          salida_hidrosanitarias: data.salida_hidrosanitarias || '',
          acometida_electrica_telefonia_tv_subterranea: data.acometida_electrica_telefonia_tv_subterranea || '',
          preparacion_drenaje_wc: data.preparacion_drenaje_wc || '',
          preparacion_mini_split_aire_acondicionado: data.preparacion_mini_split_aire_acondicionado || '',
          valvulas_linea_agua_potable: data.valvulas_linea_agua_potable || '',
          interruptor_electrico_principal: data.interruptor_electrico_principal || '',
          
          // INFORMACI√ìN DEL INMUEBLE
          altura_piso_techo_planta_baja: data.altura_piso_techo_planta_baja?.toString() || '',
          altura_piso_techo_planta_alta: data.altura_piso_techo_planta_alta?.toString() || '',
          banos_publicos: data.banos_publicos || '',
          circuito_cerrado: data.circuito_cerrado || '',
          seguridad_24hrs: data.seguridad_24hrs || '',
          modulo_administracion: data.modulo_administracion || '',
          
          // DOCUMENTOS PARA ARRENDAMIENTOS
          reglamento_general_plaza: data.reglamento_general_plaza || '',
          acta_entrega_local: data.acta_entrega_local || '',
          totem_precios: data.totem_precios || '',
          anuncio_luminoso_normal: data.anuncio_luminoso_normal || '',
          reglamento_colocacion_anuncio: data.reglamento_colocacion_anuncio || '',
          seguro_local: data.seguro_local || '',
          
          // CONDICIONES DE ARRENDAMIENTO
          contrato_justicia_alternativa: data.contrato_justicia_alternativa || '',
          investigacion: data.investigacion || '',
          anos_forzoso_contrato: data.anos_forzoso_contrato || '',
          anos_opcionales_contrato: data.anos_opcionales_contrato || '',
          meses_renta_adelantada: data.meses_renta_adelantada?.toString() || '',
          meses_deposito: data.meses_deposito?.toString() || '',
          inpc: data.inpc || '',
          meses_gracia: data.meses_gracia?.toString() || '',
          mantenimiento: data.mantenimiento || '',
          exclusividad_giro: data.exclusividad_giro || '',
          entrega_locales: data.entrega_locales || '',
          
          // PRECIOS Y RENTAS
          precio_venta: data.precio_venta?.toString() || '',
          renta_mensual: data.renta_mensual?.toString() || '',
          cuota_mantenimiento: data.cuota_mantenimiento?.toString() || '',
          
          // OBSERVACIONES GENERALES
          observaciones_generales: data.observaciones_generales || '',
          especificaciones_adicionales: data.especificaciones_adicionales || ''
        });
      }
    } catch (error) {
      console.error('Error fetching propiedad:', error);
      alert('Error al cargar la propiedad');
    } finally {
      setFetching(false);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const formatCurrency = (value: string) => {
    const numericValue = parseFloat(value.replace(/,/g, ''));
    return isNaN(numericValue) ? null : numericValue;
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { error } = await supabase
        .from('propiedades_comerciales')
        .update({
          // INFORMACI√ìN B√ÅSICA
          nombre_plaza: formData.nombre_plaza,
          ubicacion: formData.ubicacion,
          superficie_terreno: formData.superficie_terreno ? parseFloat(formData.superficie_terreno) : null,
          numero_locales: formData.numero_locales ? parseInt(formData.numero_locales) : null,
          
          // ESTACIONAMIENTO
          cajones_estacionamiento: formData.cajones_estacionamiento ? parseInt(formData.cajones_estacionamiento) : null,
          motopuertos: formData.motopuertos ? parseInt(formData.motopuertos) : null,
          ciclopuertos: formData.ciclopuertos ? parseInt(formData.ciclopuertos) : null,
          
          // COMUNICACI√ìN VERTICAL
          escaleras_estaticas: formData.escaleras_estaticas,
          escaleras_emergencia: formData.escaleras_emergencia,
          elevador: formData.elevador,
          
          // EQUIPO OPERATIVO Y SERVICIOS
          gas_lp: formData.gas_lp,
          gas_butano: formData.gas_butano,
          gas_natural: formData.gas_natural,
          agua: formData.agua,
          luz: formData.luz,
          extraccion_humo: formData.extraccion_humo,
          trampas_grasa: formData.trampas_grasa,
          equipo_bombero: formData.equipo_bombero,
          automatizacion_agua: formData.automatizacion_agua,
          capacidad_sisterna: formData.capacidad_sisterna,
          drenaje_publico: formData.drenaje_publico,
          paneles_solares: formData.paneles_solares,
          
          // CONECTIVIDAD
          transformador_bifasico: formData.transformador_bifasico,
          transformador_trifasico: formData.transformador_trifasico,
          centro_carga: formData.centro_carga,
          acceso_azotea: formData.acceso_azotea,
          acceso_trasero_pasillo_servicios: formData.acceso_trasero_pasillo_servicios,
          ducteria_voz_datos: formData.ducteria_voz_datos,
          
          // ENTREGA DEL LOCAL
          obra_gris: formData.obra_gris,
          obra_blanca: formData.obra_blanca,
          obra_negra: formData.obra_negra,
          concreto_pulido_piso: formData.concreto_pulido_piso,
          canalizacion_voz_datos: formData.canalizacion_voz_datos,
          preparacion_hidraulica_electrica_sanitaria: formData.preparacion_hidraulica_electrica_sanitaria,
          puertas_cristal_aluminio_ventanales: formData.puertas_cristal_aluminio_ventanales,
          muros_divisorios: formData.muros_divisorios,
          salida_hidrosanitarias: formData.salida_hidrosanitarias,
          acometida_electrica_telefonia_tv_subterranea: formData.acometida_electrica_telefonia_tv_subterranea,
          preparacion_drenaje_wc: formData.preparacion_drenaje_wc,
          preparacion_mini_split_aire_acondicionado: formData.preparacion_mini_split_aire_acondicionado,
          valvulas_linea_agua_potable: formData.valvulas_linea_agua_potable,
          interruptor_electrico_principal: formData.interruptor_electrico_principal,
          
          // INFORMACI√ìN DEL INMUEBLE
          altura_piso_techo_planta_baja: formData.altura_piso_techo_planta_baja ? parseFloat(formData.altura_piso_techo_planta_baja) : null,
          altura_piso_techo_planta_alta: formData.altura_piso_techo_planta_alta ? parseFloat(formData.altura_piso_techo_planta_alta) : null,
          banos_publicos: formData.banos_publicos,
          circuito_cerrado: formData.circuito_cerrado,
          seguridad_24hrs: formData.seguridad_24hrs,
          modulo_administracion: formData.modulo_administracion,
          
          // DOCUMENTOS PARA ARRENDAMIENTOS
          reglamento_general_plaza: formData.reglamento_general_plaza,
          acta_entrega_local: formData.acta_entrega_local,
          totem_precios: formData.totem_precios,
          anuncio_luminoso_normal: formData.anuncio_luminoso_normal,
          reglamento_colocacion_anuncio: formData.reglamento_colocacion_anuncio,
          seguro_local: formData.seguro_local,
          
          // CONDICIONES DE ARRENDAMIENTO
          contrato_justicia_alternativa: formData.contrato_justicia_alternativa,
          investigacion: formData.investigacion,
          anos_forzoso_contrato: formData.anos_forzoso_contrato,
          anos_opcionales_contrato: formData.anos_opcionales_contrato,
          meses_renta_adelantada: formData.meses_renta_adelantada ? parseInt(formData.meses_renta_adelantada) : null,
          meses_deposito: formData.meses_deposito ? parseInt(formData.meses_deposito) : null,
          inpc: formData.inpc,
          meses_gracia: formData.meses_gracia ? parseInt(formData.meses_gracia) : null,
          mantenimiento: formData.mantenimiento,
          exclusividad_giro: formData.exclusividad_giro,
          entrega_locales: formData.entrega_locales,
          
          // PRECIOS Y RENTAS
          precio_venta: formatCurrency(formData.precio_venta),
          renta_mensual: formatCurrency(formData.renta_mensual),
          cuota_mantenimiento: formatCurrency(formData.cuota_mantenimiento),
          
          // OBSERVACIONES GENERALES
          observaciones_generales: formData.observaciones_generales,
          especificaciones_adicionales: formData.especificaciones_adicionales
        })
        .eq('id', id);

      if (error) {
        throw error;
      }

      alert('Propiedad comercial actualizada correctamente!');
      router.push('/dashboard/propiedades/comercial');
      
    } catch (error) {
      console.error('Error al actualizar propiedad:', error);
      alert('Error al actualizar la propiedad');
    } finally {
      setLoading(false);
    }
  };

  const sections = [
    { id: 'basica', label: 'Informaci√≥n B√°sica', icon: 'üìã' },
    { id: 'estacionamiento', label: 'Estacionamiento', icon: 'üöó' },
    { id: 'comunicacion', label: 'Comunicaci√≥n Vertical', icon: 'üõó' },
    { id: 'equipo', label: 'Equipo Operativo', icon: '‚öôÔ∏è' },
    { id: 'conectividad', label: 'Conectividad', icon: 'üîå' },
    { id: 'entrega', label: 'Entrega del Local', icon: 'üèóÔ∏è' },
    { id: 'inmueble', label: 'Informaci√≥n del Inmueble', icon: 'üè¢' },
    { id: 'documentos', label: 'Documentos', icon: 'üìÑ' },
    { id: 'condiciones', label: 'Condiciones', icon: 'üìù' },
    { id: 'precios', label: 'Precios y Rentas', icon: 'üí∞' },
    { id: 'observaciones', label: 'Observaciones', icon: 'üìã' }
  ];
const renderSection = () => {
  switch(activeSection) {
    case 'basica':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          <div>
            <label 
              htmlFor="nombre_plaza"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Nombre de la Plaza *
            </label>
            <input
              type="text"
              id="nombre_plaza"
              name="nombre_plaza"
              value={formData.nombre_plaza}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
              required
            />
          </div>

          <div>
            <label 
              htmlFor="ubicacion"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Ubicaci√≥n
            </label>
            <input
              type="text"
              id="ubicacion"
              name="ubicacion"
              value={formData.ubicacion}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label 
              htmlFor="superficie_terreno"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Superficie de Terreno (m¬≤)
            </label>
            <input
              type="number"
              id="superficie_terreno"
              step="0.01"
              name="superficie_terreno"
              value={formData.superficie_terreno}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label 
              htmlFor="numero_locales"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              N√∫mero de Locales
            </label>
            <input
              type="number"
              id="numero_locales"
              name="numero_locales"
              value={formData.numero_locales}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>
        </div>
      );

    case 'estacionamiento':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          <div>
            <label 
              htmlFor="cajones_estacionamiento"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Cajones de Estacionamiento
            </label>
            <input
              type="number"
              id="cajones_estacionamiento"
              name="cajones_estacionamiento"
              value={formData.cajones_estacionamiento}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label 
              htmlFor="motopuertos"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Motopuertos
            </label>
            <input
              type="number"
              id="motopuertos"
              name="motopuertos"
              value={formData.motopuertos}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label 
              htmlFor="ciclopuertos"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Ciclopuertos
            </label>
            <input
              type="number"
              id="ciclopuertos"
              name="ciclopuertos"
              value={formData.ciclopuertos}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>
        </div>
      );

    case 'comunicacion':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          <div>
            <label 
              htmlFor="escaleras_estaticas"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Escaleras Est√°ticas
            </label>
            <input
              type="text"
              id="escaleras_estaticas"
              name="escaleras_estaticas"
              value={formData.escaleras_estaticas}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label 
              htmlFor="escaleras_emergencia"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Escaleras de Emergencia
            </label>
            <input
              type="text"
              id="escaleras_emergencia"
              name="escaleras_emergencia"
              value={formData.escaleras_emergencia}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label 
              htmlFor="elevador"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Elevador
            </label>
            <input
              type="text"
              id="elevador"
              name="elevador"
              value={formData.elevador}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>
        </div>
      );

    case 'equipo':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          {[
            { name: 'gas_lp', label: 'Gas LP' },
            { name: 'gas_butano', label: 'Gas Butano' },
            { name: 'gas_natural', label: 'Gas Natural' },
            { name: 'agua', label: 'Agua' },
            { name: 'luz', label: 'Luz' },
            { name: 'extraccion_humo', label: 'Extracci√≥n de Humo' },
            { name: 'trampas_grasa', label: 'Trampas de Grasa' },
            { name: 'equipo_bombero', label: 'Equipo de Bombero' },
            { name: 'automatizacion_agua', label: 'Automatizaci√≥n de Agua' },
            { name: 'capacidad_sisterna', label: 'Capacidad de Cisterna (Lts)' },
            { name: 'drenaje_publico', label: 'Drenaje P√∫blico' },
            { name: 'paneles_solares', label: 'Paneles Solares' }
          ].map((field) => (
            <div key={field.name}>
              <label 
                htmlFor={field.name}
                style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
              >
                {field.label}
              </label>
              <input
                type="text"
                id={field.name}
                name={field.name}
                value={formData[field.name as keyof typeof formData] as string}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          ))}
        </div>
      );

    case 'conectividad':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          {[
            { name: 'transformador_bifasico', label: 'Transformador Bif√°sico' },
            { name: 'transformador_trifasico', label: 'Transformador Trif√°sico' },
            { name: 'centro_carga', label: 'Centro de Carga' },
            { name: 'acceso_azotea', label: 'Acceso a Azotea' },
            { name: 'acceso_trasero_pasillo_servicios', label: 'Acceso Trasero a Pasillo de Servicios' },
            { name: 'ducteria_voz_datos', label: 'Ducter√≠a para Voz y Datos' }
          ].map((field) => (
            <div key={field.name}>
              <label 
                htmlFor={field.name}
                style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
              >
                {field.label}
              </label>
              <input
                type="text"
                id={field.name}
                name={field.name}
                value={formData[field.name as keyof typeof formData] as string}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          ))}
        </div>
      );

    case 'entrega':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          {[
            { name: 'obra_gris', label: 'Obra Gris' },
            { name: 'obra_blanca', label: 'Obra Blanca' },
            { name: 'obra_negra', label: 'Obra Negra' },
            { name: 'concreto_pulido_piso', label: 'Concreto Pulido en Piso' },
            { name: 'canalizacion_voz_datos', label: 'Canalizaci√≥n para Voz y Datos' },
            { name: 'preparacion_hidraulica_electrica_sanitaria', label: 'Preparaci√≥n Hidr√°ulica, El√©ctrica y Sanitaria' },
            { name: 'puertas_cristal_aluminio_ventanales', label: 'Puertas de Cristal/Aluminio y Ventanales' },
            { name: 'muros_divisorios', label: 'Muros Divisorios' },
            { name: 'salida_hidrosanitarias', label: 'Salida de Hidrosanitarias' },
            { name: 'acometida_electrica_telefonia_tv_subterranea', label: 'Acometida El√©ctrica, Telefon√≠a y TV Subterr√°nea' },
            { name: 'preparacion_drenaje_wc', label: 'Preparaci√≥n para Drenaje de WC' },
            { name: 'preparacion_mini_split_aire_acondicionado', label: 'Preparaci√≥n para Mini Split/Aire Acondicionado' },
            { name: 'valvulas_linea_agua_potable', label: 'V√°lvulas en L√≠nea de Agua Potable' },
            { name: 'interruptor_electrico_principal', label: 'Interruptor El√©ctrico Principal' }
          ].map((field) => (
            <div key={field.name}>
              <label 
                htmlFor={field.name}
                style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
              >
                {field.label}
              </label>
              <input
                type="text"
                id={field.name}
                name={field.name}
                value={formData[field.name as keyof typeof formData] as string}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          ))}
        </div>
      );

    case 'inmueble':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          <div>
            <label 
              htmlFor="altura_piso_techo_planta_baja"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Altura Piso-Techo Planta Baja (m)
            </label>
            <input
              type="number"
              id="altura_piso_techo_planta_baja"
              step="0.01"
              name="altura_piso_techo_planta_baja"
              value={formData.altura_piso_techo_planta_baja}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label 
              htmlFor="altura_piso_techo_planta_alta"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Altura Piso-Techo Planta Alta (m)
            </label>
            <input
              type="number"
              id="altura_piso_techo_planta_alta"
              step="0.01"
              name="altura_piso_techo_planta_alta"
              value={formData.altura_piso_techo_planta_alta}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          {[
            { name: 'banos_publicos', label: 'Ba√±os P√∫blicos' },
            { name: 'circuito_cerrado', label: 'Circuito Cerrado' },
            { name: 'seguridad_24hrs', label: 'Seguridad 24hrs' },
            { name: 'modulo_administracion', label: 'M√≥dulo de Administraci√≥n' }
          ].map((field) => (
            <div key={field.name}>
              <label 
                htmlFor={field.name}
                style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
              >
                {field.label}
              </label>
              <input
                type="text"
                id={field.name}
                name={field.name}
                value={formData[field.name as keyof typeof formData] as string}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          ))}
        </div>
      );

    case 'documentos':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          {[
            { name: 'reglamento_general_plaza', label: 'Reglamento General de la Plaza' },
            { name: 'acta_entrega_local', label: 'Acta de Entrega del Local' },
            { name: 'totem_precios', label: 'T√≥tem de Precios' },
            { name: 'anuncio_luminoso_normal', label: 'Anuncio Luminoso/Normal' },
            { name: 'reglamento_colocacion_anuncio', label: 'Reglamento de Colocaci√≥n de Anuncio' },
            { name: 'seguro_local', label: 'Seguro del Local' }
          ].map((field) => (
            <div key={field.name}>
              <label 
                htmlFor={field.name}
                style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
              >
                {field.label}
              </label>
              <input
                type="text"
                id={field.name}
                name={field.name}
                value={formData[field.name as keyof typeof formData] as string}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          ))}
        </div>
      );

    case 'condiciones':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          {[
            { name: 'contrato_justicia_alternativa', label: 'Contrato por Justicia Alternativa' },
            { name: 'investigacion', label: 'Investigaci√≥n' },
            { name: 'anos_forzoso_contrato', label: 'A√±os Forzoso del Contrato' },
            { name: 'anos_opcionales_contrato', label: 'A√±os Opcionales del Contrato' },
            { name: 'meses_renta_adelantada', label: 'Meses de Renta Adelantada' },
            { name: 'meses_deposito', label: 'Meses de Dep√≥sito' },
            { name: 'inpc', label: 'INPC' },
            { name: 'meses_gracia', label: 'Meses de Gracia' },
            { name: 'mantenimiento', label: 'Mantenimiento' },
            { name: 'exclusividad_giro', label: 'Exclusividad de Giro' },
            { name: 'entrega_locales', label: 'Entrega de Locales' }
          ].map((field) => (
            <div key={field.name}>
              <label 
                htmlFor={field.name}
                style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
              >
                {field.label}
              </label>
              <input
                type="text"
                id={field.name}
                name={field.name}
                value={formData[field.name as keyof typeof formData] as string}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          ))}
        </div>
      );

    case 'precios':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          <div>
            <label 
              htmlFor="precio_venta"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Precio de Venta
            </label>
            <input
              type="text"
              id="precio_venta"
              name="precio_venta"
              value={formData.precio_venta}
              onChange={handleChange}
              placeholder="50,000.00"
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label 
              htmlFor="renta_mensual"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Renta Mensual
            </label>
            <input
              type="text"
              id="renta_mensual"
              name="renta_mensual"
              value={formData.renta_mensual}
              onChange={handleChange}
              placeholder="25,000.00"
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label 
              htmlFor="cuota_mantenimiento"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Cuota de Mantenimiento
            </label>
            <input
              type="text"
              id="cuota_mantenimiento"
              name="cuota_mantenimiento"
              value={formData.cuota_mantenimiento}
              onChange={handleChange}
              placeholder="2,500.00"
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>
        </div>
      );

    case 'observaciones':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: '20px' }}>
          <div>
            <label 
              htmlFor="observaciones_generales"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Observaciones Generales
            </label>
            <textarea
              id="observaciones_generales"
              name="observaciones_generales"
              value={formData.observaciones_generales}
              onChange={handleChange}
              rows={4}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px',
                resize: 'vertical'
              }}
            />
          </div>

          <div>
            <label 
              htmlFor="especificaciones_adicionales"
              style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}
            >
              Especificaciones Adicionales
            </label>
            <textarea
              id="especificaciones_adicionales"
              name="especificaciones_adicionales"
              value={formData.especificaciones_adicionales}
              onChange={handleChange}
              rows={4}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px',
                resize: 'vertical'
              }}
            />
          </div>
        </div>
      );

    default:
      return (
        <div style={{ textAlign: 'center', color: '#64748b', padding: '40px' }}>
          <div style={{ fontSize: '48px', marginBottom: '16px' }}>üèóÔ∏è</div>
          <p>Secci√≥n en desarrollo - Pr√≥ximamente m√°s campos</p>
        </div>
      );
  }
};

  if (fetching) {
    return (
      <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
        <div style={{ textAlign: 'center', color: '#64748b' }}>Cargando propiedad...</div>
      </div>
    );
  }

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ marginBottom: '32px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' }}>
            <Link 
              href="/dashboard/propiedades/comercial"
              style={{ 
                color: '#64748b', 
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              ‚Üê Volver a Propiedades Comerciales
            </Link>
          </div>
          <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
            Editar Propiedad Comercial
          </h1>
          <p style={{ color: '#64748b', fontSize: '16px' }}>
            Modifique la informaci√≥n de la propiedad comercial
          </p>
        </div>

        {/* Navegaci√≥n por secciones */}
        <div style={{ 
          display: 'flex', 
          gap: '8px', 
          marginBottom: '24px',
          overflowX: 'auto',
          paddingBottom: '8px'
        }}>
          {sections.map((section) => (
            <button
              key={section.id}
              type="button"
              onClick={() => setActiveSection(section.id)}
              style={{
                padding: '12px 16px',
                border: 'none',
                borderRadius: '8px',
                background: activeSection === section.id ? '#181f42' : 'white',
                color: activeSection === section.id ? 'white' : '#374151',
                fontSize: '14px',
                fontWeight: '500',
                cursor: 'pointer',
                whiteSpace: 'nowrap',
                display: 'flex',
                alignItems: 'center',
                gap: '8px'
              }}
            >
              <span>{section.icon}</span>
              {section.label}
            </button>
          ))}
        </div>

        {/* Formulario */}
        <form onSubmit={handleSubmit}>
          <div style={{ 
            background: 'white', 
            borderRadius: '12px', 
            padding: '32px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0',
            marginBottom: '24px'
          }}>
            <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#2d3436', marginBottom: '24px' }}>
              {sections.find(s => s.id === activeSection)?.label}
            </h2>
            
            {renderSection()}
          </div>

          {/* Botones */}
          <div style={{ display: 'flex', gap: '16px', justifyContent: 'flex-end' }}>
            <Link
              href="/dashboard/propiedades/comercial"
              style={{
                padding: '12px 24px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                color: '#374151',
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              Cancelar
            </Link>
            <button
              type="submit"
              disabled={loading}
              style={{
                padding: '12px 24px',
                background: loading ? '#9ca3af' : '#181f42',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                fontSize: '14px',
                fontWeight: '500',
                cursor: loading ? 'not-allowed' : 'pointer'
              }}
            >
              {loading ? 'Actualizando...' : 'Actualizar Propiedad'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}=== app/dashboard/propiedades/comercial/agregar/page.tsx ===
'use client';

import { useState } from 'react';
import { useRouter } from 'next/navigation';
import { supabase } from '@/lib/supabaseClient';
import Link from 'next/link';

export default function AgregarPropiedadComercial() {
  const router = useRouter();
  const [loading, setLoading] = useState(false);
  const [activeSection, setActiveSection] = useState('basica');
  
  const [formData, setFormData] = useState({
    // INFORMACI√ìN B√ÅSICA
    nombre_plaza: '',
    ubicacion: '',
    superficie_terreno: '',
    numero_locales: '',
    
    // ESTACIONAMIENTO
    cajones_estacionamiento: '',
    motopuertos: '',
    ciclopuertos: '',
    
    // COMUNICACI√ìN VERTICAL
    escaleras_estaticas: '',
    escaleras_emergencia: '',
    elevador: '',
    
    // EQUIPO OPERATIVO Y SERVICIOS
    gas_lp: '',
    gas_butano: '',
    gas_natural: '',
    agua: '',
    luz: '',
    extraccion_humo: '',
    trampas_grasa: '',
    equipo_bombero: '',
    automatizacion_agua: '',
    capacidad_sisterna: '',
    drenaje_publico: '',
    paneles_solares: '',
    
    // CONECTIVIDAD
    transformador_bifasico: '',
    transformador_trifasico: '',
    centro_carga: '',
    acceso_azotea: '',
    acceso_trasero_pasillo_servicios: '',
    ducteria_voz_datos: '',
    
    // ENTREGA DEL LOCAL
    obra_gris: '',
    obra_blanca: '',
    obra_negra: '',
    concreto_pulido_piso: '',
    canalizacion_voz_datos: '',
    preparacion_hidraulica_electrica_sanitaria: '',
    puertas_cristal_aluminio_ventanales: '',
    muros_divisorios: '',
    salida_hidrosanitarias: '',
    acometida_electrica_telefonia_tv_subterranea: '',
    preparacion_drenaje_wc: '',
    preparacion_mini_split_aire_acondicionado: '',
    valvulas_linea_agua_potable: '',
    interruptor_electrico_principal: '',
    
    // INFORMACI√ìN DEL INMUEBLE
    altura_piso_techo_planta_baja: '',
    altura_piso_techo_planta_alta: '',
    banos_publicos: '',
    circuito_cerrado: '',
    seguridad_24hrs: '',
    modulo_administracion: '',
    
    // DOCUMENTOS PARA ARRENDAMIENTOS
    reglamento_general_plaza: '',
    acta_entrega_local: '',
    totem_precios: '',
    anuncio_luminoso_normal: '',
    reglamento_colocacion_anuncio: '',
    seguro_local: '',
    
    // CONDICIONES DE ARRENDAMIENTO
    contrato_justicia_alternativa: '',
    investigacion: '',
    anos_forzoso_contrato: '',
    anos_opcionales_contrato: '',
    meses_renta_adelantada: '',
    meses_deposito: '',
    inpc: '',
    meses_gracia: '',
    mantenimiento: '',
    exclusividad_giro: '',
    entrega_locales: '',
    
    // PRECIOS Y RENTAS
    precio_venta: '',
    renta_mensual: '',
    cuota_mantenimiento: '',
    
    // OBSERVACIONES GENERALES
    observaciones_generales: '',
    especificaciones_adicionales: ''
  });

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const formatCurrency = (value: string) => {
    // Remover comas existentes y convertir a n√∫mero
    const numericValue = parseFloat(value.replace(/,/g, ''));
    return isNaN(numericValue) ? null : numericValue;
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { data, error } = await supabase
        .from('propiedades_comerciales')
        .insert([{
          // INFORMACI√ìN B√ÅSICA
          nombre_plaza: formData.nombre_plaza,
          ubicacion: formData.ubicacion,
          superficie_terreno: formData.superficie_terreno ? parseFloat(formData.superficie_terreno) : null,
          numero_locales: formData.numero_locales ? parseInt(formData.numero_locales) : null,
          
          // ESTACIONAMIENTO
          cajones_estacionamiento: formData.cajones_estacionamiento ? parseInt(formData.cajones_estacionamiento) : null,
          motopuertos: formData.motopuertos ? parseInt(formData.motopuertos) : null,
          ciclopuertos: formData.ciclopuertos ? parseInt(formData.ciclopuertos) : null,
          
          // COMUNICACI√ìN VERTICAL
          escaleras_estaticas: formData.escaleras_estaticas,
          escaleras_emergencia: formData.escaleras_emergencia,
          elevador: formData.elevador,
          
          // EQUIPO OPERATIVO Y SERVICIOS
          gas_lp: formData.gas_lp,
          gas_butano: formData.gas_butano,
          gas_natural: formData.gas_natural,
          agua: formData.agua,
          luz: formData.luz,
          extraccion_humo: formData.extraccion_humo,
          trampas_grasa: formData.trampas_grasa,
          equipo_bombero: formData.equipo_bombero,
          automatizacion_agua: formData.automatizacion_agua,
          capacidad_sisterna: formData.capacidad_sisterna,
          drenaje_publico: formData.drenaje_publico,
          paneles_solares: formData.paneles_solares,
          
          // CONECTIVIDAD
          transformador_bifasico: formData.transformador_bifasico,
          transformador_trifasico: formData.transformador_trifasico,
          centro_carga: formData.centro_carga,
          acceso_azotea: formData.acceso_azotea,
          acceso_trasero_pasillo_servicios: formData.acceso_trasero_pasillo_servicios,
          ducteria_voz_datos: formData.ducteria_voz_datos,
          
          // ENTREGA DEL LOCAL
          obra_gris: formData.obra_gris,
          obra_blanca: formData.obra_blanca,
          obra_negra: formData.obra_negra,
          concreto_pulido_piso: formData.concreto_pulido_piso,
          canalizacion_voz_datos: formData.canalizacion_voz_datos,
          preparacion_hidraulica_electrica_sanitaria: formData.preparacion_hidraulica_electrica_sanitaria,
          puertas_cristal_aluminio_ventanales: formData.puertas_cristal_aluminio_ventanales,
          muros_divisorios: formData.muros_divisorios,
          salida_hidrosanitarias: formData.salida_hidrosanitarias,
          acometida_electrica_telefonia_tv_subterranea: formData.acometida_electrica_telefonia_tv_subterranea,
          preparacion_drenaje_wc: formData.preparacion_drenaje_wc,
          preparacion_mini_split_aire_acondicionado: formData.preparacion_mini_split_aire_acondicionado,
          valvulas_linea_agua_potable: formData.valvulas_linea_agua_potable,
          interruptor_electrico_principal: formData.interruptor_electrico_principal,
          
          // INFORMACI√ìN DEL INMUEBLE
          altura_piso_techo_planta_baja: formData.altura_piso_techo_planta_baja ? parseFloat(formData.altura_piso_techo_planta_baja) : null,
          altura_piso_techo_planta_alta: formData.altura_piso_techo_planta_alta ? parseFloat(formData.altura_piso_techo_planta_alta) : null,
          banos_publicos: formData.banos_publicos,
          circuito_cerrado: formData.circuito_cerrado,
          seguridad_24hrs: formData.seguridad_24hrs,
          modulo_administracion: formData.modulo_administracion,
          
          // DOCUMENTOS PARA ARRENDAMIENTOS
          reglamento_general_plaza: formData.reglamento_general_plaza,
          acta_entrega_local: formData.acta_entrega_local,
          totem_precios: formData.totem_precios,
          anuncio_luminoso_normal: formData.anuncio_luminoso_normal,
          reglamento_colocacion_anuncio: formData.reglamento_colocacion_anuncio,
          seguro_local: formData.seguro_local,
          
          // CONDICIONES DE ARRENDAMIENTO
          contrato_justicia_alternativa: formData.contrato_justicia_alternativa,
          investigacion: formData.investigacion,
          anos_forzoso_contrato: formData.anos_forzoso_contrato,
          anos_opcionales_contrato: formData.anos_opcionales_contrato,
          meses_renta_adelantada: formData.meses_renta_adelantada ? parseInt(formData.meses_renta_adelantada) : null,
          meses_deposito: formData.meses_deposito ? parseInt(formData.meses_deposito) : null,
          inpc: formData.inpc,
          meses_gracia: formData.meses_gracia ? parseInt(formData.meses_gracia) : null,
          mantenimiento: formData.mantenimiento,
          exclusividad_giro: formData.exclusividad_giro,
          entrega_locales: formData.entrega_locales,
          
          // PRECIOS Y RENTAS
          precio_venta: formatCurrency(formData.precio_venta),
          renta_mensual: formatCurrency(formData.renta_mensual),
          cuota_mantenimiento: formatCurrency(formData.cuota_mantenimiento),
          
          // OBSERVACIONES GENERALES
          observaciones_generales: formData.observaciones_generales,
          especificaciones_adicionales: formData.especificaciones_adicionales
        }])
        .select();

      if (error) {
        throw error;
      }

      alert('Propiedad comercial agregada correctamente!');
      router.push('/dashboard/propiedades/comercial');
      
    } catch (error) {
      console.error('Error al agregar propiedad:', error);
      alert('Error al agregar la propiedad');
    } finally {
      setLoading(false);
    }
  };

  const sections = [
    { id: 'basica', label: 'Informaci√≥n B√°sica', icon: 'üìã' },
    { id: 'estacionamiento', label: 'Estacionamiento', icon: 'üöó' },
    { id: 'comunicacion', label: 'Comunicaci√≥n Vertical', icon: 'üõó' },
    { id: 'equipo', label: 'Equipo Operativo', icon: '‚öôÔ∏è' },
    { id: 'conectividad', label: 'Conectividad', icon: 'üîå' },
    { id: 'entrega', label: 'Entrega del Local', icon: 'üèóÔ∏è' },
    { id: 'inmueble', label: 'Informaci√≥n del Inmueble', icon: 'üè¢' },
    { id: 'documentos', label: 'Documentos', icon: 'üìÑ' },
    { id: 'condiciones', label: 'Condiciones', icon: 'üìù' },
    { id: 'precios', label: 'Precios y Rentas', icon: 'üí∞' },
    { id: 'observaciones', label: 'Observaciones', icon: 'üìã' }
  ];

const renderSection = () => {
  switch(activeSection) {
    case 'basica':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Nombre de la Plaza *
            </label>
            <input
              type="text"
              name="nombre_plaza"
              value={formData.nombre_plaza}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
              required
            />
          </div>

          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Ubicaci√≥n
            </label>
            <input
              type="text"
              name="ubicacion"
              value={formData.ubicacion}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Superficie de Terreno (m¬≤)
            </label>
            <input
              type="number"
              step="0.01"
              name="superficie_terreno"
              value={formData.superficie_terreno}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              N√∫mero de Locales
            </label>
            <input
              type="number"
              name="numero_locales"
              value={formData.numero_locales}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>
        </div>
      );

    case 'estacionamiento':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Cajones de Estacionamiento
            </label>
            <input
              type="number"
              name="cajones_estacionamiento"
              value={formData.cajones_estacionamiento}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Motopuertos
            </label>
            <input
              type="number"
              name="motopuertos"
              value={formData.motopuertos}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Ciclopuertos
            </label>
            <input
              type="number"
              name="ciclopuertos"
              value={formData.ciclopuertos}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>
        </div>
      );

    case 'comunicacion':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Escaleras Est√°ticas
            </label>
            <input
              type="text"
              name="escaleras_estaticas"
              value={formData.escaleras_estaticas}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Escaleras de Emergencia
            </label>
            <input
              type="text"
              name="escaleras_emergencia"
              value={formData.escaleras_emergencia}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Elevador
            </label>
            <input
              type="text"
              name="elevador"
              value={formData.elevador}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>
        </div>
      );

    case 'equipo':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          {[
            { name: 'gas_lp', label: 'Gas LP' },
            { name: 'gas_butano', label: 'Gas Butano' },
            { name: 'gas_natural', label: 'Gas Natural' },
            { name: 'agua', label: 'Agua' },
            { name: 'luz', label: 'Luz' },
            { name: 'extraccion_humo', label: 'Extracci√≥n de Humo' },
            { name: 'trampas_grasa', label: 'Trampas de Grasa' },
            { name: 'equipo_bombero', label: 'Equipo de Bombero' },
            { name: 'automatizacion_agua', label: 'Automatizaci√≥n de Agua' },
            { name: 'capacidad_sisterna', label: 'Capacidad de Cisterna (Lts)' },
            { name: 'drenaje_publico', label: 'Drenaje P√∫blico' },
            { name: 'paneles_solares', label: 'Paneles Solares' }
          ].map((field) => (
            <div key={field.name}>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                {field.label}
              </label>
              <input
                type="text"
                name={field.name}
                value={formData[field.name as keyof typeof formData] as string}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          ))}
        </div>
      );

    case 'conectividad':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          {[
            { name: 'transformador_bifasico', label: 'Transformador Bif√°sico' },
            { name: 'transformador_trifasico', label: 'Transformador Trif√°sico' },
            { name: 'centro_carga', label: 'Centro de Carga' },
            { name: 'acceso_azotea', label: 'Acceso a Azotea' },
            { name: 'acceso_trasero_pasillo_servicios', label: 'Acceso Trasero a Pasillo de Servicios' },
            { name: 'ducteria_voz_datos', label: 'Ducter√≠a para Voz y Datos' }
          ].map((field) => (
            <div key={field.name}>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                {field.label}
              </label>
              <input
                type="text"
                name={field.name}
                value={formData[field.name as keyof typeof formData] as string}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          ))}
        </div>
      );

    case 'entrega':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          {[
            { name: 'obra_gris', label: 'Obra Gris' },
            { name: 'obra_blanca', label: 'Obra Blanca' },
            { name: 'obra_negra', label: 'Obra Negra' },
            { name: 'concreto_pulido_piso', label: 'Concreto Pulido en Piso' },
            { name: 'canalizacion_voz_datos', label: 'Canalizaci√≥n para Voz y Datos' },
            { name: 'preparacion_hidraulica_electrica_sanitaria', label: 'Preparaci√≥n Hidr√°ulica, El√©ctrica y Sanitaria' },
            { name: 'puertas_cristal_aluminio_ventanales', label: 'Puertas de Cristal/Aluminio y Ventanales' },
            { name: 'muros_divisorios', label: 'Muros Divisorios' },
            { name: 'salida_hidrosanitarias', label: 'Salida de Hidrosanitarias' },
            { name: 'acometida_electrica_telefonia_tv_subterranea', label: 'Acometida El√©ctrica, Telefon√≠a y TV Subterr√°nea' },
            { name: 'preparacion_drenaje_wc', label: 'Preparaci√≥n para Drenaje de WC' },
            { name: 'preparacion_mini_split_aire_acondicionado', label: 'Preparaci√≥n para Mini Split/Aire Acondicionado' },
            { name: 'valvulas_linea_agua_potable', label: 'V√°lvulas en L√≠nea de Agua Potable' },
            { name: 'interruptor_electrico_principal', label: 'Interruptor El√©ctrico Principal' }
          ].map((field) => (
            <div key={field.name}>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                {field.label}
              </label>
              <input
                type="text"
                name={field.name}
                value={formData[field.name as keyof typeof formData] as string}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          ))}
        </div>
      );

    case 'inmueble':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Altura Piso-Techo Planta Baja (m)
            </label>
            <input
              type="number"
              step="0.01"
              name="altura_piso_techo_planta_baja"
              value={formData.altura_piso_techo_planta_baja}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Altura Piso-Techo Planta Alta (m)
            </label>
            <input
              type="number"
              step="0.01"
              name="altura_piso_techo_planta_alta"
              value={formData.altura_piso_techo_planta_alta}
              onChange={handleChange}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          {[
            { name: 'banos_publicos', label: 'Ba√±os P√∫blicos' },
            { name: 'circuito_cerrado', label: 'Circuito Cerrado' },
            { name: 'seguridad_24hrs', label: 'Seguridad 24hrs' },
            { name: 'modulo_administracion', label: 'M√≥dulo de Administraci√≥n' }
          ].map((field) => (
            <div key={field.name}>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                {field.label}
              </label>
              <input
                type="text"
                name={field.name}
                value={formData[field.name as keyof typeof formData] as string}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          ))}
        </div>
      );

    case 'documentos':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          {[
            { name: 'reglamento_general_plaza', label: 'Reglamento General de la Plaza' },
            { name: 'acta_entrega_local', label: 'Acta de Entrega del Local' },
            { name: 'totem_precios', label: 'T√≥tem de Precios' },
            { name: 'anuncio_luminoso_normal', label: 'Anuncio Luminoso/Normal' },
            { name: 'reglamento_colocacion_anuncio', label: 'Reglamento de Colocaci√≥n de Anuncio' },
            { name: 'seguro_local', label: 'Seguro del Local' }
          ].map((field) => (
            <div key={field.name}>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                {field.label}
              </label>
              <input
                type="text"
                name={field.name}
                value={formData[field.name as keyof typeof formData] as string}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          ))}
        </div>
      );

    case 'condiciones':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          {[
            { name: 'contrato_justicia_alternativa', label: 'Contrato por Justicia Alternativa' },
            { name: 'investigacion', label: 'Investigaci√≥n' },
            { name: 'anos_forzoso_contrato', label: 'A√±os Forzoso del Contrato' },
            { name: 'anos_opcionales_contrato', label: 'A√±os Opcionales del Contrato' },
            { name: 'meses_renta_adelantada', label: 'Meses de Renta Adelantada' },
            { name: 'meses_deposito', label: 'Meses de Dep√≥sito' },
            { name: 'inpc', label: 'INPC' },
            { name: 'meses_gracia', label: 'Meses de Gracia' },
            { name: 'mantenimiento', label: 'Mantenimiento' },
            { name: 'exclusividad_giro', label: 'Exclusividad de Giro' },
            { name: 'entrega_locales', label: 'Entrega de Locales' }
          ].map((field) => (
            <div key={field.name}>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                {field.label}
              </label>
              <input
                type="text"
                name={field.name}
                value={formData[field.name as keyof typeof formData] as string}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          ))}
        </div>
      );

    case 'precios':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Precio de Venta
            </label>
            <input
              type="text"
              name="precio_venta"
              value={formData.precio_venta}
              onChange={handleChange}
              placeholder="50,000.00"
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Renta Mensual
            </label>
            <input
              type="text"
              name="renta_mensual"
              value={formData.renta_mensual}
              onChange={handleChange}
              placeholder="25,000.00"
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>

          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Cuota de Mantenimiento
            </label>
            <input
              type="text"
              name="cuota_mantenimiento"
              value={formData.cuota_mantenimiento}
              onChange={handleChange}
              placeholder="2,500.00"
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            />
          </div>
        </div>
      );

    case 'observaciones':
      return (
        <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: '20px' }}>
          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Observaciones Generales
            </label>
            <textarea
              name="observaciones_generales"
              value={formData.observaciones_generales}
              onChange={handleChange}
              rows={4}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px',
                resize: 'vertical'
              }}
            />
          </div>

          <div>
            <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
              Especificaciones Adicionales
            </label>
            <textarea
              name="especificaciones_adicionales"
              value={formData.especificaciones_adicionales}
              onChange={handleChange}
              rows={4}
              style={{ 
                width: '100%', 
                padding: '12px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px',
                resize: 'vertical'
              }}
            />
          </div>
        </div>
      );

    default:
      return (
        <div style={{ textAlign: 'center', color: '#64748b', padding: '40px' }}>
          <div style={{ fontSize: '48px', marginBottom: '16px' }}>üèóÔ∏è</div>
          <p>Secci√≥n en desarrollo - Pr√≥ximamente m√°s campos</p>
        </div>
      );
  }
};

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ marginBottom: '32px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' }}>
            <Link 
              href="/dashboard/propiedades/comercial"
              style={{ 
                color: '#64748b', 
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              ‚Üê Volver a Propiedades Comerciales
            </Link>
          </div>
          <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
            Agregar Propiedad Comercial
          </h1>
          <p style={{ color: '#64748b', fontSize: '16px' }}>
            Complete la informaci√≥n de la nueva propiedad comercial
          </p>
        </div>

        {/* Navegaci√≥n por secciones */}
        <div style={{ 
          display: 'flex', 
          gap: '8px', 
          marginBottom: '24px',
          overflowX: 'auto',
          paddingBottom: '8px'
        }}>
          {sections.map((section) => (
            <button
              key={section.id}
              type="button"
              onClick={() => setActiveSection(section.id)}
              style={{
                padding: '12px 16px',
                border: 'none',
                borderRadius: '8px',
                background: activeSection === section.id ? '#181f42' : 'white',
                color: activeSection === section.id ? 'white' : '#374151',
                fontSize: '14px',
                fontWeight: '500',
                cursor: 'pointer',
                whiteSpace: 'nowrap',
                display: 'flex',
                alignItems: 'center',
                gap: '8px'
              }}
            >
              <span>{section.icon}</span>
              {section.label}
            </button>
          ))}
        </div>

        {/* Formulario */}
        <form onSubmit={handleSubmit}>
          <div style={{ 
            background: 'white', 
            borderRadius: '12px', 
            padding: '32px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0',
            marginBottom: '24px'
          }}>
            <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#2d3436', marginBottom: '24px' }}>
              {sections.find(s => s.id === activeSection)?.label}
            </h2>
            
            {renderSection()}
          </div>

          {/* Botones */}
          <div style={{ display: 'flex', gap: '16px', justifyContent: 'flex-end' }}>
            <Link
              href="/dashboard/propiedades/comercial"
              style={{
                padding: '12px 24px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                color: '#374151',
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              Cancelar
            </Link>
            <button
              type="submit"
              disabled={loading}
              style={{
                padding: '12px 24px',
                background: loading ? '#9ca3af' : '#181f42',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                fontSize: '14px',
                fontWeight: '500',
                cursor: loading ? 'not-allowed' : 'pointer'
              }}
            >
              {loading ? 'Guardando...' : 'Guardar Propiedad'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}=== app/dashboard/propiedades/comercial/page.tsx ===
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import { supabase } from '@/lib/supabaseClient';

interface PropiedadComercial {
  id: string;
  nombre_plaza: string;
  ubicacion: string;
  numero_locales: number;
  cajones_estacionamiento: number;
  renta_mensual: number;
  precio_venta: number;
}

export default function PropiedadesComercialPage() {
  const [propiedades, setPropiedades] = useState<PropiedadComercial[]>([]);
  const [loading, setLoading] = useState(true);
  const [deletingId, setDeletingId] = useState<string | null>(null);

  useEffect(() => {
    fetchPropiedades();
  }, []);

  const fetchPropiedades = async () => {
    try {
      const { data, error } = await supabase
        .from('propiedades_comerciales')
        .select('*')
        .order('creado_en', { ascending: false });

      if (error) throw error;
      setPropiedades(data || []);
    } catch (error) {
      console.error('Error fetching propiedades:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleEliminarPropiedad = async (id: string, nombre: string) => {
    if (!confirm(`¬øEst√°s seguro de que quieres eliminar la propiedad "${nombre}"? Esta acci√≥n no se puede deshacer.`)) {
      return;
    }

    setDeletingId(id);
    
    try {
      const { error } = await supabase
        .from('propiedades_comerciales')
        .delete()
        .eq('id', id);

      if (error) {
        console.error('Error eliminando propiedad:', error);
        alert(`Error al eliminar propiedad: ${error.message}`);
        throw error;
      }

      // Actualizar la lista eliminando la propiedad
      setPropiedades(prev => prev.filter(propiedad => propiedad.id !== id));
      alert('Propiedad eliminada correctamente');
      
    } catch (error) {
      console.error('Error eliminando propiedad:', error);
    } finally {
      setDeletingId(null);
    }
  };

  if (loading) {
    return (
      <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
        <div style={{ textAlign: 'center', color: '#64748b' }}>Cargando propiedades comerciales...</div>
      </div>
    );
  }

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa' }}>
      {/* Header */}
      <div style={{ 
        background: 'white', 
        borderBottom: '1px solid #e2e8f0', 
        padding: '24px 32px' 
      }}>
        {/* Bot√≥n para regresar al Dashboard */}
        <div style={{ marginBottom: '16px' }}>
          <Link 
            href="/dashboard"
            style={{ 
              color: '#64748b', 
              textDecoration: 'none',
              fontSize: '14px',
              fontWeight: '500',
              display: 'inline-flex',
              alignItems: 'center',
              gap: '8px'
            }}
          >
            ‚Üê Volver al Dashboard
          </Link>
        </div>

        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
          <div>
            <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
              Propiedades Comerciales
            </h1>
            <p style={{ color: '#64748b', fontSize: '16px' }}>
              Gesti√≥n de plazas comerciales y locales
            </p>
          </div>
          <Link
            href="/dashboard/propiedades/comercial/agregar"
            style={{
              background: '#181f42',
              color: 'white',
              padding: '12px 24px',
              borderRadius: '8px',
              textDecoration: 'none',
              fontSize: '14px',
              fontWeight: '500'
            }}
          >
            + Nueva Propiedad
          </Link>
        </div>
      </div>

      {/* Contenido */}
      <div style={{ padding: '32px' }}>
        {/* Estad√≠sticas */}
        <div style={{ 
          display: 'grid', 
          gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', 
          gap: '20px', 
          marginBottom: '32px' 
        }}>
          <div style={{ 
            background: 'white', 
            padding: '24px', 
            borderRadius: '12px',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436' }}>
              {propiedades.length}
            </div>
            <div style={{ fontSize: '14px', color: '#64748b' }}>Total Propiedades</div>
          </div>
          
          <div style={{ 
            background: 'white', 
            padding: '24px', 
            borderRadius: '12px',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436' }}>
              {propiedades.reduce((sum, prop) => sum + (prop.numero_locales || 0), 0)}
            </div>
            <div style={{ fontSize: '14px', color: '#64748b' }}>Total Locales</div>
          </div>
          
          <div style={{ 
            background: 'white', 
            padding: '24px', 
            borderRadius: '12px',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436' }}>
              {propiedades.reduce((sum, prop) => sum + (prop.cajones_estacionamiento || 0), 0)}
            </div>
            <div style={{ fontSize: '14px', color: '#64748b' }}>Total Estacionamientos</div>
          </div>
          
          <div style={{ 
            background: 'white', 
            padding: '24px', 
            borderRadius: '12px',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436' }}>
              ${propiedades.reduce((sum, prop) => sum + (prop.renta_mensual || 0), 0).toLocaleString()}
            </div>
            <div style={{ fontSize: '14px', color: '#64748b' }}>Renta Mensual Total</div>
          </div>
        </div>

        {/* Lista de propiedades */}
        <div style={{ 
          background: 'white', 
          borderRadius: '12px',
          border: '1px solid #e2e8f0',
          overflow: 'hidden'
        }}>
          <div style={{ overflowX: 'auto' }}>
            <table style={{ width: '100%', borderCollapse: 'collapse' }}>
              <thead>
                <tr style={{ background: '#f8f9fa' }}>
                  <th style={{ padding: '16px', textAlign: 'left', fontWeight: '600', fontSize: '12px', color: '#64748b', textTransform: 'uppercase' }}>
                    Plaza Comercial
                  </th>
                  <th style={{ padding: '16px', textAlign: 'left', fontWeight: '600', fontSize: '12px', color: '#64748b', textTransform: 'uppercase' }}>
                    Ubicaci√≥n
                  </th>
                  <th style={{ padding: '16px', textAlign: 'left', fontWeight: '600', fontSize: '12px', color: '#64748b', textTransform: 'uppercase' }}>
                    Locales
                  </th>
                  <th style={{ padding: '16px', textAlign: 'left', fontWeight: '600', fontSize: '12px', color: '#64748b', textTransform: 'uppercase' }}>
                    Estacionamiento
                  </th>
                  <th style={{ padding: '16px', textAlign: 'left', fontWeight: '600', fontSize: '12px', color: '#64748b', textTransform: 'uppercase' }}>
                    Renta Mensual
                  </th>
                  <th style={{ padding: '16px', textAlign: 'left', fontWeight: '600', fontSize: '12px', color: '#64748b', textTransform: 'uppercase' }}>
                    Acciones
                  </th>
                </tr>
              </thead>
              <tbody>
                {propiedades.map((propiedad) => (
                  <tr key={propiedad.id} style={{ borderTop: '1px solid #e2e8f0' }}>
                    <td style={{ padding: '16px' }}>
                      <div style={{ fontWeight: '600', color: '#2d3436' }}>
                        {propiedad.nombre_plaza || 'Sin nombre'}
                      </div>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ color: '#2d3436' }}>{propiedad.ubicacion || 'Sin ubicaci√≥n'}</div>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ fontWeight: '500' }}>
                        {propiedad.numero_locales || 0} locales
                      </div>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ fontWeight: '500' }}>
                        {propiedad.cajones_estacionamiento || 0} cajones
                      </div>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ fontWeight: '600', color: '#181f42' }}>
                        {propiedad.renta_mensual ? `$${propiedad.renta_mensual.toLocaleString()}` : 'Consultar'}
                      </div>
                    </td>
                    <td style={{ padding: '16px' }}>
                      <div style={{ display: 'flex', gap: '12px' }}>
                        <Link 
                          href={`/dashboard/propiedades/comercial/editar/${propiedad.id}`}
                          style={{ 
                            color: '#181f42',
                            textDecoration: 'none',
                            fontSize: '14px',
                            fontWeight: '500'
                          }}
                        >
                          Editar
                        </Link>
                        <button
                          onClick={() => handleEliminarPropiedad(propiedad.id, propiedad.nombre_plaza || 'esta propiedad')}
                          disabled={deletingId === propiedad.id}
                          style={{
                            color: deletingId === propiedad.id ? '#9ca3af' : '#dc2626',
                            background: 'none',
                            border: 'none',
                            fontSize: '14px',
                            fontWeight: '500',
                            cursor: deletingId === propiedad.id ? 'not-allowed' : 'pointer'
                          }}
                        >
                          {deletingId === propiedad.id ? 'Eliminando...' : 'Eliminar'}
                        </button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          {propiedades.length === 0 && (
            <div style={{ textAlign: 'center', padding: '60px 20px', color: '#64748b' }}>
              <div style={{ fontSize: '48px', marginBottom: '16px', opacity: '0.5' }}>üõçÔ∏è</div>
              <h3 style={{ marginBottom: '8px', color: '#2d3436' }}>No hay propiedades comerciales</h3>
              <p style={{ marginBottom: '24px' }}>Comienza agregando la primera propiedad comercial</p>
              <Link
                href="/dashboard/propiedades/comercial/agregar"
                style={{
                  background: '#181f42',
                  color: 'white',
                  padding: '12px 24px',
                  borderRadius: '8px',
                  textDecoration: 'none',
                  fontSize: '14px',
                  fontWeight: '500'
                }}
              >
                + Agregar Primera Propiedad
              </Link>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}=== app/dashboard/propiedades/residencial/editar/[id]/page.tsx ===
// /dashboard/propiedades/residencial/editar/[id]/page.tsx
'use client';

import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabaseClient';
import { useRouter, useParams } from 'next/navigation';
import Link from 'next/link';

export default function EditarPropiedadResidencial() {
  const router = useRouter();
  const params = useParams();
  const id = params.id as string;
  
  const [loading, setLoading] = useState(false);
  const [loadingData, setLoadingData] = useState(true);
  const [activeSection, setActiveSection] = useState('basica');
  
  const [formData, setFormData] = useState({
    // INFORMACI√ìN B√ÅSICA
    titulo: '',
    direccion: '',
    colonia: '',
    ciudad: '',
    estado: '',
    codigo_postal: '',
    tipo_propiedad: 'casa',
    
    // PRECIOS
    precio_venta: '',
    precio_renta: '',
    
    // CARACTER√çSTICAS PRINCIPALES
    superficie_terreno: '',
    superficie_construccion: '',
    habitaciones: '',
    banos: '',
    medios_banos: '',
    niveles: '',
    antiguedad: '',
    cocheras: '',
    
    // COMODIDADES
    jardin: false,
    alberca: false,
    seguridad_24hrs: false,
    amueblado: false,
    aire_acondicionado: false,
    calefaccion: false,
    
    // √ÅREAS COMUNES
    gimnasio: false,
    salon_eventos: false,
    areas_verdes: false,
    parque_infantil: false,
    
    // INFORMACI√ìN ADICIONAL
    descripcion: '',
    estatus: 'disponible',
    destacado: false
  });

  useEffect(() => {
    if (id) {
      fetchPropiedad();
    }
  }, [id]);

  const fetchPropiedad = async () => {
    try {
      const { data, error } = await supabase
        .from('propiedades_residenciales')
        .select('*')
        .eq('id', id)
        .single();

      if (error) throw error;

      if (data) {
        setFormData({
          // INFORMACI√ìN B√ÅSICA
          titulo: data.titulo || '',
          direccion: data.direccion || '',
          colonia: data.colonia || '',
          ciudad: data.ciudad || '',
          estado: data.estado || '',
          codigo_postal: data.codigo_postal || '',
          tipo_propiedad: data.tipo_propiedad || 'casa',
          
          // PRECIOS
          precio_venta: data.precio_venta?.toString() || '',
          precio_renta: data.precio_renta?.toString() || '',
          
          // CARACTER√çSTICAS PRINCIPALES
          superficie_terreno: data.superficie_terreno?.toString() || '',
          superficie_construccion: data.superficie_construccion?.toString() || '',
          habitaciones: data.habitaciones?.toString() || '',
          banos: data.banos?.toString() || '',
          medios_banos: data.medios_banos?.toString() || '',
          niveles: data.niveles?.toString() || '',
          antiguedad: data.antiguedad?.toString() || '',
          cocheras: data.cocheras?.toString() || '',
          
          // COMODIDADES
          jardin: data.jardin || false,
          alberca: data.alberca || false,
          seguridad_24hrs: data.seguridad_24hrs || false,
          amueblado: data.amueblado || false,
          aire_acondicionado: data.aire_acondicionado || false,
          calefaccion: data.calefaccion || false,
          
          // √ÅREAS COMUNES
          gimnasio: data.gimnasio || false,
          salon_eventos: data.salon_eventos || false,
          areas_verdes: data.areas_verdes || false,
          parque_infantil: data.parque_infantil || false,
          
          // INFORMACI√ìN ADICIONAL
          descripcion: data.descripcion || '',
          estatus: data.estatus || 'disponible',
          destacado: data.destacado || false
        });
      }
    } catch (error) {
      console.error('Error fetching propiedad:', error);
      alert('Error al cargar la propiedad');
    } finally {
      setLoadingData(false);
    }
  };

  const sections = [
    { id: 'basica', label: 'Informaci√≥n B√°sica', icon: 'üìã' },
    { id: 'precios', label: 'Precios', icon: 'üí∞' },
    { id: 'caracteristicas', label: 'Caracter√≠sticas', icon: 'üè†' },
    { id: 'comodidades', label: 'Comodidades', icon: '‚≠ê' },
    { id: 'adicional', label: 'Informaci√≥n Adicional', icon: 'üìù' }
  ];

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { error } = await supabase
        .from('propiedades_residenciales')
        .update({
          // INFORMACI√ìN B√ÅSICA
          titulo: formData.titulo,
          direccion: formData.direccion,
          colonia: formData.colonia,
          ciudad: formData.ciudad,
          estado: formData.estado,
          codigo_postal: formData.codigo_postal,
          tipo_propiedad: formData.tipo_propiedad,
          
          // PRECIOS
          precio_venta: formData.precio_venta ? parseFloat(formData.precio_venta) : null,
          precio_renta: formData.precio_renta ? parseFloat(formData.precio_renta) : null,
          
          // CARACTER√çSTICAS PRINCIPALES
          superficie_terreno: formData.superficie_terreno ? parseFloat(formData.superficie_terreno) : null,
          superficie_construccion: formData.superficie_construccion ? parseFloat(formData.superficie_construccion) : null,
          habitaciones: formData.habitaciones ? parseInt(formData.habitaciones) : null,
          banos: formData.banos ? parseInt(formData.banos) : null,
          medios_banos: formData.medios_banos ? parseInt(formData.medios_banos) : null,
          niveles: formData.niveles ? parseInt(formData.niveles) : null,
          antiguedad: formData.antiguedad ? parseInt(formData.antiguedad) : null,
          cocheras: formData.cocheras ? parseInt(formData.cocheras) : null,
          
          // COMODIDADES
          jardin: formData.jardin,
          alberca: formData.alberca,
          seguridad_24hrs: formData.seguridad_24hrs,
          amueblado: formData.amueblado,
          aire_acondicionado: formData.aire_acondicionado,
          calefaccion: formData.calefaccion,
          
          // √ÅREAS COMUNES
          gimnasio: formData.gimnasio,
          salon_eventos: formData.salon_eventos,
          areas_verdes: formData.areas_verdes,
          parque_infantil: formData.parque_infantil,
          
          // INFORMACI√ìN ADICIONAL
          descripcion: formData.descripcion,
          estatus: formData.estatus,
          destacado: formData.destacado
        })
        .eq('id', id);

      if (error) {
        console.error('Error de Supabase:', error);
        alert(`Error: ${error.message}`);
        throw error;
      }

      alert('Propiedad actualizada correctamente!');
      router.push('/dashboard/propiedades/residencial');
      
    } catch (error) {
      console.error('Error actualizando propiedad:', error);
      alert('Error al actualizar propiedad');
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {
    const { name, value, type } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? (e.target as HTMLInputElement).checked : value
    }));
  };

  const renderSection = () => {
    switch(activeSection) {
      case 'basica':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                T√≠tulo *
              </label>
              <input
                type="text"
                name="titulo"
                value={formData.titulo}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
                required
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Tipo de Propiedad *
              </label>
              <select
                name="tipo_propiedad"
                value={formData.tipo_propiedad}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
                required
              >
                <option value="casa">Casa</option>
                <option value="departamento">Departamento</option>
                <option value="terreno">Terreno</option>
                <option value="duplex">Duplex</option>
                <option value="townhouse">Townhouse</option>
              </select>
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Direcci√≥n
              </label>
              <input
                type="text"
                name="direccion"
                value={formData.direccion}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Colonia
              </label>
              <input
                type="text"
                name="colonia"
                value={formData.colonia}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Ciudad
              </label>
              <input
                type="text"
                name="ciudad"
                value={formData.ciudad}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Estado
              </label>
              <input
                type="text"
                name="estado"
                value={formData.estado}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          </div>
        );

      case 'precios':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Precio de Venta
              </label>
              <input
                type="number"
                name="precio_venta"
                value={formData.precio_venta}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
                placeholder="0.00"
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Precio de Renta
              </label>
              <input
                type="number"
                name="precio_renta"
                value={formData.precio_renta}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
                placeholder="0.00"
              />
            </div>
          </div>
        );

      case 'caracteristicas':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            {[
              { name: 'superficie_terreno', label: 'Superficie Terreno (m¬≤)', type: 'number' },
              { name: 'superficie_construccion', label: 'Superficie Construcci√≥n (m¬≤)', type: 'number' },
              { name: 'habitaciones', label: 'Habitaciones', type: 'number' },
              { name: 'banos', label: 'Ba√±os Completos', type: 'number' },
              { name: 'medios_banos', label: 'Medios Ba√±os', type: 'number' },
              { name: 'niveles', label: 'Niveles', type: 'number' },
              { name: 'antiguedad', label: 'Antig√ºedad (a√±os)', type: 'number' },
              { name: 'cocheras', label: 'Cocheras', type: 'number' }
            ].map((field) => (
              <div key={field.name}>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  {field.label}
                </label>
                <input
                  type={field.type}
                  name={field.name}
                  value={formData[field.name as keyof typeof formData] as string}
                  onChange={handleChange}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                />
              </div>
            ))}
          </div>
        );

      case 'comodidades':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            {[
              { name: 'jardin', label: 'Jard√≠n' },
              { name: 'alberca', label: 'Alberca' },
              { name: 'seguridad_24hrs', label: 'Seguridad 24hrs' },
              { name: 'amueblado', label: 'Amueblado' },
              { name: 'aire_acondicionado', label: 'Aire Acondicionado' },
              { name: 'calefaccion', label: 'Calefacci√≥n' },
              { name: 'gimnasio', label: 'Gimnasio' },
              { name: 'salon_eventos', label: 'Sal√≥n de Eventos' },
              { name: 'areas_verdes', label: '√Åreas Verdes' },
              { name: 'parque_infantil', label: 'Parque Infantil' }
            ].map((field) => (
              <div key={field.name} style={{ display: 'flex', alignItems: 'center' }}>
                <input
                  type="checkbox"
                  name={field.name}
                  checked={formData[field.name as keyof typeof formData] as boolean}
                  onChange={handleChange}
                  style={{ marginRight: '8px' }}
                />
                <label style={{ fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  {field.label}
                </label>
              </div>
            ))}
          </div>
        );

      case 'adicional':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Estatus
              </label>
              <select
                name="estatus"
                value={formData.estatus}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              >
                <option value="disponible">Disponible</option>
                <option value="vendido">Vendido</option>
                <option value="rentado">Rentado</option>
                <option value="en_proceso">En Proceso</option>
              </select>
            </div>

            <div style={{ display: 'flex', alignItems: 'center' }}>
              <input
                type="checkbox"
                name="destacado"
                checked={formData.destacado}
                onChange={handleChange}
                style={{ marginRight: '8px' }}
              />
              <label style={{ fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Propiedad Destacada
              </label>
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Descripci√≥n
              </label>
              <textarea
                name="descripcion"
                value={formData.descripcion}
                onChange={handleChange}
                rows={6}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px',
                  resize: 'vertical'
                }}
                placeholder="Descripci√≥n detallada de la propiedad..."
              />
            </div>
          </div>
        );

      default:
        return null;
    }
  };

  if (loadingData) {
    return (
      <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
        <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
          <div style={{ textAlign: 'center', color: '#64748b' }}>Cargando propiedad...</div>
        </div>
      </div>
    );
  }

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ marginBottom: '32px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' }}>
            <Link 
              href="/dashboard/propiedades/residencial"
              style={{ 
                color: '#64748b', 
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              ‚Üê Volver a Propiedades Residenciales
            </Link>
          </div>
          <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
            Editar Propiedad Residencial
          </h1>
          <p style={{ color: '#64748b', fontSize: '16px' }}>
            Modifique la informaci√≥n de la propiedad residencial
          </p>
        </div>

        {/* Navegaci√≥n por secciones */}
        <div style={{ 
          display: 'flex', 
          gap: '8px', 
          marginBottom: '24px',
          overflowX: 'auto',
          paddingBottom: '8px'
        }}>
          {sections.map((section) => (
            <button
              key={section.id}
              type="button"
              onClick={() => setActiveSection(section.id)}
              style={{
                padding: '12px 16px',
                border: 'none',
                borderRadius: '8px',
                background: activeSection === section.id ? '#181f42' : 'white',
                color: activeSection === section.id ? 'white' : '#374151',
                fontSize: '14px',
                fontWeight: '500',
                cursor: 'pointer',
                whiteSpace: 'nowrap',
                display: 'flex',
                alignItems: 'center',
                gap: '8px'
              }}
            >
              <span>{section.icon}</span>
              {section.label}
            </button>
          ))}
        </div>

        {/* Formulario */}
        <form onSubmit={handleSubmit}>
          <div style={{ 
            background: 'white', 
            borderRadius: '12px', 
            padding: '32px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0',
            marginBottom: '24px'
          }}>
            <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#2d3436', marginBottom: '24px' }}>
              {sections.find(s => s.id === activeSection)?.label}
            </h2>
            
            {renderSection()}
          </div>

          {/* Botones */}
          <div style={{ display: 'flex', gap: '16px', justifyContent: 'flex-end' }}>
            <Link
              href="/dashboard/propiedades/residencial"
              style={{
                padding: '12px 24px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                color: '#374151',
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              Cancelar
            </Link>
            <button
              type="submit"
              disabled={loading}
              style={{
                padding: '12px 24px',
                background: loading ? '#9ca3af' : '#181f42',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                fontSize: '14px',
                fontWeight: '500',
                cursor: loading ? 'not-allowed' : 'pointer'
              }}
            >
              {loading ? 'Actualizando...' : 'Actualizar Propiedad'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}=== app/dashboard/propiedades/residencial/agregar/page.tsx ===
// /dashboard/propiedades/residencial/agregar/page.tsx
'use client';

import { useState } from 'react';
import { supabase } from '@/lib/supabaseClient';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

export default function AgregarPropiedadResidencial() {
  const router = useRouter();
  const [loading, setLoading] = useState(false);
  const [activeSection, setActiveSection] = useState('basica');
  
  const [formData, setFormData] = useState({
    // INFORMACI√ìN B√ÅSICA
    titulo: '',
    direccion: '',
    colonia: '',
    ciudad: '',
    estado: '',
    codigo_postal: '',
    tipo_propiedad: 'casa',
    
    // PRECIOS
    precio_venta: '',
    precio_renta: '',
    
    // CARACTER√çSTICAS PRINCIPALES
    superficie_terreno: '',
    superficie_construccion: '',
    habitaciones: '',
    banos: '',
    medios_banos: '',
    niveles: '',
    antiguedad: '',
    cocheras: '',
    
    // COMODIDADES
    jardin: false,
    alberca: false,
    seguridad_24hrs: false,
    amueblado: false,
    aire_acondicionado: false,
    calefaccion: false,
    
    // √ÅREAS COMUNES
    gimnasio: false,
    salon_eventos: false,
    areas_verdes: false,
    parque_infantil: false,
    
    // INFORMACI√ìN ADICIONAL
    descripcion: '',
    estatus: 'disponible',
    destacado: false
  });

  const sections = [
    { id: 'basica', label: 'Informaci√≥n B√°sica', icon: 'üìã' },
    { id: 'precios', label: 'Precios', icon: 'üí∞' },
    { id: 'caracteristicas', label: 'Caracter√≠sticas', icon: 'üè†' },
    { id: 'comodidades', label: 'Comodidades', icon: '‚≠ê' },
    { id: 'adicional', label: 'Informaci√≥n Adicional', icon: 'üìù' }
  ];

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { error } = await supabase
        .from('propiedades_residenciales')
        .insert([{
          // INFORMACI√ìN B√ÅSICA
          titulo: formData.titulo,
          direccion: formData.direccion,
          colonia: formData.colonia,
          ciudad: formData.ciudad,
          estado: formData.estado,
          codigo_postal: formData.codigo_postal,
          tipo_propiedad: formData.tipo_propiedad,
          
          // PRECIOS
          precio_venta: formData.precio_venta ? parseFloat(formData.precio_venta) : null,
          precio_renta: formData.precio_renta ? parseFloat(formData.precio_renta) : null,
          
          // CARACTER√çSTICAS PRINCIPALES
          superficie_terreno: formData.superficie_terreno ? parseFloat(formData.superficie_terreno) : null,
          superficie_construccion: formData.superficie_construccion ? parseFloat(formData.superficie_construccion) : null,
          habitaciones: formData.habitaciones ? parseInt(formData.habitaciones) : null,
          banos: formData.banos ? parseInt(formData.banos) : null,
          medios_banos: formData.medios_banos ? parseInt(formData.medios_banos) : null,
          niveles: formData.niveles ? parseInt(formData.niveles) : null,
          antiguedad: formData.antiguedad ? parseInt(formData.antiguedad) : null,
          cocheras: formData.cocheras ? parseInt(formData.cocheras) : null,
          
          // COMODIDADES
          jardin: formData.jardin,
          alberca: formData.alberca,
          seguridad_24hrs: formData.seguridad_24hrs,
          amueblado: formData.amueblado,
          aire_acondicionado: formData.aire_acondicionado,
          calefaccion: formData.calefaccion,
          
          // √ÅREAS COMUNES
          gimnasio: formData.gimnasio,
          salon_eventos: formData.salon_eventos,
          areas_verdes: formData.areas_verdes,
          parque_infantil: formData.parque_infantil,
          
          // INFORMACI√ìN ADICIONAL
          descripcion: formData.descripcion,
          estatus: formData.estatus,
          destacado: formData.destacado
        }]);

      if (error) {
  console.error('Error de Supabase:', error);
  alert(`Error: ${error.message}`);
  throw error;
}

      alert('Propiedad residencial agregada correctamente!');
      router.push('/dashboard/propiedades/residencial');
      
    } catch (error) {
      console.error('Error agregando propiedad:', error);
      alert('Error al agregar propiedad');
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {
    const { name, value, type } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: type === 'checkbox' ? (e.target as HTMLInputElement).checked : value
    }));
  };

  const renderSection = () => {
    switch(activeSection) {
      case 'basica':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                T√≠tulo *
              </label>
              <input
                type="text"
                name="titulo"
                value={formData.titulo}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
                required
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Tipo de Propiedad *
              </label>
              <select
                name="tipo_propiedad"
                value={formData.tipo_propiedad}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
                required
              >
                <option value="casa">Casa</option>
                <option value="departamento">Departamento</option>
                <option value="terreno">Terreno</option>
                <option value="duplex">Duplex</option>
                <option value="townhouse">Townhouse</option>
              </select>
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Direcci√≥n
              </label>
              <input
                type="text"
                name="direccion"
                value={formData.direccion}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Colonia
              </label>
              <input
                type="text"
                name="colonia"
                value={formData.colonia}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Ciudad
              </label>
              <input
                type="text"
                name="ciudad"
                value={formData.ciudad}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Estado
              </label>
              <input
                type="text"
                name="estado"
                value={formData.estado}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              />
            </div>
          </div>
        );

      case 'precios':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Precio de Venta
              </label>
              <input
                type="number"
                name="precio_venta"
                value={formData.precio_venta}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
                placeholder="0.00"
              />
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Precio de Renta
              </label>
              <input
                type="number"
                name="precio_renta"
                value={formData.precio_renta}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
                placeholder="0.00"
              />
            </div>
          </div>
        );

      case 'caracteristicas':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            {[
              { name: 'superficie_terreno', label: 'Superficie Terreno (m¬≤)', type: 'number' },
              { name: 'superficie_construccion', label: 'Superficie Construcci√≥n (m¬≤)', type: 'number' },
              { name: 'habitaciones', label: 'Habitaciones', type: 'number' },
              { name: 'banos', label: 'Ba√±os Completos', type: 'number' },
              { name: 'medios_banos', label: 'Medios Ba√±os', type: 'number' },
              { name: 'niveles', label: 'Niveles', type: 'number' },
              { name: 'antiguedad', label: 'Antig√ºedad (a√±os)', type: 'number' },
              { name: 'cocheras', label: 'Cocheras', type: 'number' }
            ].map((field) => (
              <div key={field.name}>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  {field.label}
                </label>
                <input
                  type={field.type}
                  name={field.name}
                  value={formData[field.name as keyof typeof formData] as string}
                  onChange={handleChange}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                />
              </div>
            ))}
          </div>
        );

      case 'comodidades':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            {[
              { name: 'jardin', label: 'Jard√≠n' },
              { name: 'alberca', label: 'Alberca' },
              { name: 'seguridad_24hrs', label: 'Seguridad 24hrs' },
              { name: 'amueblado', label: 'Amueblado' },
              { name: 'aire_acondicionado', label: 'Aire Acondicionado' },
              { name: 'calefaccion', label: 'Calefacci√≥n' },
              { name: 'gimnasio', label: 'Gimnasio' },
              { name: 'salon_eventos', label: 'Sal√≥n de Eventos' },
              { name: 'areas_verdes', label: '√Åreas Verdes' },
              { name: 'parque_infantil', label: 'Parque Infantil' }
            ].map((field) => (
              <div key={field.name} style={{ display: 'flex', alignItems: 'center' }}>
                <input
                  type="checkbox"
                  name={field.name}
                  checked={formData[field.name as keyof typeof formData] as boolean}
                  onChange={handleChange}
                  style={{ marginRight: '8px' }}
                />
                <label style={{ fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  {field.label}
                </label>
              </div>
            ))}
          </div>
        );

      case 'adicional':
        return (
          <div style={{ display: 'grid', gridTemplateColumns: '1fr', gap: '20px' }}>
            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Estatus
              </label>
              <select
                name="estatus"
                value={formData.estatus}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
              >
                <option value="disponible">Disponible</option>
                <option value="vendido">Vendido</option>
                <option value="rentado">Rentado</option>
                <option value="en_proceso">En Proceso</option>
              </select>
            </div>

            <div style={{ display: 'flex', alignItems: 'center' }}>
              <input
                type="checkbox"
                name="destacado"
                checked={formData.destacado}
                onChange={handleChange}
                style={{ marginRight: '8px' }}
              />
              <label style={{ fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Propiedad Destacada
              </label>
            </div>

            <div>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Descripci√≥n
              </label>
              <textarea
                name="descripcion"
                value={formData.descripcion}
                onChange={handleChange}
                rows={6}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px',
                  resize: 'vertical'
                }}
                placeholder="Descripci√≥n detallada de la propiedad..."
              />
            </div>
          </div>
        );

      default:
        return null;
    }
  };

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ marginBottom: '32px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' }}>
            <Link 
              href="/dashboard/propiedades/residencial"
              style={{ 
                color: '#64748b', 
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              ‚Üê Volver a Propiedades Residenciales
            </Link>
          </div>
          <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
            Agregar Propiedad Residencial
          </h1>
          <p style={{ color: '#64748b', fontSize: '16px' }}>
            Complete la informaci√≥n de la nueva propiedad residencial
          </p>
        </div>

        {/* Navegaci√≥n por secciones */}
        <div style={{ 
          display: 'flex', 
          gap: '8px', 
          marginBottom: '24px',
          overflowX: 'auto',
          paddingBottom: '8px'
        }}>
          {sections.map((section) => (
            <button
              key={section.id}
              type="button"
              onClick={() => setActiveSection(section.id)}
              style={{
                padding: '12px 16px',
                border: 'none',
                borderRadius: '8px',
                background: activeSection === section.id ? '#181f42' : 'white',
                color: activeSection === section.id ? 'white' : '#374151',
                fontSize: '14px',
                fontWeight: '500',
                cursor: 'pointer',
                whiteSpace: 'nowrap',
                display: 'flex',
                alignItems: 'center',
                gap: '8px'
              }}
            >
              <span>{section.icon}</span>
              {section.label}
            </button>
          ))}
        </div>

        {/* Formulario */}
        <form onSubmit={handleSubmit}>
          <div style={{ 
            background: 'white', 
            borderRadius: '12px', 
            padding: '32px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0',
            marginBottom: '24px'
          }}>
            <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#2d3436', marginBottom: '24px' }}>
              {sections.find(s => s.id === activeSection)?.label}
            </h2>
            
            {renderSection()}
          </div>

          {/* Botones */}
          <div style={{ display: 'flex', gap: '16px', justifyContent: 'flex-end' }}>
            <Link
              href="/dashboard/propiedades/residencial"
              style={{
                padding: '12px 24px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                color: '#374151',
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              Cancelar
            </Link>
            <button
              type="submit"
              disabled={loading}
              style={{
                padding: '12px 24px',
                background: loading ? '#9ca3af' : '#181f42',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                fontSize: '14px',
                fontWeight: '500',
                cursor: loading ? 'not-allowed' : 'pointer'
              }}
            >
              {loading ? 'Agregando...' : 'Agregar Propiedad'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}=== app/dashboard/propiedades/residencial/page.tsx ===
// /dashboard/propiedades/residencial/page.tsx
'use client';

import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabaseClient';
import Link from 'next/link';

interface PropiedadResidencial {
  id: string;
  creado_en: string;
  titulo: string;
  direccion: string;
  colonia: string;
  ciudad: string;
  estado: string;
  tipo_propiedad: string;
  precio_venta: number;
  precio_renta: number;
  superficie_terreno: number;
  superficie_construccion: number;
  habitaciones: number;
  banos: number;
  cocheras: number;
  estatus: string;
  destacado: boolean;
}

export default function ListaPropiedadesResidenciales() {
  const [propiedades, setPropiedades] = useState<PropiedadResidencial[]>([]);
  const [loading, setLoading] = useState(true);
  const [deletingId, setDeletingId] = useState<string | null>(null);
  const [searchTerm, setSearchTerm] = useState('');
  const [filtroTipo, setFiltroTipo] = useState('todos');
  const [filtroEstatus, setFiltroEstatus] = useState('todos');

  useEffect(() => {
    fetchPropiedades();
  }, []);

  const fetchPropiedades = async () => {
    try {
      const { data, error } = await supabase
        .from('propiedades_residenciales')
        .select('*')
        .order('creado_en', { ascending: false });

      if (error) throw error;
      setPropiedades(data || []);
    } catch (error) {
      console.error('Error fetching propiedades:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleEliminarPropiedad = async (id: string, titulo: string) => {
    if (!confirm(`¬øEst√°s seguro de que quieres eliminar la propiedad "${titulo}"? Esta acci√≥n no se puede deshacer.`)) {
      return;
    }

    setDeletingId(id);
    
    try {
      const { error } = await supabase
        .from('propiedades_residenciales')
        .delete()
        .eq('id', id);

      if (error) {
        console.error('Error eliminando propiedad:', error);
        alert(`Error al eliminar propiedad: ${error.message}`);
        throw error;
      }

      // Actualizar la lista eliminando la propiedad
      setPropiedades(prev => prev.filter(propiedad => propiedad.id !== id));
      alert('Propiedad eliminada correctamente');
      
    } catch (error) {
      console.error('Error eliminando propiedad:', error);
    } finally {
      setDeletingId(null);
    }
  };

  const filteredPropiedades = propiedades.filter(propiedad => {
    const matchesSearch = propiedad.titulo.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         propiedad.ciudad.toLowerCase().includes(searchTerm.toLowerCase()) ||
                         propiedad.colonia.toLowerCase().includes(searchTerm.toLowerCase());
    
    const matchesTipo = filtroTipo === 'todos' || propiedad.tipo_propiedad === filtroTipo;
    const matchesEstatus = filtroEstatus === 'todos' || propiedad.estatus === filtroEstatus;

    return matchesSearch && matchesTipo && matchesEstatus;
  });

  const tiposPropiedad = ['todos', 'casa', 'departamento', 'terreno', 'duplex'];
  const estatusOptions = ['todos', 'disponible', 'vendido', 'rentado', 'en_proceso'];

  const getTipoBadgeStyle = (tipo: string) => {
    switch (tipo) {
      case 'casa':
        return { background: '#dcfce7', color: '#166534' };
      case 'departamento':
        return { background: '#dbeafe', color: '#1e40af' };
      case 'terreno':
        return { background: '#fef3c7', color: '#92400e' };
      case 'duplex':
        return { background: '#f3e8ff', color: '#7c3aed' };
      default:
        return { background: '#f3f4f6', color: '#374151' };
    }
  };

  const getEstatusBadgeStyle = (estatus: string) => {
    switch (estatus) {
      case 'disponible':
        return { background: '#dcfce7', color: '#166534' };
      case 'vendido':
        return { background: '#fef3c7', color: '#92400e' };
      case 'rentado':
        return { background: '#dbeafe', color: '#1e40af' };
      case 'en_proceso':
        return { background: '#f3f4f6', color: '#6b7280' };
      default:
        return { background: '#f3f4f6', color: '#374151' };
    }
  };

  if (loading) {
    return (
      <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
        <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
          <div style={{ textAlign: 'center', color: '#64748b' }}>Cargando propiedades...</div>
        </div>
      </div>
    );
  }

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ marginBottom: '32px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' }}>
            <Link 
              href="/dashboard"
              style={{ 
                color: '#64748b', 
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              ‚Üê Volver al Dashboard
            </Link>
          </div>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>
            <div>
              <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
                Propiedades Residenciales
              </h1>
              <p style={{ color: '#64748b', fontSize: '16px' }}>
                Gesti√≥n de casas, departamentos y terrenos residenciales
              </p>
            </div>
            <Link
              href="/dashboard/propiedades/residencial/agregar"
              style={{
                padding: '12px 24px',
                background: '#181f42',
                color: 'white',
                textDecoration: 'none',
                borderRadius: '8px',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              + Agregar Propiedad
            </Link>
          </div>

          {/* Filtros y B√∫squeda */}
          <div style={{ 
            background: 'white', 
            padding: '20px',
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 2fr', gap: '16px', marginBottom: '16px' }}>
              {/* Filtro Tipo */}
              <div>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  Tipo de Propiedad
                </label>
                <select
                  value={filtroTipo}
                  onChange={(e) => setFiltroTipo(e.target.value)}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                >
                  {tiposPropiedad.map(tipo => (
                    <option key={tipo} value={tipo}>
                      {tipo === 'todos' ? 'Todos los tipos' : tipo.charAt(0).toUpperCase() + tipo.slice(1)}
                    </option>
                  ))}
                </select>
              </div>

              {/* Filtro Estatus */}
              <div>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  Estatus
                </label>
                <select
                  value={filtroEstatus}
                  onChange={(e) => setFiltroEstatus(e.target.value)}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                >
                  {estatusOptions.map(estatus => (
                    <option key={estatus} value={estatus}>
                      {estatus === 'todos' ? 'Todos' : estatus.charAt(0).toUpperCase() + estatus.slice(1)}
                    </option>
                  ))}
                </select>
              </div>

              {/* B√∫squeda */}
              <div>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  Buscar
                </label>
                <input
                  type="text"
                  placeholder="Buscar por t√≠tulo, ciudad o colonia..."
                  value={searchTerm}
                  onChange={(e) => setSearchTerm(e.target.value)}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                />
              </div>
            </div>
          </div>
        </div>

        {/* Stats */}
        <div style={{ 
          display: 'grid', 
          gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', 
          gap: '20px', 
          marginBottom: '32px' 
        }}>
          <div style={{ 
            background: 'white', 
            padding: '24px',
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '24px', fontWeight: '700', color: '#2d3436' }}>{propiedades.length}</div>
            <div style={{ color: '#64748b', fontSize: '14px' }}>Total Propiedades</div>
          </div>
          
          <div style={{ 
            background: 'white', 
            padding: '24px',
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '24px', fontWeight: '700', color: '#166534' }}>
              {propiedades.filter(p => p.estatus === 'disponible').length}
            </div>
            <div style={{ color: '#64748b', fontSize: '14px' }}>Disponibles</div>
          </div>
          
          <div style={{ 
            background: 'white', 
            padding: '24px',
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '24px', fontWeight: '700', color: '#1e40af' }}>
              {propiedades.filter(p => p.tipo_propiedad === 'casa').length}
            </div>
            <div style={{ color: '#64748b', fontSize: '14px' }}>Casas</div>
          </div>
          
          <div style={{ 
            background: 'white', 
            padding: '24px',
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0'
          }}>
            <div style={{ fontSize: '24px', fontWeight: '700', color: '#9a3412' }}>
              {propiedades.filter(p => p.tipo_propiedad === 'departamento').length}
            </div>
            <div style={{ color: '#64748b', fontSize: '14px' }}>Departamentos</div>
          </div>
        </div>

        {/* Propiedades Table */}
        <div style={{ 
          background: 'white', 
          borderRadius: '12px',
          boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
          border: '1px solid #e2e8f0',
          overflow: 'hidden'
        }}>
          <div style={{ 
            display: 'grid',
            gridTemplateColumns: '2fr 1fr 1fr 1fr 1fr 1fr auto',
            gap: '16px',
            padding: '20px',
            background: '#f8fafc',
            borderBottom: '1px solid #e2e8f0',
            fontWeight: '600',
            color: '#374151',
            fontSize: '14px'
          }}>
            <div>Propiedad</div>
            <div>Tipo</div>
            <div>Ubicaci√≥n</div>
            <div>Precio</div>
            <div>Caracter√≠sticas</div>
            <div>Estatus</div>
            <div>Acciones</div>
          </div>

          <div>
            {filteredPropiedades.map((propiedad) => (
              <div
                key={propiedad.id}
                style={{
                  display: 'grid',
                  gridTemplateColumns: '2fr 1fr 1fr 1fr 1fr 1fr auto',
                  gap: '16px',
                  padding: '20px',
                  borderBottom: '1px solid #f1f5f9',
                  alignItems: 'center'
                }}
              >
                {/* Propiedad */}
                <div>
                  <div style={{ fontWeight: '600', color: '#2d3436' }}>{propiedad.titulo}</div>
                  <div style={{ fontSize: '12px', color: '#64748b', marginTop: '4px' }}>
                    {propiedad.direccion}
                  </div>
                </div>

                {/* Tipo */}
                <div>
                  <span
                    style={{
                      padding: '4px 12px',
                      borderRadius: '20px',
                      fontSize: '12px',
                      fontWeight: '600',
                      ...getTipoBadgeStyle(propiedad.tipo_propiedad)
                    }}
                  >
                    {propiedad.tipo_propiedad}
                  </span>
                </div>

                {/* Ubicaci√≥n */}
                <div>
                  <div style={{ color: '#2d3436', fontSize: '14px' }}>{propiedad.ciudad}</div>
                  <div style={{ color: '#64748b', fontSize: '12px', marginTop: '4px' }}>
                    {propiedad.colonia}
                  </div>
                </div>

                {/* Precio */}
                <div style={{ color: '#2d3436', fontSize: '14px', fontWeight: '600' }}>
                  {propiedad.precio_venta ? (
                    `$${propiedad.precio_venta.toLocaleString()}`
                  ) : propiedad.precio_renta ? (
                    `Renta: $${propiedad.precio_renta.toLocaleString()}`
                  ) : (
                    <span style={{ color: '#9ca3af' }}>Consultar</span>
                  )}
                </div>

                {/* Caracter√≠sticas */}
                <div style={{ color: '#2d3436', fontSize: '14px' }}>
                  <div>{propiedad.habitaciones} hab.</div>
                  <div>{propiedad.banos} ba√±os</div>
                  <div>{propiedad.cocheras} cocheras</div>
                </div>

                {/* Estatus */}
                <div>
                  <span
                    style={{
                      padding: '4px 12px',
                      borderRadius: '20px',
                      fontSize: '12px',
                      fontWeight: '600',
                      ...getEstatusBadgeStyle(propiedad.estatus)
                    }}
                  >
                    {propiedad.estatus}
                  </span>
                </div>

                {/* Acciones */}
                <div style={{ display: 'flex', gap: '12px' }}>
                  <Link
                    href={`/dashboard/propiedades/residencial/editar/${propiedad.id}`}
                    style={{
                      color: '#2563eb',
                      textDecoration: 'none',
                      fontSize: '14px',
                      fontWeight: '500'
                    }}
                  >
                    Editar
                  </Link>
                  <button 
                    onClick={() => handleEliminarPropiedad(propiedad.id, propiedad.titulo)}
                    disabled={deletingId === propiedad.id}
                    style={{
                      color: deletingId === propiedad.id ? '#9ca3af' : '#dc2626',
                      background: 'none',
                      border: 'none',
                      fontSize: '14px',
                      fontWeight: '500',
                      cursor: deletingId === propiedad.id ? 'not-allowed' : 'pointer'
                    }}
                  >
                    {deletingId === propiedad.id ? 'Eliminando...' : 'Eliminar'}
                  </button>
                </div>
              </div>
            ))}
          </div>

          {filteredPropiedades.length === 0 && (
            <div style={{ 
              textAlign: 'center', 
              padding: '40px', 
              color: '#64748b' 
            }}>
              No se encontraron propiedades
            </div>
          )}
        </div>
      </div>
    </div>
  );
}=== app/dashboard/page.tsx ===
// app/dashboard/page.tsx - DASHBOARD INTELIGENTE
'use client';

import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabaseClient';
import Link from 'next/link';
import { useRouter } from 'next/navigation';

interface DashboardStats {
  totalPropiedades: number;
  propiedadesResidenciales: number;
  propiedadesComerciales: number;
  propiedadesIndustriales: number;
  totalClientes: number;
  clientesActivos: number;
}

export default function DashboardPage() {
  const [userName, setUserName] = useState('');
  const [userEmail, setUserEmail] = useState('');
  const [userRole, setUserRole] = useState('');
  const [stats, setStats] = useState<DashboardStats>({
    totalPropiedades: 0,
    propiedadesResidenciales: 0,
    propiedadesComerciales: 0,
    propiedadesIndustriales: 0,
    totalClientes: 0,
    clientesActivos: 0
  });
  const [loading, setLoading] = useState(true);
  const router = useRouter();

  useEffect(() => {
    loadUserAndStats();
  }, []);

  const loadUserAndStats = async () => {
    try {
      // Cargar datos del usuario
      const email = localStorage.getItem('userEmail');
      if (!email) {
        router.push('/login');
        return;
      }

      const name = localStorage.getItem('userName') || 'Usuario';
      const role = localStorage.getItem('userRole') || 'broker';
      
      setUserName(name);
      setUserEmail(email);
      setUserRole(role);

      // Cargar estad√≠sticas seg√∫n el rol
      await loadDashboardStats(email, role);

    } catch (error) {
      console.error('Error loading dashboard:', error);
    } finally {
      setLoading(false);
    }
  };

  const loadDashboardStats = async (userEmail: string, role: string) => {
    try {
      let residencialCount = 0;
      let comercialCount = 0;
      let industrialCount = 0;
      let clientesCount = 0;
      let clientesActivosCount = 0;

      if (role === 'admin' || role === 'superadmin') {
        // ADMIN ve todo
        const [
          { count: resCount },
          { count: comCount },
          { count: indCount },
          { data: clientesData }
        ] = await Promise.all([
          supabase.from('propiedades_residenciales').select('id', { count: 'exact' }),
          supabase.from('propiedades_comerciales').select('id', { count: 'exact' }),
          supabase.from('propiedades_industriales').select('id', { count: 'exact' }),
          supabase.from('clientes').select('id, estatus', { count: 'exact' })
        ]);

        residencialCount = resCount || 0;
        comercialCount = comCount || 0;
        industrialCount = indCount || 0;
        clientesCount = clientesData?.length || 0;
        clientesActivosCount = clientesData?.filter(c => c.estatus === 'activo').length || 0;

      } else {
        // BROKER ve solo sus datos
        // Primero obtener el broker_id del usuario
        const { data: usuario } = await supabase
          .from('usuarios')
          .select('broker_id')
          .eq('email', userEmail)
          .single();

        if (usuario?.broker_id) {
          const [
            { count: resCount },
            { count: comCount },
            { count: indCount },
            { data: clientesData }
          ] = await Promise.all([
            supabase.from('propiedades_residenciales').select('id', { count: 'exact' }).eq('broker_id', usuario.broker_id),
            supabase.from('propiedades_comerciales').select('id', { count: 'exact' }).eq('broker_id', usuario.broker_id),
            supabase.from('propiedades_industriales').select('id', { count: 'exact' }).eq('broker_id', usuario.broker_id),
            supabase.from('clientes').select('id, estatus', { count: 'exact' }).eq('broker_id', usuario.broker_id)
          ]);

          residencialCount = resCount || 0;
          comercialCount = comCount || 0;
          industrialCount = indCount || 0;
          clientesCount = clientesData?.length || 0;
          clientesActivosCount = clientesData?.filter(c => c.estatus === 'activo').length || 0;
        }
      }

      setStats({
        totalPropiedades: residencialCount + comercialCount + industrialCount,
        propiedadesResidenciales: residencialCount,
        propiedadesComerciales: comercialCount,
        propiedadesIndustriales: industrialCount,
        totalClientes: clientesCount,
        clientesActivos: clientesActivosCount
      });

    } catch (error) {
      console.error('Error loading stats:', error);
    }
  };

  const handleLogout = () => {
    localStorage.removeItem('userEmail');
    localStorage.removeItem('userName');
    localStorage.removeItem('userRole');
    router.push('/login');
  };

  if (loading) {
    return (
      <div style={{
        minHeight: '100vh',
        background: 'linear-gradient(135deg, #181f42ff 0%, #252730ff 100%)',
        display: 'flex',
        alignItems: 'center',
        justifyContent: 'center',
        padding: '20px'
      }}>
        <div style={{ textAlign: 'center', color: 'white' }}>
          <div style={{ fontSize: '48px', marginBottom: '20px' }}>‚è≥</div>
          <p style={{ fontSize: '1.2rem' }}>Cargando dashboard inteligente...</p>
        </div>
      </div>
    );
  }

  // Tarjetas base para todos los usuarios
  const baseCards = [
    { 
      href: '/dashboard/propiedades/residencial', 
      title: 'üè† Residencial', 
      desc: `${stats.propiedadesResidenciales} propiedades`, 
      color: '#DC2626',
      count: stats.propiedadesResidenciales
    },
    { 
      href: '/dashboard/propiedades/comercial', 
      title: 'üõçÔ∏è Comercial', 
      desc: `${stats.propiedadesComerciales} propiedades`, 
      color: '#059669',
      count: stats.propiedadesComerciales
    },
    { 
      href: '/dashboard/propiedades/industrial', 
      title: 'üè≠ Industrial', 
      desc: `${stats.propiedadesIndustriales} propiedades`, 
      color: '#4F46E5',
      count: stats.propiedadesIndustriales
    },
    { 
      href: '/dashboard/clientes', 
      title: 'üë• Clientes', 
      desc: `${stats.totalClientes} clientes (${stats.clientesActivos} activos)`, 
      color: '#7C3AED',
      count: stats.totalClientes
    },
    { 
      href: '/dashboard/reportes', 
      title: 'üìä Pipeline', 
      desc: 'Seguimiento de ventas', 
      color: '#0891B2'
    },
  ];

  // Tarjeta especial para brokers (su perfil)
  const brokerCard = {
    href: 'perfil', 
    title: 'üë§ Mi Perfil', 
    desc: 'Gestionar mi informaci√≥n', 
    color: '#EA580C'
  };

  // Tarjeta especial para administradores (gesti√≥n de usuarios)
  const adminCard = {
    href: '/dashboard/admin/usuarios', 
    title: 'üë• Gesti√≥n Usuarios', 
    desc: userRole === 'admin' ? 'Ver todos los usuarios' : 'Gestionar roles y permisos', 
    color: '#7C3AED'
  };

  // Combinar tarjetas seg√∫n el rol
  let cards = [...baseCards];
  
  if (userRole === 'broker') {
    cards.push(brokerCard);
  } else if (userRole === 'admin' || userRole === 'superadmin') {
  cards.push(adminCard);
  cards.push(brokerCard);  // ‚Üê SOLO ESTA L√çNEA, NADA M√ÅS
}

  // Mostrar rol correcto en el header
  const getRoleDisplay = () => {
    switch (userRole) {
      case 'superadmin': return 'üëë Super Administrador';
      case 'admin': return 'üíº Administrador del Sistema';
      case 'broker': return 'ü§ù Broker CRM';
      default: return 'Usuario';
    }
  };

  return (
    <div style={{
      minHeight: '100vh',
      background: 'linear-gradient(135deg, #181f42ff 0%, #252730ff 100%)',
      padding: '40px 20px'
    }}>
      {/* Header con usuario */}
      <div style={{ 
        display: 'flex', 
        justifyContent: 'space-between', 
        alignItems: 'center', 
        marginBottom: '40px',
        background: 'rgba(255,255,255,0.1)',
        padding: '20px',
        borderRadius: '12px'
      }}>
        <div>
          <h1 style={{ fontSize: '2rem', color: 'white', marginBottom: '8px' }}>
            Bienvenido, {userName}
          </h1>
          <p style={{ color: 'rgba(255,255,255,0.8)', fontSize: '1rem', marginBottom: '4px' }}>
            {userEmail}
          </p>
          <p style={{ color: 'rgba(255,255,255,0.6)', fontSize: '0.9rem' }}>
            {getRoleDisplay()}
          </p>
        </div>
        
        <div style={{ display: 'flex', gap: '15px', alignItems: 'center' }}>
          {(userRole === 'admin' || userRole === 'superadmin') && (
            <div style={{ 
              background: 'rgba(255,255,255,0.1)', 
              padding: '12px 20px', 
              borderRadius: '12px',
              color: 'white',
              textAlign: 'center'
            }}>
              <div style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>{stats.totalPropiedades}</div>
              <div style={{ fontSize: '0.8rem', opacity: '0.8' }}>Total Propiedades</div>
            </div>
          )}
          
          <button
            onClick={handleLogout}
            style={{
              padding: '10px 20px',
              background: 'rgba(255,255,255,0.2)',
              color: 'white',
              border: '1px solid rgba(255,255,255,0.3)',
              borderRadius: '8px',
              cursor: 'pointer',
              fontSize: '14px'
            }}
          >
            Cerrar Sesi√≥n
          </button>
        </div>
      </div>

      {/* Tarjetas del dashboard */}
      <div style={{ 
        display: 'grid', 
        gridTemplateColumns: 'repeat(auto-fit, minmax(280px, 1fr))', 
        gap: '25px' 
      }}>
        {cards.map((card, index) => (
          <Link key={index} href={card.href} style={cardStyle}>
            <div style={{ 
              background: card.color, 
              width: '60px', 
              height: '60px', 
              borderRadius: '12px',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'center',
              fontSize: '24px',
              marginBottom: '15px'
            }}>
              {card.title.split(' ')[0]}
            </div>
            <h3 style={{ fontSize: '1.3rem', marginBottom: '8px', color: '#1F2937' }}>
              {card.title.split(' ').slice(1).join(' ')}
              {card.count !== undefined && (
                <span style={{ 
                  marginLeft: '8px', 
                  background: card.color, 
                  color: 'white',
                  padding: '2px 8px',
                  borderRadius: '12px',
                  fontSize: '0.8rem'
                }}>
                  {card.count}
                </span>
              )}
            </h3>
            <p style={{ color: '#6B7280', lineHeight: '1.5' }}>{card.desc}</p>
          </Link>
        ))}
      </div>
    </div>
  );
}

const cardStyle = {
  padding: '30px',
  borderRadius: '16px',
  textDecoration: 'none',
  color: 'inherit',
  display: 'block',
  backgroundColor: 'white',
  boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08)',
  transition: 'all 0.3s ease',
  border: '1px solid rgba(255, 255, 255, 0.2)',
  cursor: 'pointer'
};=== app/dashboard/clientes/crear/page.tsx ===
 'use client';

import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabaseClient';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

export default function CrearClientePage() {
  const [loading, setLoading] = useState(false);
  const [brokerId, setBrokerId] = useState('');
  const router = useRouter();

  const [formData, setFormData] = useState({
    nombre: '',
    email: '',
    telefono: '',
    tipo: 'comprador',
    estatus: 'activo',
    etapa_pipeline: 'prospecto',
    probabilidad_cierre: 10,
    presupuesto_max: '',
    notas: ''
  });

  useEffect(() => {
    loadBrokerId();
  }, []);

  const loadBrokerId = async () => {
    try {
      const email = localStorage.getItem('userEmail');
      if (!email) {
        router.push('/login');
        return;
      }

      const { data: usuario } = await supabase
        .from('usuarios')
        .select('broker_id')
        .eq('email', email)
        .single();

      if (usuario?.broker_id) {
        setBrokerId(usuario.broker_id);
      }
    } catch (error) {
      console.error('Error loading broker:', error);
    }
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { error } = await supabase
        .from('clientes')
        .insert([{
          ...formData,
          broker_id: brokerId,
          presupuesto_max: formData.presupuesto_max ? parseFloat(formData.presupuesto_max) : null,
          fecha_creacion: new Date().toISOString()
        }]);

      if (error) throw error;

      alert('Cliente creado exitosamente!');
      router.push('/dashboard/clientes');
      
    } catch (error: any) {
      console.error('Error creating client:', error);
      alert('Error al crear cliente: ' + error.message);
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
  };

  return (
    <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #181f42ff 0%, #252730ff 100%)', padding: '20px' }}>
      <div style={{ maxWidth: '800px', margin: '0 auto' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '30px', background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px' }}>
          <div>
            <h1 style={{ fontSize: '2rem', color: 'white', marginBottom: '8px' }}>Crear Nuevo Cliente</h1>
            <p style={{ color: 'rgba(255,255,255,0.8)' }}>Agrega un nuevo cliente al sistema</p>
          </div>
          <Link href="/dashboard/clientes" style={{ padding: '10px 20px', background: 'rgba(255,255,255,0.2)', color: 'white', borderRadius: '8px', textDecoration: 'none', border: '1px solid rgba(255,255,255,0.3)' }}>‚Üê Volver</Link>
        </div>

        <div style={{ background: 'white', borderRadius: '12px', padding: '30px', boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)' }}>
          <form onSubmit={handleSubmit}>
            <div style={{ display: 'grid', gap: '20px' }}>
              <div>
                <h3 style={{ marginBottom: '15px', color: '#374151' }}>Informaci√≥n B√°sica</h3>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px' }}>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Nombre Completo *</label>
                    <input type="text" name="nombre" value={formData.nombre} onChange={handleChange} required style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }} />
                  </div>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Email</label>
                    <input type="email" name="email" value={formData.email} onChange={handleChange} style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }} />
                  </div>
                </div>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', marginTop: '15px' }}>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Tel√©fono</label>
                    <input type="tel" name="telefono" value={formData.telefono} onChange={handleChange} style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }} />
                  </div>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Presupuesto M√°ximo</label>
                    <input type="number" name="presupuesto_max" value={formData.presupuesto_max} onChange={handleChange} placeholder="Ej: 5000000" style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }} />
                  </div>
                </div>
              </div>

              <div>
                <h3 style={{ marginBottom: '15px', color: '#374151' }}>Clasificaci√≥n</h3>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '15px' }}>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Tipo</label>
                    <select name="tipo" value={formData.tipo} onChange={handleChange} style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }}>
                      <option value="comprador">Comprador</option>
                      <option value="vendedor">Vendedor</option>
                    
                    </select>
                  </div>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Estatus</label>
                    <select name="estatus" value={formData.estatus} onChange={handleChange} style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }}>
                      <option value="activo">Activo</option>
                      <option value="inactivo">Inactivo</option>
                      <option value="prospecto">Prospecto</option>
                    </select>
                  </div>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Etapa Pipeline</label>
                    <select name="etapa_pipeline" value={formData.etapa_pipeline} onChange={handleChange} style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }}>
                      <option value="prospecto">Prospecto (10%)</option>
                      <option value="calificado">Calificado (30%)</option>
                      <option value="negociacion">Negociaci√≥n (70%)</option>
                      <option value="cerrado">Cerrado (100%)</option>
                    </select>
                  </div>
                </div>
              </div>

              <div>
                <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Notas Adicionales</label>
                <textarea name="notas" value={formData.notas} onChange={handleChange} rows={4} style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px', resize: 'vertical' }} />
              </div>

              <div style={{ display: 'flex', gap: '15px', justifyContent: 'flex-end' }}>
                <Link href="/dashboard/clientes" style={{ padding: '12px 24px', background: '#6b7280', color: 'white', borderRadius: '6px', textDecoration: 'none', fontSize: '14px', fontWeight: '500' }}>Cancelar</Link>
                <button type="submit" disabled={loading} style={{ padding: '12px 24px', background: '#181f42', color: 'white', border: 'none', borderRadius: '6px', fontSize: '14px', fontWeight: '500', cursor: loading ? 'not-allowed' : 'pointer', opacity: loading ? 0.6 : 1 }}>
                  {loading ? 'Creando...' : 'Crear Cliente'}
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}=== app/dashboard/clientes/editar/[id]/page.tsx ===
'use client';

import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabaseClient';
import { useRouter, useParams } from 'next/navigation';
import Link from 'next/link';

export default function EditarClientePage() {
  const [loading, setLoading] = useState(false);
  const [cliente, setCliente] = useState<any>(null);
  const router = useRouter();
  const params = useParams();
  const id = params.id as string;

  const [formData, setFormData] = useState({
    nombre: '',
    email: '',
    telefono: '',
    tipo: 'comprador',
    estatus: 'activo',
    etapa_pipeline: 'prospecto',
    probabilidad_cierre: 10,
    presupuesto_max: '',
    notas: ''
  });

  useEffect(() => {
    loadCliente();
  }, [id]);

  const loadCliente = async () => {
    try {
      const { data, error } = await supabase
        .from('clientes')
        .select('*')
        .eq('id', id)
        .single();

      if (error) throw error;
      
      setCliente(data);
      setFormData({
        nombre: data.nombre || '',
        email: data.email || '',
        telefono: data.telefono || '',
        tipo: data.tipo || 'comprador',
        estatus: data.estatus || 'activo',
        etapa_pipeline: data.etapa_pipeline || 'prospecto',
        probabilidad_cierre: data.probabilidad_cierre || 10,
        presupuesto_max: data.presupuesto_max || '',
        notas: data.notas || ''
      });

    } catch (error: any) {
      console.error('Error loading client:', error);
      alert('Error al cargar cliente: ' + error.message);
    }
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { error } = await supabase
        .from('clientes')
        .update({
          ...formData,
          presupuesto_max: formData.presupuesto_max ? parseFloat(formData.presupuesto_max) : null
        })
        .eq('id', id);

      if (error) throw error;

      alert('Cliente actualizado exitosamente!');
      router.push('/dashboard/clientes');
      
    } catch (error: any) {
      console.error('Error updating client:', error);
      alert('Error al actualizar cliente: ' + error.message);
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
  };

  if (!cliente) {
    return (
      <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #181f42ff 0%, #252730ff 100%)', padding: '20px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
        <div style={{ textAlign: 'center', color: 'white' }}>
          <div style={{ fontSize: '48px', marginBottom: '16px' }}>‚è≥</div>
          <p>Cargando cliente...</p>
        </div>
      </div>
    );
  }

  return (
    <div style={{ minHeight: '100vh', background: 'linear-gradient(135deg, #181f42ff 0%, #252730ff 100%)', padding: '20px' }}>
      <div style={{ maxWidth: '800px', margin: '0 auto' }}>
        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '30px', background: 'rgba(255,255,255,0.1)', padding: '20px', borderRadius: '12px' }}>
          <div>
            <h1 style={{ fontSize: '2rem', color: 'white', marginBottom: '8px' }}>Editar Cliente</h1>
            <p style={{ color: 'rgba(255,255,255,0.8)' }}>Editando: {cliente.nombre}</p>
          </div>
          <Link href="/dashboard/clientes" style={{ padding: '10px 20px', background: 'rgba(255,255,255,0.2)', color: 'white', borderRadius: '8px', textDecoration: 'none', border: '1px solid rgba(255,255,255,0.3)' }}>‚Üê Volver</Link>
        </div>

        <div style={{ background: 'white', borderRadius: '12px', padding: '30px', boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)' }}>
          <form onSubmit={handleSubmit}>
            <div style={{ display: 'grid', gap: '20px' }}>
              <div>
                <h3 style={{ marginBottom: '15px', color: '#374151' }}>Informaci√≥n B√°sica</h3>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px' }}>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Nombre Completo *</label>
                    <input type="text" name="nombre" value={formData.nombre} onChange={handleChange} required style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }} />
                  </div>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Email</label>
                    <input type="email" name="email" value={formData.email} onChange={handleChange} style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }} />
                  </div>
                </div>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '15px', marginTop: '15px' }}>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Tel√©fono</label>
                    <input type="tel" name="telefono" value={formData.telefono} onChange={handleChange} style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }} />
                  </div>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Presupuesto M√°ximo</label>
                    <input type="number" name="presupuesto_max" value={formData.presupuesto_max} onChange={handleChange} placeholder="Ej: 5000000" style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }} />
                  </div>
                </div>
              </div>

              <div>
                <h3 style={{ marginBottom: '15px', color: '#374151' }}>Clasificaci√≥n</h3>
                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '15px' }}>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Tipo</label>
                    <select name="tipo" value={formData.tipo} onChange={handleChange} style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }}>
                      <option value="comprador">Comprador</option>
                      <option value="vendedor">Vendedor</option>
                      <option value="inversionista">Inversionista</option>
                    </select>
                  </div>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Estatus</label>
                    <select name="estatus" value={formData.estatus} onChange={handleChange} style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }}>
                      <option value="activo">Activo</option>
                      <option value="inactivo">Inactivo</option>
                      <option value="prospecto">Prospecto</option>
                    </select>
                  </div>
                  <div>
                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Etapa Pipeline</label>
                    <select name="etapa_pipeline" value={formData.etapa_pipeline} onChange={handleChange} style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px' }}>
                      <option value="prospecto">Prospecto (10%)</option>
                      <option value="calificado">Calificado (30%)</option>
                      <option value="negociacion">Negociaci√≥n (70%)</option>
                      <option value="cerrado">Cerrado (100%)</option>
                    </select>
                  </div>
                </div>
              </div>

              <div>
                <label style={{ display: 'block', marginBottom: '5px', fontWeight: '500', color: '#374151' }}>Notas Adicionales</label>
                <textarea name="notas" value={formData.notas} onChange={handleChange} rows={4} style={{ width: '100%', padding: '10px', border: '1px solid #d1d5db', borderRadius: '6px', fontSize: '14px', resize: 'vertical' }} />
              </div>

              <div style={{ display: 'flex', gap: '15px', justifyContent: 'flex-end' }}>
                <Link href="/dashboard/clientes" style={{ padding: '12px 24px', background: '#6b7280', color: 'white', borderRadius: '6px', textDecoration: 'none', fontSize: '14px', fontWeight: '500' }}>Cancelar</Link>
                <button type="submit" disabled={loading} style={{ padding: '12px 24px', background: '#181f42', color: 'white', border: 'none', borderRadius: '6px', fontSize: '14px', fontWeight: '500', cursor: loading ? 'not-allowed' : 'pointer', opacity: loading ? 0.6 : 1 }}>
                  {loading ? 'Actualizando...' : 'Actualizar Cliente'}
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  );
}=== app/dashboard/clientes/agregar/page.tsx ===
// /dashboard/clientes/agregar/page.tsx
'use client';

import { useState } from 'react';
import { supabase } from '@/lib/supabaseClient';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

export default function AgregarCliente() {
  const router = useRouter();
  const [loading, setLoading] = useState(false);
  
  const [formData, setFormData] = useState({
    tipo: 'comprador',
    nombre: '',
    email: '',
    telefono: '',
    presupuesto_min: '',
    presupuesto_max: '',
    intereses: [] as string[],
    estatus: 'activo',
    notas: ''
  });

  const tiposInteres = ['industrial', 'comercial', 'residencial'];

  const handleInteresChange = (interes: string) => {
    setFormData(prev => ({
      ...prev,
      intereses: prev.intereses.includes(interes)
        ? prev.intereses.filter(i => i !== interes)
        : [...prev.intereses, interes]
    }));
  };

  const handleSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    setLoading(true);

    try {
      const { error } = await supabase
        .from('clientes')
        .insert([{
          ...formData,
          presupuesto_min: formData.presupuesto_min ? parseFloat(formData.presupuesto_min) : null,
          presupuesto_max: formData.presupuesto_max ? parseFloat(formData.presupuesto_max) : null
        }]);

      if (error) throw error;

      alert('Cliente agregado correctamente!');
      router.push('/dashboard/clientes');
      
    } catch (error) {
      console.error('Error agregando cliente:', error);
      alert('Error al agregar cliente');
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement | HTMLTextAreaElement>) => {
    const { name, value } = e.target;
    setFormData(prev => ({
      ...prev,
      [name]: value
    }));
  };

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
      <div style={{ maxWidth: '800px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ marginBottom: '32px' }}>
          <Link 
            href="/dashboard/clientes"
            style={{ 
              color: '#64748b', 
              textDecoration: 'none',
              fontSize: '14px',
              fontWeight: '500',
              marginBottom: '16px',
              display: 'inline-block'
            }}
          >
            ‚Üê Volver a Clientes
          </Link>
          <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
            Agregar Cliente
          </h1>
          <p style={{ color: '#64748b', fontSize: '16px' }}>
            Complete la informaci√≥n del nuevo cliente
          </p>
        </div>

        {/* Form */}
        <form onSubmit={handleSubmit}>
          <div style={{ 
            background: 'white', 
            borderRadius: '12px', 
            padding: '32px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            border: '1px solid #e2e8f0',
            marginBottom: '24px'
          }}>
            
            {/* Tipo de Cliente */}
            <div style={{ marginBottom: '24px' }}>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Tipo de Cliente *
              </label>
              <select
                name="tipo"
                value={formData.tipo}
                onChange={handleChange}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px'
                }}
                required
              >
                <option value="comprador">Comprador</option>
                <option value="vendedor">Vendedor</option>
                <option value="ambos">Ambos</option>
              </select>
            </div>

            {/* Informaci√≥n B√°sica */}
            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '24px' }}>
              <div>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  Nombre Completo *
                </label>
                <input
                  type="text"
                  name="nombre"
                  value={formData.nombre}
                  onChange={handleChange}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  required
                />
              </div>

              <div>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  Estatus
                </label>
                <select
                  name="estatus"
                  value={formData.estatus}
                  onChange={handleChange}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                >
                  <option value="activo">Activo</option>
                  <option value="prospecto">Prospecto</option>
                  <option value="inactivo">Inactivo</option>
                </select>
              </div>
            </div>

            {/* Contacto */}
            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '24px' }}>
              <div>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  Email
                </label>
                <input
                  type="email"
                  name="email"
                  value={formData.email}
                  onChange={handleChange}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                />
              </div>

              <div>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  Tel√©fono
                </label>
                <input
                  type="tel"
                  name="telefono"
                  value={formData.telefono}
                  onChange={handleChange}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                />
              </div>
            </div>

            {/* Presupuesto */}
            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '24px' }}>
              <div>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  Presupuesto M√≠nimo
                </label>
                <input
                  type="number"
                  name="presupuesto_min"
                  value={formData.presupuesto_min}
                  onChange={handleChange}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  placeholder="0.00"
                />
              </div>

              <div>
                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                  Presupuesto M√°ximo
                </label>
                <input
                  type="number"
                  name="presupuesto_max"
                  value={formData.presupuesto_max}
                  onChange={handleChange}
                  style={{ 
                    width: '100%', 
                    padding: '12px 16px',
                    border: '1px solid #d1d5db',
                    borderRadius: '8px',
                    fontSize: '14px'
                  }}
                  placeholder="0.00"
                />
              </div>
            </div>

            {/* Intereses */}
            <div style={{ marginBottom: '24px' }}>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Intereses en Propiedades
              </label>
              <div style={{ display: 'flex', gap: '16px', flexWrap: 'wrap' }}>
                {tiposInteres.map(interes => (
                  <label key={interes} style={{ display: 'flex', alignItems: 'center', cursor: 'pointer' }}>
                    <input
                      type="checkbox"
                      checked={formData.intereses.includes(interes)}
                      onChange={() => handleInteresChange(interes)}
                      style={{ marginRight: '8px' }}
                    />
                    <span style={{ textTransform: 'capitalize' }}>{interes}</span>
                  </label>
                ))}
              </div>
            </div>

            {/* Notas */}
            <div style={{ marginBottom: '24px' }}>
              <label style={{ display: 'block', marginBottom: '8px', fontWeight: '500', color: '#374151', fontSize: '14px' }}>
                Notas Adicionales
              </label>
              <textarea
                name="notas"
                value={formData.notas}
                onChange={handleChange}
                rows={4}
                style={{ 
                  width: '100%', 
                  padding: '12px 16px',
                  border: '1px solid #d1d5db',
                  borderRadius: '8px',
                  fontSize: '14px',
                  resize: 'vertical'
                }}
                placeholder="Observaciones, preferencias espec√≠ficas, etc."
              />
            </div>

          </div>

          {/* Botones */}
          <div style={{ display: 'flex', gap: '16px', justifyContent: 'flex-end' }}>
            <Link
              href="/dashboard/clientes"
              style={{
                padding: '12px 24px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                color: '#374151',
                textDecoration: 'none',
                fontSize: '14px',
                fontWeight: '500'
              }}
            >
              Cancelar
            </Link>
            <button
              type="submit"
              disabled={loading}
              style={{
                padding: '12px 24px',
                background: loading ? '#9ca3af' : '#181f42',
                color: 'white',
                border: 'none',
                borderRadius: '8px',
                fontSize: '14px',
                fontWeight: '500',
                cursor: loading ? 'not-allowed' : 'pointer'
              }}
            >
              {loading ? 'Agregando...' : 'Agregar Cliente'}
            </button>
          </div>
        </form>
      </div>
    </div>
  );
}=== app/dashboard/clientes/page.tsx ===
// app/dashboard/clientes/page.tsx - C√ìDIGO CORREGIDO
'use client';

import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabaseClient';
import Link from 'next/link';
import { useRouter } from 'next/navigation';

interface Cliente {
  id: string;
  nombre: string;
  email: string;
  telefono: string;
  tipo: string;
  estatus: string;
  fecha_creacion: string;
  broker_id?: string;
}

export default function ClientesPage() {
  const [clientes, setClientes] = useState<Cliente[]>([]);
  const [loading, setLoading] = useState(true);
  const [userRole, setUserRole] = useState('');
  const router = useRouter();

  useEffect(() => {
    fetchClientes();
  }, []);

const fetchClientes = async () => {
  try {
    setLoading(true);
    
    const email = localStorage.getItem('userEmail');
    const role = localStorage.getItem('userRole') || 'broker';
    setUserRole(role);

    if (!email) {
      router.push('/login');
      return;
    }

    // TEMPORAL: Mostrar todos los clientes sin filtrar por broker
    // Esto funcionar√° hasta que configuremos el RLS correctamente
    let query = supabase
      .from('clientes')
      .select('*')
      .order('fecha_creacion', { ascending: false });

    const { data, error } = await query;

    if (error) {
      console.error('Supabase error details:', error);
      
      // Si hay error de RLS, intentar consulta simple
      if (error.code === '42501' || error.message.includes('policy')) {
        console.log('Error de RLS, intentando consulta b√°sica...');
        const { data: simpleData } = await supabase
          .from('clientes')
          .select('id, nombre, email, telefono, tipo, estatus, fecha_creacion')
          .order('fecha_creacion', { ascending: false })
          .limit(100);
        
        setClientes(simpleData || []);
        return;
      }
      
      throw error;
    }

    setClientes(data || []);

  } catch (error) {
    console.error('Error fetching clientes:', error);
    
    // Mostrar datos de ejemplo si hay error
    const ejemploClientes: Cliente[] = [
      {
        id: '1',
        nombre: 'Carlos Rodr√≠guez',
        email: 'carlos@empresa.com',
        telefono: '+52 55 1234 5678',
        tipo: 'comprador',
        estatus: 'activo',
        fecha_creacion: new Date().toISOString()
      },
      {
        id: '2', 
        nombre: 'Ana Mart√≠nez',
        email: 'ana@comercial.com',
        telefono: '+52 55 8765 4321',
        tipo: 'vendedor',
        estatus: 'activo',
        fecha_creacion: new Date().toISOString()
      }
    ];
    
    setClientes(ejemploClientes);
    alert('Usando datos de ejemplo. Configura el RLS en Supabase.');
  } finally {
    setLoading(false);
  }
};

  const deleteCliente = async (id: string) => {
    if (!confirm('¬øEst√°s seguro de que quieres eliminar este cliente?')) {
      return;
    }

    try {
      const { error } = await supabase
        .from('clientes')
        .delete()
        .eq('id', id);

      if (error) throw error;

      // Recargar la lista
      fetchClientes();
      alert('Cliente eliminado correctamente');
    } catch (error) {
      console.error('Error deleting cliente:', error);
      alert('Error al eliminar el cliente');
    }
  };

  if (loading) {
    return (
      <div style={{ 
        minHeight: '100vh', 
        background: 'linear-gradient(135deg, #181f42ff 0%, #252730ff 100%)',
        display: 'flex', 
        alignItems: 'center', 
        justifyContent: 'center' 
      }}>
        <div style={{ textAlign: 'center', color: 'white' }}>
          <div style={{ fontSize: '48px', marginBottom: '16px' }}>‚è≥</div>
          <p>Cargando clientes...</p>
        </div>
      </div>
    );
  }

  return (
    <div style={{ 
      minHeight: '100vh', 
      background: 'linear-gradient(135deg, #181f42ff 0%, #252730ff 100%)',
      padding: '20px'
    }}>
      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ 
          display: 'flex', 
          justifyContent: 'space-between', 
          alignItems: 'center', 
          marginBottom: '30px',
          background: 'rgba(255,255,255,0.1)',
          padding: '20px',
          borderRadius: '12px'
        }}>
          <div>
            <h1 style={{ fontSize: '2rem', color: 'white', marginBottom: '8px' }}>
              Gesti√≥n de Clientes
            </h1>
            <p style={{ color: 'rgba(255,255,255,0.8)' }}>
              {userRole === 'admin' ? 'Todos los clientes del sistema' : 'Mis clientes asignados'}
            </p>
          </div>
          
          <div style={{ display: 'flex', gap: '15px' }}>
            <Link
              href="/dashboard"
              style={{
                padding: '10px 20px',
                background: 'rgba(255,255,255,0.2)',
                color: 'white',
                borderRadius: '8px',
                textDecoration: 'none',
                border: '1px solid rgba(255,255,255,0.3)'
              }}
            >
              ‚Üê Volver
            </Link>
            <Link
              href="/dashboard/clientes/crear"
              style={{
                padding: '10px 20px',
                background: '#10B981',
                color: 'white',
                borderRadius: '8px',
                textDecoration: 'none',
                fontWeight: '500'
              }}
            >
              + Nuevo Cliente
            </Link>
          </div>
        </div>

        {/* Estad√≠sticas R√°pidas */}
        <div style={{ 
          display: 'grid', 
          gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', 
          gap: '20px', 
          marginBottom: '30px' 
        }}>
          <div style={{ 
            background: 'rgba(255,255,255,0.1)', 
            padding: '20px', 
            borderRadius: '12px',
            textAlign: 'center',
            color: 'white'
          }}>
            <div style={{ fontSize: '2rem', fontWeight: 'bold' }}>{clientes.length}</div>
            <div style={{ opacity: '0.8' }}>Total Clientes</div>
          </div>
          <div style={{ 
            background: 'rgba(255,255,255,0.1)', 
            padding: '20px', 
            borderRadius: '12px',
            textAlign: 'center',
            color: 'white'
          }}>
            <div style={{ fontSize: '2rem', fontWeight: 'bold' }}>
              {clientes.filter(c => c.estatus === 'activo').length}
            </div>
            <div style={{ opacity: '0.8' }}>Clientes Activos</div>
          </div>
        </div>

        {/* Lista de Clientes */}
        <div style={{ 
          background: 'white', 
          borderRadius: '12px',
          overflow: 'hidden',
          boxShadow: '0 4px 6px rgba(0, 0, 0, 0.1)'
        }}>
          {clientes.length === 0 ? (
            <div style={{ textAlign: 'center', padding: '60px 20px', color: '#6B7280' }}>
              <div style={{ fontSize: '48px', marginBottom: '16px', opacity: '0.5' }}>üë•</div>
              <h3 style={{ marginBottom: '8px', color: '#374151' }}>No hay clientes</h3>
              <p style={{ marginBottom: '24px' }}>Comienza agregando tu primer cliente</p>
              <Link
                href="/dashboard/clientes/crear"
                style={{
                  background: '#181f42',
                  color: 'white',
                  padding: '12px 24px',
                  borderRadius: '8px',
                  textDecoration: 'none',
                  fontSize: '14px',
                  fontWeight: '500'
                }}
              >
                + Agregar Primer Cliente
              </Link>
            </div>
          ) : (
            <>
              {/* Header de la tabla */}
              <div style={{ 
                display: 'grid',
                gridTemplateColumns: '2fr 1fr 1fr 1fr auto',
                gap: '16px',
                padding: '20px',
                background: '#F8FAFC',
                borderBottom: '1px solid #E2E8F0',
                fontWeight: '600',
                color: '#374151'
              }}>
                <div>Nombre</div>
                <div>Contacto</div>
                <div>Tipo</div>
                <div>Estatus</div>
                <div>Acciones</div>
              </div>

              {/* Lista de clientes */}
              <div>
                {clientes.map((cliente, index) => (
                  <div
                    key={cliente.id}
                    style={{
                      display: 'grid',
                      gridTemplateColumns: '2fr 1fr 1fr 1fr auto',
                      gap: '16px',
                      padding: '20px',
                      borderBottom: index < clientes.length - 1 ? '1px solid #F1F5F9' : 'none',
                      alignItems: 'center'
                    }}
                  >
                    {/* Nombre */}
                    <div>
                      <div style={{ fontWeight: '600', color: '#2D3436' }}>
                        {cliente.nombre}
                      </div>
                      <div style={{ fontSize: '12px', color: '#64748B', marginTop: '4px' }}>
                        Creado: {new Date(cliente.fecha_creacion).toLocaleDateString()}
                      </div>
                    </div>

                    {/* Contacto */}
                    <div>
                      <div style={{ color: '#2D3436' }}>{cliente.email}</div>
                      <div style={{ fontSize: '12px', color: '#64748B', marginTop: '4px' }}>
                        {cliente.telefono}
                      </div>
                    </div>

                    {/* Tipo */}
                    <div>
                      <span style={{ 
                        padding: '4px 8px', 
                        borderRadius: '12px', 
                        fontSize: '12px',
                        background: cliente.tipo === 'comprador' ? '#10B98120' : '#3B82F620',
                        color: cliente.tipo === 'comprador' ? '#059669' : '#2563EB'
                      }}>
                        {cliente.tipo}
                      </span>
                    </div>

                    {/* Estatus */}
                    <div>
                      <span style={{ 
                        padding: '4px 8px', 
                        borderRadius: '12px', 
                        fontSize: '12px',
                        background: cliente.estatus === 'activo' ? '#10B98120' : '#6B728020',
                        color: cliente.estatus === 'activo' ? '#059669' : '#6B7280'
                      }}>
                        {cliente.estatus}
                      </span>
                    </div>

                    {/* Acciones */}
                    <div style={{ display: 'flex', gap: '8px' }}>
                      <Link
                        href={`/dashboard/clientes/editar/${cliente.id}`}
                        style={{
                          color: '#2563EB',
                          textDecoration: 'none',
                          fontSize: '12px',
                          fontWeight: '500',
                          padding: '6px 12px',
                          background: '#EFF6FF',
                          borderRadius: '6px'
                        }}
                      >
                        Editar
                      </Link>
                      <button
                        onClick={() => deleteCliente(cliente.id)}
                        style={{
                          color: '#DC2626',
                          background: '#FEF2F2',
                          border: 'none',
                          padding: '6px 12px',
                          borderRadius: '6px',
                          fontSize: '12px',
                          fontWeight: '500',
                          cursor: 'pointer'
                        }}
                      >
                        Eliminar
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </>
          )}
        </div>
      </div>
    </div>
  );
}=== app/dashboard/reportes_kpis/page.tsx ===
// app/dashboard/reportes-kpis/page.tsx - REPORTES & KPIs AVANZADOS
'use client';

import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabaseClient';
import { useRouter } from 'next/navigation';
import Link from 'next/link';

interface KPIStats {
  totalClientes: number;
  tasaConversion: number;
  tiempoPromedioCierre: number;
  valorTotalPipeline: number;
  clientesNuevosMes: number;
  eficienciaContacto: number;
}

interface EtapaMetrics {
  etapa: string;
  cantidad: number;
  porcentaje: number;
  tiempoPromedio: number;
  valorPromedio: number;
}

export default function ReportesKPIsPage() {
  const [kpis, setKpis] = useState<KPIStats>({
    totalClientes: 0,
    tasaConversion: 0,
    tiempoPromedioCierre: 0,
    valorTotalPipeline: 0,
    clientesNuevosMes: 0,
    eficienciaContacto: 0
  });
  const [etapasMetrics, setEtapasMetrics] = useState<EtapaMetrics[]>([]);
  const [brokerStats, setBrokerStats] = useState<any[]>([]);
  const [loading, setLoading] = useState(true);
  const [userRole, setUserRole] = useState('');
  const [periodo, setPeriodo] = useState('30'); // 30, 90, 365 d√≠as

  const router = useRouter();

  useEffect(() => {
    loadReportesData();
  }, [periodo]);

  const loadReportesData = async () => {
    try {
      const email = localStorage.getItem('userEmail');
      const role = localStorage.getItem('userRole') || 'broker';
      setUserRole(role);

      if (!email) {
        router.push('/login');
        return;
      }

      let brokerId = null;
      if (role !== 'admin') {
        const { data: usuario } = await supabase
          .from('usuarios')
          .select('broker_id')
          .eq('email', email)
          .single();
        brokerId = usuario?.broker_id;
      }

      // Cargar todos los datos en paralelo
      const [kpisData, etapasData, brokersData] = await Promise.all([
        loadKPIs(brokerId, role),
        loadEtapasMetrics(brokerId, role),
        role === 'admin' ? loadBrokersStats() : Promise.resolve([])
      ]);

      setKpis(kpisData);
      setEtapasMetrics(etapasData);
      setBrokerStats(brokersData);

    } catch (error) {
      console.error('Error loading reports:', error);
    } finally {
      setLoading(false);
    }
  };

  const loadKPIs = async (brokerId: string | null, role: string): Promise<KPIStats> => {
    let query = supabase.from('clientes').select('*');

    if (role !== 'admin' && brokerId) {
      query = query.eq('broker_id', brokerId);
    }

    const { data: clientes, error } = await query;
    if (error) throw error;

    const clientesCerrados = clientes?.filter(c => c.etapa_pipeline === 'cerrado') || [];
    const clientesTotales = clientes?.length || 0;
    const clientesNuevosMes = clientes?.filter(c => {
      const fechaCreacion = new Date(c.fecha_creacion);
      const hace30Dias = new Date();
      hace30Dias.setDate(hace30Dias.getDate() - 30);
      return fechaCreacion >= hace30Dias;
    }).length || 0;

    // Calcular tiempo promedio de cierre (en d√≠as)
    const tiemposCierre = clientesCerrados
      .filter(c => c.fecha_creacion && c.fecha_cierre)
      .map(c => {
        const inicio = new Date(c.fecha_creacion);
        const fin = new Date(c.fecha_cierre);
        return (fin.getTime() - inicio.getTime()) / (1000 * 60 * 60 * 24);
      });

    const tiempoPromedio = tiemposCierre.length > 0 
      ? tiemposCierre.reduce((a, b) => a + b, 0) / tiemposCierre.length 
      : 0;

    // Calcular valor total del pipeline
    const valorTotal = clientes?.reduce((sum, cliente) => {
      return sum + (cliente.valor_operacion || 0);
    }, 0) || 0;

    return {
      totalClientes: clientesTotales,
      tasaConversion: clientesTotales > 0 ? (clientesCerrados.length / clientesTotales) * 100 : 0,
      tiempoPromedioCierre: tiempoPromedio,
      valorTotalPipeline: valorTotal,
      clientesNuevosMes: clientesNuevosMes,
      eficienciaContacto: clientesTotales > 0 ? (clientesCerrados.length / clientesTotales) * 100 : 0
    };
  };

  const loadEtapasMetrics = async (brokerId: string | null, role: string): Promise<EtapaMetrics[]> => {
    let query = supabase.from('clientes').select('*');

    if (role !== 'admin' && brokerId) {
      query = query.eq('broker_id', brokerId);
    }

    const { data: clientes, error } = await query;
    if (error) throw error;

    const etapas = ['prospecto', 'calificado', 'negociacion', 'cerrado'];
    const totalClientes = clientes?.length || 0;

    return etapas.map(etapa => {
      const clientesEtapa = clientes?.filter(c => c.etapa_pipeline === etapa) || [];
      const cantidad = clientesEtapa.length;
      const porcentaje = totalClientes > 0 ? (cantidad / totalClientes) * 100 : 0;
      
      // Calcular valor promedio (simulado para demo)
      const valorPromedio = etapa === 'cerrado' 
        ? 250000 
        : etapa === 'negociacion' 
          ? 200000 
          : etapa === 'calificado' 
            ? 150000 
            : 100000;

      return {
        etapa,
        cantidad,
        porcentaje,
        tiempoPromedio: 0, // En una implementaci√≥n real, calcular√≠as esto
        valorPromedio
      };
    });
  };

  const loadBrokersStats = async () => {
    const { data: brokers, error } = await supabase
      .from('brokers')
      .select('id, nombre, email');

    if (error) throw error;

    const stats = await Promise.all(
      brokers.map(async (broker) => {
        const { data: clientes } = await supabase
          .from('clientes')
          .select('*')
          .eq('broker_id', broker.id);

        const totalClientes = clientes?.length || 0;
        const clientesCerrados = clientes?.filter(c => c.etapa_pipeline === 'cerrado').length || 0;
        const tasaConversion = totalClientes > 0 ? (clientesCerrados / totalClientes) * 100 : 0;

        return {
          ...broker,
          totalClientes,
          clientesCerrados,
          tasaConversion
        };
      })
    );

    return stats;
  };

  const formatCurrency = (amount: number) => {
    return new Intl.NumberFormat('es-MX', {
      style: 'currency',
      currency: 'MXN'
    }).format(amount);
  };

  if (loading) {
    return (
      <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
        <div style={{ maxWidth: '1200px', margin: '0 auto', textAlign: 'center', color: '#64748b' }}>
          <div style={{ fontSize: '48px', marginBottom: '16px' }}>üìä</div>
          <p>Cargando reportes avanzados...</p>
        </div>
      </div>
    );
  }

  return (
    <div style={{ minHeight: '100vh', background: '#f8f9fa', padding: '32px' }}>
      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        
        {/* Header */}
        <div style={{ marginBottom: '32px' }}>
          <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '16px' }}>
            <Link 
              href="/dashboard"
              style={{ color: '#64748b', textDecoration: 'none', fontSize: '14px', fontWeight: '500' }}
            >
              ‚Üê Volver al Dashboard
            </Link>
          </div>
          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>
            <div>
              <h1 style={{ fontSize: '28px', fontWeight: '700', color: '#2d3436', marginBottom: '8px' }}>
                Reportes & KPIs Avanzados
              </h1>
              <p style={{ color: '#64748b', fontSize: '16px' }}>
                M√©tricas de desempe√±o y an√°lisis del pipeline
              </p>
            </div>
            <select
              value={periodo}
              onChange={(e) => setPeriodo(e.target.value)}
              style={{ 
                padding: '10px 16px',
                border: '1px solid #d1d5db',
                borderRadius: '8px',
                fontSize: '14px'
              }}
            >
              <option value="30">√öltimos 30 d√≠as</option>
              <option value="90">√öltimos 90 d√≠as</option>
              <option value="365">√öltimos 365 d√≠as</option>
            </select>
          </div>
        </div>

        {/* KPIs Principales */}
        <div style={{ 
          display: 'grid', 
          gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', 
          gap: '20px', 
          marginBottom: '32px' 
        }}>
          <div style={{ 
            background: 'white', 
            padding: '24px',
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            borderLeft: '4px solid #3B82F6'
          }}>
            <div style={{ fontSize: '14px', color: '#64748b', marginBottom: '8px' }}>Total Clientes</div>
            <div style={{ fontSize: '32px', fontWeight: '700', color: '#2d3436' }}>{kpis.totalClientes}</div>
            <div style={{ fontSize: '12px', color: '#059669', marginTop: '4px' }}>
              +{kpis.clientesNuevosMes} nuevos este mes
            </div>
          </div>

          <div style={{ 
            background: 'white', 
            padding: '24px',
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            borderLeft: '4px solid #10B981'
          }}>
            <div style={{ fontSize: '14px', color: '#64748b', marginBottom: '8px' }}>Tasa de Conversi√≥n</div>
            <div style={{ fontSize: '32px', fontWeight: '700', color: '#2d3436' }}>
              {kpis.tasaConversion.toFixed(1)}%
            </div>
            <div style={{ fontSize: '12px', color: '#64748b', marginTop: '4px' }}>
              Del pipeline a cerrado
            </div>
          </div>

          <div style={{ 
            background: 'white', 
            padding: '24px',
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            borderLeft: '4px solid #F59E0B'
          }}>
            <div style={{ fontSize: '14px', color: '#64748b', marginBottom: '8px' }}>Tiempo Promedio Cierre</div>
            <div style={{ fontSize: '32px', fontWeight: '700', color: '#2d3436' }}>
              {kpis.tiempoPromedioCierre.toFixed(0)} d√≠as
            </div>
            <div style={{ fontSize: '12px', color: '#64748b', marginTop: '4px' }}>
              Desde prospecto a cerrado
            </div>
          </div>

          <div style={{ 
            background: 'white', 
            padding: '24px',
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            borderLeft: '4px solid #EF4444'
          }}>
            <div style={{ fontSize: '14px', color: '#64748b', marginBottom: '8px' }}>Valor Total Pipeline</div>
            <div style={{ fontSize: '32px', fontWeight: '700', color: '#2d3436' }}>
              {formatCurrency(kpis.valorTotalPipeline)}
            </div>
            <div style={{ fontSize: '12px', color: '#64748b', marginTop: '4px' }}>
              Potencial de ventas
            </div>
          </div>
        </div>

        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '32px', marginBottom: '32px' }}>
          {/* M√©tricas por Etapa */}
          <div style={{ 
            background: 'white', 
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            padding: '24px'
          }}>
            <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#2d3436', marginBottom: '20px' }}>
              M√©tricas por Etapa del Pipeline
            </h2>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
              {etapasMetrics.map((etapa, index) => (
                <div key={etapa.etapa} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '12px', background: '#f8fafc', borderRadius: '8px' }}>
                  <div>
                    <div style={{ fontWeight: '600', color: '#2d3436', textTransform: 'capitalize' }}>
                      {etapa.etapa}
                    </div>
                    <div style={{ fontSize: '12px', color: '#64748b' }}>
                      {etapa.cantidad} clientes ({etapa.porcentaje.toFixed(1)}%)
                    </div>
                  </div>
                  <div style={{ textAlign: 'right' }}>
                    <div style={{ fontWeight: '600', color: '#2d3436' }}>
                      {formatCurrency(etapa.valorPromedio)}
                    </div>
                    <div style={{ fontSize: '12px', color: '#64748b' }}>
                      valor promedio
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>

          {/* Funnel de Conversi√≥n */}
          <div style={{ 
            background: 'white', 
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            padding: '24px'
          }}>
            <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#2d3436', marginBottom: '20px' }}>
              Funnel de Conversi√≥n
            </h2>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
              {etapasMetrics.map((etapa, index) => (
                <div key={etapa.etapa}>
                  <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '4px' }}>
                    <span style={{ fontSize: '14px', fontWeight: '500', color: '#2d3436', textTransform: 'capitalize' }}>
                      {etapa.etapa}
                    </span>
                    <span style={{ fontSize: '14px', color: '#64748b' }}>
                      {etapa.cantidad} ({etapa.porcentaje.toFixed(1)}%)
                    </span>
                  </div>
                  <div style={{ 
                    background: '#e5e7eb', 
                    borderRadius: '10px', 
                    height: '8px',
                    overflow: 'hidden'
                  }}>
                    <div 
                      style={{ 
                        background: 
                          etapa.etapa === 'prospecto' ? '#6B7280' :
                          etapa.etapa === 'calificado' ? '#3B82F6' :
                          etapa.etapa === 'negociacion' ? '#F59E0B' : '#10B981',
                        width: `${etapa.porcentaje}%`,
                        height: '100%',
                        borderRadius: '10px',
                        transition: 'all 0.3s ease'
                      }} 
                    />
                  </div>
                  {index < etapasMetrics.length - 1 && (
                    <div style={{ textAlign: 'center', color: '#64748b', fontSize: '12px', margin: '4px 0' }}>
                      ‚Üì {((etapa.porcentaje / (etapasMetrics[index]?.porcentaje || 100)) * 100).toFixed(0)}% de conversi√≥n
                    </div>
                  )}
                </div>
              ))}
            </div>
          </div>
        </div>

        {/* Tabla de Performance por Broker (solo para admin) */}
        {userRole === 'admin' && brokerStats.length > 0 && (
          <div style={{ 
            background: 'white', 
            borderRadius: '12px',
            boxShadow: '0 1px 3px rgba(0,0,0,0.12)',
            padding: '24px',
            marginBottom: '32px'
          }}>
            <h2 style={{ fontSize: '20px', fontWeight: '600', color: '#2d3436', marginBottom: '20px' }}>
              Performance por Broker
            </h2>
            <div style={{ overflowX: 'auto' }}>
              <table style={{ width: '100%', borderCollapse: 'collapse' }}>
                <thead>
                  <tr style={{ borderBottom: '1px solid #e5e7eb' }}>
                    <th style={{ textAlign: 'left', padding: '12px', fontWeight: '600', color: '#374151' }}>Broker</th>
                    <th style={{ textAlign: 'left', padding: '12px', fontWeight: '600', color: '#374151' }}>Total Clientes</th>
                    <th style={{ textAlign: 'left', padding: '12px', fontWeight: '600', color: '#374151' }}>Clientes Cerrados</th>
                    <th style={{ textAlign: 'left', padding: '12px', fontWeight: '600', color: '#374151' }}>Tasa Conversi√≥n</th>
                    <th style={{ textAlign: 'left', padding: '12px', fontWeight: '600', color: '#374151' }}>Performance</th>
                  </tr>
                </thead>
                <tbody>
                  {brokerStats.map((broker) => (
                    <tr key={broker.id} style={{ borderBottom: '1px solid #f3f4f6' }}>
                      <td style={{ padding: '12px' }}>{broker.nombre}</td>
                      <td style={{ padding: '12px' }}>{broker.totalClientes}</td>
                      <td style={{ padding: '12px' }}>{broker.clientesCerrados}</td>
                      <td style={{ padding: '12px' }}>{broker.tasaConversion.toFixed(1)}%</td>
                      <td style={{ padding: '12px' }}>
                        <div style={{ 
                          padding: '4px 8px', 
                          borderRadius: '12px', 
                          fontSize: '12px',
                          background: broker.tasaConversion >= 20 ? '#10B98120' : 
                                    broker.tasaConversion >= 10 ? '#F59E0B20' : '#EF444420',
                          color: broker.tasaConversion >= 20 ? '#059669' : 
                                broker.tasaConversion >= 10 ? '#D97706' : '#DC2626',
                          display: 'inline-block'
                        }}>
                          {broker.tasaConversion >= 20 ? 'Excelente' : 
                           broker.tasaConversion >= 10 ? 'Bueno' : 'A mejorar'}
                        </div>
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        )}

        {/* Acciones R√°pidas */}
        <div style={{ 
          display: 'grid', 
          gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', 
          gap: '16px' 
        }}>
          <Link
            href="/dashboard/reportes"
            style={{
              background: '#181f42',
              color: 'white',
              padding: '16px 24px',
              borderRadius: '8px',
              textDecoration: 'none',
              textAlign: 'center',
              fontSize: '14px',
              fontWeight: '500'
            }}
          >
            üìä Ver Pipeline Detallado
          </Link>
          <button
            onClick={() => window.print()}
            style={{
              background: 'white',
              color: '#374151',
              padding: '16px 24px',
              borderRadius: '8px',
              border: '1px solid #d1d5db',
              fontSize: '14px',
              fontWeight: '500',
              cursor: 'pointer'
            }}
          >
            üñ®Ô∏è Exportar Reporte
          </button>
          <Link
            href="/dashboard/clientes"
            style={{
              background: '#059669',
              color: 'white',
              padding: '16px 24px',
              borderRadius: '8px',
              textDecoration: 'none',
              textAlign: 'center',
              fontSize: '14px',
              fontWeight: '500'
            }}
          >
            üë• Gestionar Clientes
          </Link>
        </div>
      </div>
    </div>
  );
}